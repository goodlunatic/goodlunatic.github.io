<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>2025 浙江省大学生网络与信息安全竞赛 Misc Writeup - ⚡Lunatic BLOG⚡</title><meta name=author content="Lunatic"><meta name=description content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup
"><meta name=keywords content='CTF,Writeup,Misc'><meta itemprop=name content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><meta itemprop=description content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><meta itemprop=datePublished content="2025-11-18T10:56:18+08:00"><meta itemprop=dateModified content="2025-11-18T10:56:18+08:00"><meta itemprop=wordCount content="2456"><meta itemprop=keywords content="CTF,Writeup,Misc"><meta property="og:url" content="https://goodlunatic.github.io/posts/8582ff7/"><meta property="og:site_name" content="⚡Lunatic BLOG⚡"><meta property="og:title" content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><meta property="og:description" content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-18T10:56:18+08:00"><meta property="article:modified_time" content="2025-11-18T10:56:18+08:00"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Writeup"><meta property="article:tag" content="Misc"><meta name=twitter:card content="summary"><meta name=twitter:title content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><meta name=twitter:description content="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://www.nssctf.cn/files/2024/4/28/7f130a1387.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://goodlunatic.github.io/posts/8582ff7/ title="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup - ⚡Lunatic BLOG⚡"><link rel=prev type=text/html href=https://goodlunatic.github.io/posts/bfeb088/ title="2025 台州市网络安全大赛 Misc Writeup"><link rel=next type=text/html href=https://goodlunatic.github.io/posts/417c7ba/ title=CTF-渗透测试><link rel=alternate type=text/markdown href=https://goodlunatic.github.io/posts/8582ff7/index.md title="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup - ⚡Lunatic BLOG⚡"><link rel=stylesheet href=/css/config.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"2025 浙江省大学生网络与信息安全竞赛 Misc Writeup","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/goodlunatic.github.io\/posts\/8582ff7\/"},"genre":"posts","keywords":"CTF, Writeup, Misc","wordcount":2456,"url":"https:\/\/goodlunatic.github.io\/posts\/8582ff7\/","datePublished":"2025-11-18T10:56:18+08:00","dateModified":"2025-11-18T10:56:18+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Lunatic"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title="⚡Lunatic BLOG⚡"><span class=header-title-text>⚡Lunatic BLOG⚡</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-chain fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="⚡Lunatic BLOG⚡"><span class=header-title-text>⚡Lunatic BLOG⚡</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-chain fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>相关内容</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/posts/bfeb088/ title="2025 台州市网络安全大赛 Misc Writeup">2025 台州市网络安全大赛 Misc Writeup</a></li><li class=related-item><a href=/posts/02298dd/ title="2025 华为杯中国研究生网络安全创新大赛实网对抗赛 EZ_ATEXEC 详解">2025 华为杯中国研究生网络安全创新大赛实网对抗赛 EZ_ATEXEC 详解</a></li><li class=related-item><a href=/posts/49bdad5/ title="2025 第九届工业信息安全技能大赛-典型工业场景锦标赛 Misc Writeup">2025 第九届工业信息安全技能大赛-典型工业场景锦标赛 Misc Writeup</a></li><li class=related-item><a href=/posts/58b2135/ title="2025 泰山杯线下决赛 Misc Writeup">2025 泰山杯线下决赛 Misc Writeup</a></li><li class=related-item><a href=/posts/30d0764/ title="2025 “天一永安杯”宁波市网络安全大赛 Misc Writeup">2025 “天一永安杯”宁波市网络安全大赛 Misc Writeup</a></li></ul></div></div><div class=aside-custom><a href target=_blank rel=external><img src=/images/zsxq.webp alt="Lunatic Planet QR code" width=100%></a></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>2025 浙江省大学生网络与信息安全竞赛 Misc Writeup</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://goodlunatic.github.io title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=https://www.nssctf.cn/files/2024/4/28/7f130a1387.png alt=Lunatic height=16 width=16>&nbsp;Lunatic</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/writeup/ class=post-category title="分类 - Writeup"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Writeup</a></span></div><div class=post-meta-line><span title="发布于 2025-11-18 10:56:18"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-11-18>2025-11-18</time></span>&nbsp;<span title="2456 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2500 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 12 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#题目名称-小小作曲家>题目名称 小小作曲家</a></li><li><a href=#题目名称-really-good-binaural-audio>题目名称 Really Good Binaural Audio</a></li></ul></nav></div></div><div class=content id=content><p><strong>2025 浙江省大学生网络与信息安全竞赛 Misc Writeup</strong></p><p>本文仅记录问的比较多的几道 Misc 题，其余题目的题解可参考 A1natas 的官方 Writeup：</p><p>初赛：<a href=https://mp.weixin.qq.com/s/MpmetBaIVQNhCUOnis63gQ target=_blank rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/MpmetBaIVQNhCUOnis63gQ</a></p><p>决赛：<a href=https://mp.weixin.qq.com/s/Vl86wmSNVhbZd7f9KSkh8g target=_blank rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/Vl86wmSNVhbZd7f9KSkh8g</a></p><blockquote><p>本文中涉及的具体题目附件可以进我的<a href=https://t.zsxq.com/an6p6 target=_blank rel="external nofollow noopener noreferrer">知识星球</a>获取</p></blockquote><h2 class=heading-element id=题目名称-小小作曲家><span>题目名称 小小作曲家</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-%e5%b0%8f%e5%b0%8f%e4%bd%9c%e6%9b%b2%e5%ae%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>附件给了两个pcapng 流量包：attachment.pcapng 和 velato.pcapng</p><p>打开翻看一下发现是用 USB 传了 MIDI 数据</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251118110518135.png alt=/posts/8582ff7/imgs/image-20251118110518135.png height=1836 width=2804></p><p>我们首先看这个attachment.pcapng，用 tshark 导出一下 midi 事件和对应的时间戳</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r attachment.pcapng -T fields -Y <span class=s1>&#39;usbaudio.midi.event&#39;</span> -e <span class=s1>&#39;frame.time_epoch&#39;</span> -e <span class=s1>&#39;usbaudio.midi.event&#39;</span> &gt; 1.txt</span></span></code></pre></td></tr></table></div></div><blockquote><p>这里也是赛后和别的师傅们交流了一下才知道，<strong>这里要把时间戳也一起提取出来</strong></p><p>要不然后面制作 mid 文件的时候会有问题，音符和时间就没法对应上，导致错失关键信息</p><p>参考链接：https://www.dr0n.top/posts/3802b37a/</p></blockquote><p>数据提取出来后的格式大致如下</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251118110929386.png alt=/posts/8582ff7/imgs/image-20251118110929386.png height=1704 width=2336></p><p>我们写个脚本，用这些 midi 事件制作 mid 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mido</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PPQ</span> <span class=o>=</span> <span class=mi>480</span>  <span class=c1># 每四分音符的 tick 数</span>
</span></span><span class=line><span class=cl><span class=n>BPM</span> <span class=o>=</span> <span class=mf>120.0</span>  <span class=c1># 节拍速度</span>
</span></span><span class=line><span class=cl><span class=n>MIN_DURATION_MS</span> <span class=o>=</span> <span class=mf>120.0</span>  <span class=c1># 音符最小持续时间（毫秒）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_midi_events</span><span class=p>(</span><span class=n>input_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>input_file</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>lines</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(lines) # 1722159321.608646000\t904064</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ts_str</span><span class=p>,</span> <span class=n>hexdata</span> <span class=o>=</span> <span class=n>parts</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>ts_str</span><span class=p>)</span>  <span class=c1># 时间戳</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hexdata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=mh>0x90</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x9F</span> <span class=ow>and</span> <span class=n>velocity</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=s2>&#34;note_on&#34;</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=mh>0x80</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x8F</span> <span class=ow>or</span> <span class=p>(</span><span class=mh>0x90</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x9F</span> <span class=ow>and</span> <span class=n>velocity</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=s2>&#34;note_off&#34;</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>enforce_min_note_duration</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 按需延长 Note Off 的时间，保证音符不少于 MIN_DURATION_MS</span>
</span></span><span class=line><span class=cl>    <span class=n>min_duration</span> <span class=o>=</span> <span class=n>MIN_DURATION_MS</span> <span class=o>/</span> <span class=mf>1000.0</span>
</span></span><span class=line><span class=cl>    <span class=n>active_notes</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 记录活跃的 note_on 事件</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>note</span>
</span></span><span class=line><span class=cl>            <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_off&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>note</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>active_notes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>start_ts</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>min_end</span> <span class=o>=</span> <span class=n>start_ts</span> <span class=o>+</span> <span class=n>min_duration</span>
</span></span><span class=line><span class=cl>                <span class=c1># 如果持续时间太短，延长 Note Off 的时间戳</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ts</span> <span class=o>&lt;</span> <span class=n>min_end</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>new_event</span> <span class=o>=</span> <span class=p>(</span><span class=n>min_end</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>new_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 对处理后的事件按时间戳排序</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>processed_events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_midi</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>output_midi</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 确保所有音符都有最小持续时间</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span> <span class=o>=</span> <span class=n>enforce_min_note_duration</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建 MIDI 文件</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>MidiFile</span><span class=p>(</span><span class=n>ticks_per_beat</span><span class=o>=</span><span class=n>PPQ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>MidiTrack</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span><span class=o>.</span><span class=n>tracks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>track</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 设置曲速</span>
</span></span><span class=line><span class=cl>    <span class=n>tempo_us</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>bpm2tempo</span><span class=p>(</span><span class=n>BPM</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>MetaMessage</span><span class=p>(</span><span class=s2>&#34;set_tempo&#34;</span><span class=p>,</span> <span class=n>tempo</span><span class=o>=</span><span class=n>tempo_us</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 将事件转换为MIDI消息</span>
</span></span><span class=line><span class=cl>    <span class=n>prev_time</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>processed_events</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>processed_events</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>processed_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=n>rel_time</span> <span class=o>=</span> <span class=n>ts</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算与前一个事件的时间差（秒）</span>
</span></span><span class=line><span class=cl>        <span class=n>delta</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>rel_time</span> <span class=o>-</span> <span class=n>prev_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 将秒转换为 MIDI tick 数</span>
</span></span><span class=line><span class=cl>        <span class=n>ticks</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>second2tick</span><span class=p>(</span><span class=n>delta</span><span class=p>,</span> <span class=n>PPQ</span><span class=p>,</span> <span class=n>tempo_us</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 创建MIDI消息</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span><span class=s2>&#34;note_on&#34;</span><span class=p>,</span> <span class=n>note</span><span class=o>=</span><span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=o>=</span><span class=n>velocity</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=n>ticks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_off&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span><span class=s2>&#34;note_off&#34;</span><span class=p>,</span> <span class=n>note</span><span class=o>=</span><span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=o>=</span><span class=n>velocity</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=n>ticks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>prev_time</span> <span class=o>=</span> <span class=n>rel_time</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>MetaMessage</span><span class=p>(</span><span class=s2>&#34;end_of_track&#34;</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>output_midi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MIDI 文件已保存：</span><span class=si>{</span><span class=n>output_midi</span><span class=si>}</span><span class=s2>（共 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>processed_events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个事件）&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>input_data</span> <span class=o>=</span> <span class=s2>&#34;1.txt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out_midi</span> <span class=o>=</span> <span class=s2>&#34;1.mid&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>parse_midi_events</span><span class=p>(</span><span class=n>input_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 提取到 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个 MIDI 事件&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>build_midi</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>out_midi</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>这个代码具体是什么意思呢？</p><p>就是首先从我们 tshark 提取出来的数据中解析时间戳和 midi 时间</p><p>然后我们设置一个时间间隔：0.01，只要是小于这个时间间隔的，我们就认为是同时按下去的</p><p>其实可以认为就是乐理中的和弦，那么我们要怎么注意到这个规律的呢?</p><p>我们可以直接去看 tshark 中提取出来的midi数据(一共三字节)：</p><p>第一字节代表事件(note on/note off)，第二字节代表音符，第三字节代表力度</p><p>然后我们可以看到音符有很多连续的段，但是中间有时候会缺几个</p><p>这其实就对应到二维码中黑白像素的分布，连续的就是黑色像素的位置，缺失的则是白色像素</p></blockquote><p>然后我们用 audacity 打开制作好的 mid 文件，稍微拉伸缩放一下，可以看到下图</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251118111440827.png alt=/posts/8582ff7/imgs/image-20251118111440827.png height=1836 width=2822></p><p>发现是个倒置的二维码，但是很明显这样是没法扫描的，因此我们可以写个脚本把它保存到图片中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mido</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PPQ</span> <span class=o>=</span> <span class=mi>480</span>  <span class=c1># 每四分音符的 tick 数</span>
</span></span><span class=line><span class=cl><span class=n>BPM</span> <span class=o>=</span> <span class=mf>120.0</span>  <span class=c1># 节拍速度</span>
</span></span><span class=line><span class=cl><span class=n>MIN_DURATION_MS</span> <span class=o>=</span> <span class=mf>120.0</span>  <span class=c1># 音符最小持续时间（毫秒）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_midi_events</span><span class=p>(</span><span class=n>input_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>input_file</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>lines</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(lines) # 1722159321.608646000\t904064</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ts_str</span><span class=p>,</span> <span class=n>hexdata</span> <span class=o>=</span> <span class=n>parts</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>ts_str</span><span class=p>)</span>  <span class=c1># 时间戳</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hexdata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=mh>0x90</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x9F</span> <span class=ow>and</span> <span class=n>velocity</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=s2>&#34;note_on&#34;</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=mh>0x80</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x8F</span> <span class=ow>or</span> <span class=p>(</span><span class=mh>0x90</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x9F</span> <span class=ow>and</span> <span class=n>velocity</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=s2>&#34;note_off&#34;</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>group_rows</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>current</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>prev</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 只使用 note_on 事件来分组行</span>
</span></span><span class=line><span class=cl>    <span class=n>note_on_events</span> <span class=o>=</span> <span class=p>[</span><span class=n>ev</span> <span class=k>for</span> <span class=n>ev</span> <span class=ow>in</span> <span class=n>events</span> <span class=k>if</span> <span class=n>ev</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=ow>in</span> <span class=n>note_on_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 如果大于阈值0.01s，就是下一行的数据</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>prev</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>ts</span> <span class=o>-</span> <span class=n>prev</span> <span class=o>&gt;</span> <span class=mf>0.01</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rows</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>current</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>note</span><span class=p>)</span>  <span class=c1># 同一行的都加入</span>
</span></span><span class=line><span class=cl>        <span class=n>prev</span> <span class=o>=</span> <span class=n>ts</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=n>rows</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current</span><span class=p>)</span>  <span class=c1># 添加一整行的数据</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>rows</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>render_matrix</span><span class=p>(</span><span class=n>rows</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>note_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>  <span class=c1># 利用集合去重</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=n>row</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>note_set</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># print(note_set)</span>
</span></span><span class=line><span class=cl>    <span class=n>all_notes</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>note_set</span><span class=p>)</span>  <span class=c1># 从小到大排序</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(all_notes)</span>
</span></span><span class=line><span class=cl>    <span class=n>note_to_idx</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 音符对应到列</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>note</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>all_notes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>note_to_idx</span><span class=p>[</span><span class=n>note</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>H</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>W</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>all_notes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>matrix</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>H</span><span class=p>,</span> <span class=n>W</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>y</span><span class=p>,</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>rows</span><span class=p>):</span>  <span class=c1># 填充矩阵</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=n>row</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>col</span> <span class=o>=</span> <span class=n>note_to_idx</span><span class=p>[</span><span class=n>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>matrix</span><span class=p>[</span><span class=n>y</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_png</span><span class=p>(</span><span class=n>matrix</span><span class=p>,</span> <span class=n>out_img</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 矩阵中大于 0 的置为 0（黑色），等于 0 的置为 255（白色）</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>matrix</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s2>&#34;uint8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>H</span><span class=p>,</span> <span class=n>W</span> <span class=o>=</span> <span class=n>matrix</span><span class=o>.</span><span class=n>shape</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=n>W</span> <span class=o>*</span> <span class=mi>20</span><span class=p>,</span> <span class=n>H</span> <span class=o>*</span> <span class=mi>20</span><span class=p>),</span> <span class=n>Image</span><span class=o>.</span><span class=n>NEAREST</span><span class=p>)</span>  <span class=c1># 放大二维码</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>out_img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 图像已保存：</span><span class=si>{</span><span class=n>out_img</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>enforce_min_note_duration</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 按需延长 Note Off 的时间，保证音符不少于 MIN_DURATION_MS</span>
</span></span><span class=line><span class=cl>    <span class=n>min_duration</span> <span class=o>=</span> <span class=n>MIN_DURATION_MS</span> <span class=o>/</span> <span class=mf>1000.0</span>
</span></span><span class=line><span class=cl>    <span class=n>active_notes</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 记录活跃的 note_on 事件</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>note</span>
</span></span><span class=line><span class=cl>            <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_off&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>note</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>active_notes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>start_ts</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>min_end</span> <span class=o>=</span> <span class=n>start_ts</span> <span class=o>+</span> <span class=n>min_duration</span>
</span></span><span class=line><span class=cl>                <span class=c1># 如果持续时间太短，延长 Note Off 的时间戳</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ts</span> <span class=o>&lt;</span> <span class=n>min_end</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>new_event</span> <span class=o>=</span> <span class=p>(</span><span class=n>min_end</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>new_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 对处理后的事件按时间戳排序</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>processed_events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_midi</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>output_midi</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 确保所有音符都有最小持续时间</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span> <span class=o>=</span> <span class=n>enforce_min_note_duration</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建 MIDI 文件</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>MidiFile</span><span class=p>(</span><span class=n>ticks_per_beat</span><span class=o>=</span><span class=n>PPQ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>MidiTrack</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span><span class=o>.</span><span class=n>tracks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>track</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 设置曲速</span>
</span></span><span class=line><span class=cl>    <span class=n>tempo_us</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>bpm2tempo</span><span class=p>(</span><span class=n>BPM</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>MetaMessage</span><span class=p>(</span><span class=s2>&#34;set_tempo&#34;</span><span class=p>,</span> <span class=n>tempo</span><span class=o>=</span><span class=n>tempo_us</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 将事件转换为MIDI消息</span>
</span></span><span class=line><span class=cl>    <span class=n>prev_time</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>processed_events</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>processed_events</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>processed_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=n>rel_time</span> <span class=o>=</span> <span class=n>ts</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算与前一个事件的时间差（秒）</span>
</span></span><span class=line><span class=cl>        <span class=n>delta</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>rel_time</span> <span class=o>-</span> <span class=n>prev_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 将秒转换为 MIDI tick 数</span>
</span></span><span class=line><span class=cl>        <span class=n>ticks</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>second2tick</span><span class=p>(</span><span class=n>delta</span><span class=p>,</span> <span class=n>PPQ</span><span class=p>,</span> <span class=n>tempo_us</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 创建MIDI消息</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span><span class=s2>&#34;note_on&#34;</span><span class=p>,</span> <span class=n>note</span><span class=o>=</span><span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=o>=</span><span class=n>velocity</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=n>ticks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_off&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span><span class=s2>&#34;note_off&#34;</span><span class=p>,</span> <span class=n>note</span><span class=o>=</span><span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=o>=</span><span class=n>velocity</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=n>ticks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>prev_time</span> <span class=o>=</span> <span class=n>rel_time</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>MetaMessage</span><span class=p>(</span><span class=s2>&#34;end_of_track&#34;</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>output_midi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MIDI 文件已保存：</span><span class=si>{</span><span class=n>output_midi</span><span class=si>}</span><span class=s2>（共 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>processed_events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个事件）&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>input_data</span> <span class=o>=</span> <span class=s2>&#34;1.txt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out_img</span> <span class=o>=</span> <span class=s2>&#34;1.png&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out_midi</span> <span class=o>=</span> <span class=s2>&#34;1.mid&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>parse_midi_events</span><span class=p>(</span><span class=n>input_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 提取到 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个 MIDI 事件&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>build_midi</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>out_midi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 生成图像（只使用 note_on 事件）</span>
</span></span><span class=line><span class=cl>    <span class=n>note_on_events</span> <span class=o>=</span> <span class=p>[</span><span class=n>ev</span> <span class=k>for</span> <span class=n>ev</span> <span class=ow>in</span> <span class=n>events</span> <span class=k>if</span> <span class=n>ev</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 其中 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>note_on_events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个 NOTE ON 事件&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=n>group_rows</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 分成 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span><span class=si>}</span><span class=s2> 行&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>matrix</span> <span class=o>=</span> <span class=n>render_matrix</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>save_png</span><span class=p>(</span><span class=n>matrix</span><span class=p>,</span> <span class=n>out_img</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>运行以上图片后可以得到下图</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251118111659538.png alt=/posts/8582ff7/imgs/image-20251118111659538.png height=1764 width=2338></p><p>发现左上角有个像素位置偏移了，不过问题不大，用工具或者手动处理一下也能扫出来</p><p>扫码后得到：<code>dac765079a6eb04a6a2a89a601c40c5f8e7c08e5f1b37bac6016e1c63f193d10</code></p><p>然后我们再去看 velato.pcapng，前面的步骤是一样的，首先用 tshark 导出时间戳和 midi 事件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r velato.pcapng -T fields -Y <span class=s1>&#39;usbaudio.midi.event&#39;</span> -e <span class=s1>&#39;frame.time_epoch&#39;</span> -e <span class=s1>&#39;usbaudio.midi.event&#39;</span> &gt; 2.txt </span></span></code></pre></td></tr></table></div></div><p>然后用上面那个脚本生成 mid 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mido</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PPQ</span> <span class=o>=</span> <span class=mi>480</span>  <span class=c1># 每四分音符的 tick 数</span>
</span></span><span class=line><span class=cl><span class=n>BPM</span> <span class=o>=</span> <span class=mf>120.0</span>  <span class=c1># 节拍速度</span>
</span></span><span class=line><span class=cl><span class=n>MIN_DURATION_MS</span> <span class=o>=</span> <span class=mf>120.0</span>  <span class=c1># 音符最小持续时间（毫秒）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_midi_events</span><span class=p>(</span><span class=n>input_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>input_file</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>lines</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(lines) # 1722159321.608646000\t904064</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ts_str</span><span class=p>,</span> <span class=n>hexdata</span> <span class=o>=</span> <span class=n>parts</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>ts_str</span><span class=p>)</span>  <span class=c1># 时间戳</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hexdata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=mh>0x90</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x9F</span> <span class=ow>and</span> <span class=n>velocity</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=s2>&#34;note_on&#34;</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=mh>0x80</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x8F</span> <span class=ow>or</span> <span class=p>(</span><span class=mh>0x90</span> <span class=o>&lt;=</span> <span class=n>status</span> <span class=o>&lt;=</span> <span class=mh>0x9F</span> <span class=ow>and</span> <span class=n>velocity</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=s2>&#34;note_off&#34;</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>enforce_min_note_duration</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 按需延长 Note Off 的时间，保证音符不少于 MIN_DURATION_MS</span>
</span></span><span class=line><span class=cl>    <span class=n>min_duration</span> <span class=o>=</span> <span class=n>MIN_DURATION_MS</span> <span class=o>/</span> <span class=mf>1000.0</span>
</span></span><span class=line><span class=cl>    <span class=n>active_notes</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 记录活跃的 note_on 事件</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>note</span>
</span></span><span class=line><span class=cl>            <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_off&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>note</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>active_notes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>start_ts</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>min_end</span> <span class=o>=</span> <span class=n>start_ts</span> <span class=o>+</span> <span class=n>min_duration</span>
</span></span><span class=line><span class=cl>                <span class=c1># 如果持续时间太短，延长 Note Off 的时间戳</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ts</span> <span class=o>&lt;</span> <span class=n>min_end</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>new_event</span> <span class=o>=</span> <span class=p>(</span><span class=n>min_end</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>new_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=n>active_notes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 对处理后的事件按时间戳排序</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>processed_events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_midi</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>output_midi</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 确保所有音符都有最小持续时间</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span> <span class=o>=</span> <span class=n>enforce_min_note_duration</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建 MIDI 文件</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>MidiFile</span><span class=p>(</span><span class=n>ticks_per_beat</span><span class=o>=</span><span class=n>PPQ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>MidiTrack</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span><span class=o>.</span><span class=n>tracks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>track</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 设置曲速</span>
</span></span><span class=line><span class=cl>    <span class=n>tempo_us</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>bpm2tempo</span><span class=p>(</span><span class=n>BPM</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>MetaMessage</span><span class=p>(</span><span class=s2>&#34;set_tempo&#34;</span><span class=p>,</span> <span class=n>tempo</span><span class=o>=</span><span class=n>tempo_us</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 将事件转换为MIDI消息</span>
</span></span><span class=line><span class=cl>    <span class=n>prev_time</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>processed_events</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>processed_events</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>processed_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>note</span><span class=p>,</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=n>rel_time</span> <span class=o>=</span> <span class=n>ts</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算与前一个事件的时间差（秒）</span>
</span></span><span class=line><span class=cl>        <span class=n>delta</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>rel_time</span> <span class=o>-</span> <span class=n>prev_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 将秒转换为 MIDI tick 数</span>
</span></span><span class=line><span class=cl>        <span class=n>ticks</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>second2tick</span><span class=p>(</span><span class=n>delta</span><span class=p>,</span> <span class=n>PPQ</span><span class=p>,</span> <span class=n>tempo_us</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 创建MIDI消息</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_on&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span><span class=s2>&#34;note_on&#34;</span><span class=p>,</span> <span class=n>note</span><span class=o>=</span><span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=o>=</span><span class=n>velocity</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=n>ticks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;note_off&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>mido</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span><span class=s2>&#34;note_off&#34;</span><span class=p>,</span> <span class=n>note</span><span class=o>=</span><span class=n>note</span><span class=p>,</span> <span class=n>velocity</span><span class=o>=</span><span class=n>velocity</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=n>ticks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>prev_time</span> <span class=o>=</span> <span class=n>rel_time</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>track</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mido</span><span class=o>.</span><span class=n>MetaMessage</span><span class=p>(</span><span class=s2>&#34;end_of_track&#34;</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>output_midi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MIDI 文件已保存：</span><span class=si>{</span><span class=n>output_midi</span><span class=si>}</span><span class=s2>（共 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>processed_events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个事件）&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>input_data</span> <span class=o>=</span> <span class=s2>&#34;2.txt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out_midi</span> <span class=o>=</span> <span class=s2>&#34;2.mid&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>parse_midi_events</span><span class=p>(</span><span class=n>input_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] 提取到 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span><span class=si>}</span><span class=s2> 个 MIDI 事件&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>build_midi</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>out_midi</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>其实流量包的文件名给了我们提示：<code>velato</code></p><p><code>velato</code> 是一种编程语言，我们可以到官网上下载编译器：https://velato.net/</p><p>编译然后运行即可得到密钥：<code>Th1s1sAuSeFu1ke4</code></p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251118112434745.png alt=/posts/8582ff7/imgs/image-20251118112434745.png height=1372 width=2028></p><p>最后解个 AES-ECB 即可得到 flag：<code>DASCTF{M1D1_C0Mp0s2r!!!}</code></p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251118112601443.png alt=/posts/8582ff7/imgs/image-20251118112601443.png height=1198 width=2792></p><h2 class=heading-element id=题目名称-really-good-binaural-audio><span>题目名称 Really Good Binaural Audio</span>
<a href=#%e9%a2%98%e7%9b%ae%e5%90%8d%e7%a7%b0-really-good-binaural-audio class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><blockquote><p>题面信息：</p><p>Tell me when you sight the sound.</p></blockquote><p>附件给了一个 <code>flag.wav</code> 的音频文件，我们用 Audacity 打开，在频谱图中可以看到表示题目名称的字符串</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120100737325.png alt=/posts/8582ff7/imgs/image-20251120100737325.png height=1836 width=2804></p><p>我们可以先写个脚本来查看一下这个音频的基本信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>wave</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_info</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>wave</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>,</span><span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>wf</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>n_channels</span> <span class=o>=</span> <span class=n>wf</span><span class=o>.</span><span class=n>getnchannels</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>samplewidth_bytes</span> <span class=o>=</span> <span class=n>wf</span><span class=o>.</span><span class=n>getsampwidth</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>bits_per_sample</span> <span class=o>=</span> <span class=n>samplewidth_bytes</span> <span class=o>*</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=n>framerate</span> <span class=o>=</span> <span class=n>wf</span><span class=o>.</span><span class=n>getframerate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>n_frames</span> <span class=o>=</span> <span class=n>wf</span><span class=o>.</span><span class=n>getnframes</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>duration</span> <span class=o>=</span> <span class=n>n_frames</span> <span class=o>/</span> <span class=n>framerate</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;通道数: </span><span class=si>{</span><span class=n>n_channels</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;每个采样的字节数: </span><span class=si>{</span><span class=n>samplewidth_bytes</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;每个采样的位数: </span><span class=si>{</span><span class=n>bits_per_sample</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;采样率: </span><span class=si>{</span><span class=n>framerate</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总帧数: </span><span class=si>{</span><span class=n>n_frames</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;时长(秒): </span><span class=si>{</span><span class=n>duration</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 通道数: 2</span>
</span></span><span class=line><span class=cl>    <span class=c1># 每个采样的字节数: 2</span>
</span></span><span class=line><span class=cl>    <span class=c1># 每个采样的位数: 16</span>
</span></span><span class=line><span class=cl>    <span class=c1># 采样率: 22050</span>
</span></span><span class=line><span class=cl>    <span class=c1># 总帧数: 3884905</span>
</span></span><span class=line><span class=cl>    <span class=c1># 时长(秒): 176.18616780045352</span></span></span></code></pre></td></tr></table></div></div><p>发现是双声道，采样的精度是 16bit，因此每个采样点双声道就包含 32bit 的数据</p><p>总的采样点数为3884905，分解一下可以得到 3884905 = 5 x 761 x 1021</p><p>把题目名中每个单词的首字母连起来可以得到<code>RGBA</code>这个提示，猜测是要我们把这些数据转为 RGBA 像素</p><p>并且频谱图中也提示了我们：左声道是 RG，右声道则是 BA</p><p>因为是 RGBA 图像，并且我们之前分析得到每个采样点双声道包含 32bit 的数据</p><p>因此猜测 RGBA 每个通道就都是 8bit 的数据，但是图像的宽高是什么呢？</p><p>我们可以写个脚本来查看一下具体的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.io</span> <span class=kn>import</span> <span class=n>wavfile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_rate</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>wavfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>idx</span><span class=p>,[</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>]</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>[:</span><span class=mi>100</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>idx</span> <span class=o>%</span> <span class=mi>5</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>50</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>l</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>l</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>r</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl>        <span class=n>l</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>l</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>g</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120162701292.png alt=/posts/8582ff7/imgs/image-20251120162701292.png height=1672 width=2440></p><p>仔细观察我们就会发现，这个像素点的分布大致是以5个像素点的数据为一组的</p><p>因此我们从之前的总采样点数：3884905 = 5 x 761 x 1021，就可以判断图像宽高就是 1021 x 761 或者 761 x 1021</p><p>我们写个脚本提取一下数据，然后转为RGBA像素点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.io</span> <span class=kn>import</span> <span class=n>wavfile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_rate</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>wavfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGBA&#39;</span><span class=p>,</span> <span class=p>(</span><span class=mi>1021</span><span class=p>,</span> <span class=mi>761</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>761</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1021</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=o>+</span> <span class=n>y</span> <span class=o>*</span> <span class=mi>1021</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span> <span class=c1># 5个采样点一组</span>
</span></span><span class=line><span class=cl>            <span class=n>left_val</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># 左声道的数据</span>
</span></span><span class=line><span class=cl>            <span class=n>right_val</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=c1># 右声道的数据</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>left_val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>left_val</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>    <span class=c1># 高 8 位 -&gt; R，低 8 位 -&gt; G</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>right_val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>right_val</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>  <span class=c1># 高 8 位 -&gt; B，低 8 位 -&gt; A</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=c1># np.int16 转为 int 类型</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;flag.png&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>运行以上脚本后即可得到下图，flag 可能有点模糊，不过硬看也能看出来</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120163729490.png alt=/posts/8582ff7/imgs/image-20251120163729490.png height=1626 width=2042></p><p>如果想要更清晰的 flag，可以到 stegsolve 中调整一下</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120163838903.png alt=/posts/8582ff7/imgs/image-20251120163838903.png height=1456 width=2000></p><p><code>DASCTF{A_1s_for_Audio_1n_RGBA}</code></p><p>当然，这里如果没注意到像素分布是 5 个一组，这题也是可以做的，就是出来的图像可能会有点变形</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.io</span> <span class=kn>import</span> <span class=n>wavfile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_rate</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>wavfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGBA&#39;</span><span class=p>,</span> <span class=p>(</span><span class=mi>5105</span><span class=p>,</span> <span class=mi>761</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>761</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5105</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span> <span class=o>*</span> <span class=mi>5105</span>
</span></span><span class=line><span class=cl>            <span class=n>left_val</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># 左声道的数据</span>
</span></span><span class=line><span class=cl>            <span class=n>right_val</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=c1># 右声道的数据</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>left_val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>left_val</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>    <span class=c1># 高 8 位 -&gt; R，低 8 位 -&gt; G</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>right_val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>right_val</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>  <span class=c1># 高 8 位 -&gt; B，低 8 位 -&gt; A</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=c1># np.int16 转为 int 类型</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;flag.png&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120164514457.png alt=/posts/8582ff7/imgs/image-20251120164514457.png height=702 width=2738></p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120164619429.png alt=/posts/8582ff7/imgs/image-20251120164619429.png height=1456 width=2000></p><p>附：完整解题脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.io</span> <span class=kn>import</span> <span class=n>wavfile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_rate</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>wavfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>idx</span><span class=p>,[</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=p>]</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>[:</span><span class=mi>100</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>idx</span> <span class=o>%</span> <span class=mi>5</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;=&#39;</span><span class=o>*</span><span class=mi>50</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>l</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>l</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>r</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl>        <span class=n>l</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>l</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>l</span><span class=p>,</span><span class=n>r</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>g</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_rate</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>wavfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGBA&#39;</span><span class=p>,</span> <span class=p>(</span><span class=mi>1021</span><span class=p>,</span> <span class=mi>761</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>761</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1021</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=o>+</span> <span class=n>y</span> <span class=o>*</span> <span class=mi>1021</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span> <span class=c1># 5个采样点一组</span>
</span></span><span class=line><span class=cl>            <span class=n>left_val</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># 左声道的数据</span>
</span></span><span class=line><span class=cl>            <span class=n>right_val</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=c1># 右声道的数据</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>left_val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>left_val</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>    <span class=c1># 高 8 位 -&gt; R，低 8 位 -&gt; G</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>right_val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=n>right_val</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>  <span class=c1># 高 8 位 -&gt; B，低 8 位 -&gt; A</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=c1># np.int16 转为 int 类型</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;flag.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>func1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>然后除了以上预期的解法以外，<code>@脉冲星</code>师傅还有一种非预期的解法</p><p>首先就是提取音频的数据，然后把双声道的低8位数据转为字节连起来并导出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.io</span> <span class=kn>import</span> <span class=n>wavfile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_rate</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>wavfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;flag.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data1</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>data2</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data1</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>data2</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>data1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>data2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[:</span><span class=mi>100</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;out.data&#39;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=n>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>然后把导出的.data文件拉入GIMP调整位移和宽高，这样也能得到图片和其中的flag，而且这样做甚至比预期解看的更清晰</p><p><img loading=lazy src=/posts/8582ff7/imgs/image-20251120194823275.png alt=/posts/8582ff7/imgs/image-20251120194823275.png height=1783 width=2408></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-11-18 10:56:18">更新于 2025-11-18&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/8582ff7/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://goodlunatic.github.io/posts/8582ff7/ data-title="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup" data-hashtags=CTF,Writeup,Misc><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://goodlunatic.github.io/posts/8582ff7/ data-hashtag=CTF><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://goodlunatic.github.io/posts/8582ff7/ data-title="2025 浙江省大学生网络与信息安全竞赛 Misc Writeup"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ctf/ class=post-tag title="标签 - CTF">CTF</a><a href=/tags/writeup/ class=post-tag title="标签 - Writeup">Writeup</a><a href=/tags/misc/ class=post-tag title="标签 - Misc">Misc</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/bfeb088/ class=post-nav-item rel=prev title="2025 台州市网络安全大赛 Misc Writeup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>2025 台州市网络安全大赛 Misc Writeup</a><a href=/posts/417c7ba/ class=post-nav-item rel=next title=CTF-渗透测试>CTF-渗透测试<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=goodlunatic/goodlunatic.github.io data-repo-id=R_kgDOQHqgBw data-category=Announcements data-category-id=DIC_kwDOQHqgB84Cw_4D data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd">FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://goodlunatic.github.io target=_blank rel="external nofollow noopener noreferrer">Lunatic</a></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/goodlunatic title="Visit Lunatic's Github" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=https://vercount.one/js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script src=/posts/8582ff7/config/page.js defer></script><script src=/js/theme.min.js defer></script></body></html>